<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='å…¬å¸ç›®å‰åœ¨AåŒºï¼Œè¦è®¿é—®Bçš„èµ„æºå’Œç½‘ç«™ï¼Œè¿™ä¸ªå°†å¦‚ä½•è®¿é—®ï¼Ÿå¦‚æœé‡‡ç”¨ä¸“çº¿æˆæœ¬å¤ªé«˜ï¼Œç»è¿‡è¿ç»´è°ƒç ”å’Œæµ‹è¯•ï¼Œé‡‡ç”¨Openvpnèƒ½æå¤§æœ‰æ•ˆå®Œæˆè¿™ä¸ªéœ€æ±‚ï¼Œå¹¶ä¸”å®‰å…¨ï¼Œæˆæœ¬åº•ï¼Œå¯ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚'>
<title>é«˜å¯ç”¨openvpnå…¨å±€å•å‘Aè®¿é—®BåŒºçš„ç½‘ç»œ</title>

<link rel='canonical' href='https://www.ownit.top/p/202407290930/'>

<link rel="stylesheet" href="/scss/style.min.f8f67bed86aec9bc8e9eb410ba9583e51cb34eee82f3d10e0abbae72b51272ce.css"><meta property='og:title' content='é«˜å¯ç”¨openvpnå…¨å±€å•å‘Aè®¿é—®BåŒºçš„ç½‘ç»œ'>
<meta property='og:description' content='å…¬å¸ç›®å‰åœ¨AåŒºï¼Œè¦è®¿é—®Bçš„èµ„æºå’Œç½‘ç«™ï¼Œè¿™ä¸ªå°†å¦‚ä½•è®¿é—®ï¼Ÿå¦‚æœé‡‡ç”¨ä¸“çº¿æˆæœ¬å¤ªé«˜ï¼Œç»è¿‡è¿ç»´è°ƒç ”å’Œæµ‹è¯•ï¼Œé‡‡ç”¨Openvpnèƒ½æå¤§æœ‰æ•ˆå®Œæˆè¿™ä¸ªéœ€æ±‚ï¼Œå¹¶ä¸”å®‰å…¨ï¼Œæˆæœ¬åº•ï¼Œå¯ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚'>
<meta property='og:url' content='https://www.ownit.top/p/202407290930/'>
<meta property='og:site_name' content='å—å®«ä¹˜é£'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='opevpn' /><meta property='article:published_time' content='2024-07-29T09:30:50&#43;00:00'/><meta property='article:modified_time' content='2024-07-29T09:30:50&#43;00:00'/><meta property='og:image' content='https://www.ownit.top/title_pic/76.jpg' />
<meta name="twitter:title" content="é«˜å¯ç”¨openvpnå…¨å±€å•å‘Aè®¿é—®BåŒºçš„ç½‘ç»œ">
<meta name="twitter:description" content="å…¬å¸ç›®å‰åœ¨AåŒºï¼Œè¦è®¿é—®Bçš„èµ„æºå’Œç½‘ç«™ï¼Œè¿™ä¸ªå°†å¦‚ä½•è®¿é—®ï¼Ÿå¦‚æœé‡‡ç”¨ä¸“çº¿æˆæœ¬å¤ªé«˜ï¼Œç»è¿‡è¿ç»´è°ƒç ”å’Œæµ‹è¯•ï¼Œé‡‡ç”¨Openvpnèƒ½æå¤§æœ‰æ•ˆå®Œæˆè¿™ä¸ªéœ€æ±‚ï¼Œå¹¶ä¸”å®‰å…¨ï¼Œæˆæœ¬åº•ï¼Œå¯ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://www.ownit.top/title_pic/76.jpg' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu227367ba8544f2fc7811ed9508937bec_102665_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">å—å®«ä¹˜é£</a></h1>
            <h2 class="site-description">å½“ä½ çš„æ‰åæ’‘ä¸èµ·ä½ çš„é‡å¿ƒæ—¶ï¼Œåªæœ‰é™ä¸‹å¿ƒå­¦ä¹ æ‰æ˜¯å”¯ä¸€çš„å‡ºè·¯</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://blog.csdn.net/heian_99'
                        target="_blank"
                        title="CSDN"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="32.000000pt" height="32.000000pt" viewBox="0 0 32.000000 32.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,32.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M0 160 l0 -160 160 0 160 0 0 160 0 160 -160 0 -160 0 0 -160z m225
108 c24 -11 34 -41 16 -52 -4 -3 -17 1 -27 9 -43 32 -95 3 -109 -62 -5 -27 -2
-37 19 -58 29 -29 62 -32 94 -9 25 17 42 11 42 -15 0 -27 -51 -45 -107 -38
-70 8 -97 42 -91 115 4 48 10 60 41 89 39 35 76 42 122 21z"/>
</g>
</svg>

                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/nangongchengfeng/'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='/index.xml'
                        target="_blank"
                        title="RSS"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 viewBox="0 0 455.731 455.731" xml:space="preserve">
<g>
	<rect x="0" y="0" style="fill:#F78422;" width="455.731" height="455.731"/>
	<g>
		<path style="fill:#FFFFFF;" d="M296.208,159.16C234.445,97.397,152.266,63.382,64.81,63.382v64.348
			c70.268,0,136.288,27.321,185.898,76.931c49.609,49.61,76.931,115.63,76.931,185.898h64.348
			C391.986,303.103,357.971,220.923,296.208,159.16z"/>
		<path style="fill:#FFFFFF;" d="M64.143,172.273v64.348c84.881,0,153.938,69.056,153.938,153.939h64.348
			C282.429,270.196,184.507,172.273,64.143,172.273z"/>
		<circle style="fill:#FFFFFF;" cx="109.833" cy="346.26" r="46.088"/>
	</g>
</g>
</svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/link/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>å‹é“¾</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#openvpnä»‹ç»">openvpnä»‹ç»</a>
      <ol>
        <li><a href="#openvpnåŸç†">openvpnåŸç†</a></li>
        <li><a href="#openvpnåº”ç”¨åœºæ™¯">OpenVPNåº”ç”¨åœºæ™¯</a></li>
        <li><a href="#ç§æœ‰ç½‘æ®µåˆ’åˆ†">ç§æœ‰ç½‘æ®µåˆ’åˆ†</a></li>
      </ol>
    </li>
    <li><a href="#openvpnéƒ¨ç½²">Openvpnéƒ¨ç½²</a>
      <ol>
        <li><a href="#æœåŠ¡ç«¯">æœåŠ¡ç«¯</a>
          <ol>
            <li><a href="#ç”Ÿæˆæ‰€æœ‰è¯ä¹¦å¯†é’¥åŸç†">ç”Ÿæˆæ‰€æœ‰è¯ä¹¦&amp;å¯†é’¥åŸç†</a></li>
            <li><a href="#ç”Ÿæˆcaçš„è¯ä¹¦å¯†é’¥">ç”ŸæˆCAçš„è¯ä¹¦&amp;å¯†é’¥</a></li>
            <li><a href="#ç”ŸæˆæœåŠ¡ç«¯çš„è¯ä¹¦å¯†é’¥">ç”ŸæˆæœåŠ¡ç«¯çš„è¯ä¹¦&amp;å¯†é’¥</a></li>
            <li><a href="#ç”Ÿæˆå®¢æˆ·ç«¯çš„è¯ä¹¦å¯†é’¥">ç”Ÿæˆå®¢æˆ·ç«¯çš„è¯ä¹¦&amp;å¯†é’¥</a></li>
            <li><a href="#ç”Ÿæˆdiffie-hellmanå‚æ•°">ç”ŸæˆDiffie Hellmanå‚æ•°</a></li>
            <li><a href="#ç”Ÿæˆtls-auth-key">ç”Ÿæˆtls-auth key</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#æœåŠ¡ç«¯å’Œåˆ›å»ºé…ç½®æ–‡ä»¶">æœåŠ¡ç«¯å’Œåˆ›å»ºé…ç½®æ–‡ä»¶</a>
      <ol>
        <li><a href="#è¯ä¹¦ç›®å½•ä¼˜åŒ–">è¯ä¹¦ç›®å½•ä¼˜åŒ–</a></li>
        <li><a href="#serveræœåŠ¡å™¨é…ç½®æ–‡ä»¶">ServeræœåŠ¡å™¨é…ç½®æ–‡ä»¶</a></li>
        <li><a href="#å¼€å¯forwardè½¬å‘">å¼€å¯forwardè½¬å‘</a></li>
        <li><a href="#é…ç½®iptablesè§„åˆ™">é…ç½®iptablesè§„åˆ™</a></li>
        <li><a href="#ç‰¹æ®Šå®¢æˆ·ç«¯é…ç½®ccd">ç‰¹æ®Šå®¢æˆ·ç«¯é…ç½®ccd</a></li>
        <li><a href="#æœåŠ¡ç«¯è„šæœ¬é…ç½®">æœåŠ¡ç«¯è„šæœ¬é…ç½®</a>
          <ol>
            <li><a href="#é’‰é’‰å‘é€æ¥å£è„šæœ¬">é’‰é’‰å‘é€æ¥å£è„šæœ¬</a></li>
            <li><a href="#çº¿è·¯æ£€æŸ¥-ä¸»å¤‡åˆ‡æ¢è„šæœ¬">çº¿è·¯æ£€æŸ¥-ä¸»å¤‡åˆ‡æ¢è„šæœ¬</a></li>
            <li><a href="#å®šæ—¶ä»»åŠ¡">å®šæ—¶ä»»åŠ¡</a></li>
            <li><a href="#openvpnç®¡ç†è„šæœ¬ç¬¬ä¸€ç‰ˆ">openvpnç®¡ç†è„šæœ¬ï¼ˆç¬¬ä¸€ç‰ˆï¼‰</a></li>
            <li><a href="#openvpnç®¡ç†è„šæœ¬ç¬¬äºŒç‰ˆ">openvpnç®¡ç†è„šæœ¬ï¼ˆç¬¬äºŒç‰ˆï¼‰</a></li>
            <li><a href="#å¼€é€šè´¦å·è‡ªåŠ¨å‘é€é‚®ä»¶">å¼€é€šè´¦å·è‡ªåŠ¨å‘é€é‚®ä»¶</a></li>
            <li><a href="#openvpnç®¡ç†">openvpnç®¡ç†</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#openvpn-clientå®¢æˆ·ç«¯">openvpn-clientå®¢æˆ·ç«¯</a>
      <ol>
        <li><a href="#openvpn-å®¢æˆ·ç«¯é…ç½®---ä¸»èŠ‚ç‚¹">OpenVPN å®¢æˆ·ç«¯é…ç½® - ä¸»èŠ‚ç‚¹</a>
          <ol>
            <li><a href="#å¯åŠ¨å®¢æˆ·ç«¯">å¯åŠ¨å®¢æˆ·ç«¯</a></li>
          </ol>
        </li>
        <li><a href="#openvpn-å®¢æˆ·ç«¯é…ç½®---å¤‡èŠ‚ç‚¹é€šè¿‡ä»£ç†">OpenVPN å®¢æˆ·ç«¯é…ç½® - å¤‡èŠ‚ç‚¹ï¼ˆé€šè¿‡ä»£ç†ï¼‰</a>
          <ol>
            <li><a href="#å¯åŠ¨å®¢æˆ·ç«¯-1">å¯åŠ¨å®¢æˆ·ç«¯</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#äº¤æ¢æœºé…ç½®">äº¤æ¢æœºé…ç½®</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/202407290930/">
                
                    <img src="/../../title_pic/76.jpg" loading="lazy" alt="Featured image of post é«˜å¯ç”¨openvpnå…¨å±€å•å‘Aè®¿é—®BåŒºçš„ç½‘ç»œ" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/" >
                é¡¹ç›®å®æˆ˜
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/202407290930/">é«˜å¯ç”¨openvpnå…¨å±€å•å‘Aè®¿é—®BåŒºçš„ç½‘ç»œ</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            å…¬å¸ç›®å‰åœ¨AåŒºï¼Œè¦è®¿é—®Bçš„èµ„æºå’Œç½‘ç«™ï¼Œè¿™ä¸ªå°†å¦‚ä½•è®¿é—®ï¼Ÿå¦‚æœé‡‡ç”¨ä¸“çº¿æˆæœ¬å¤ªé«˜ï¼Œç»è¿‡è¿ç»´è°ƒç ”å’Œæµ‹è¯•ï¼Œé‡‡ç”¨Openvpnèƒ½æå¤§æœ‰æ•ˆå®Œæˆè¿™ä¸ªéœ€æ±‚ï¼Œå¹¶ä¸”å®‰å…¨ï¼Œæˆæœ¬åº•ï¼Œå¯ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jul 29, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 22 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="openvpnä»‹ç»">openvpnä»‹ç»</h2>
<p>OpenVPNæ˜¯ä¸€ä¸ªå…¨ç‰¹æ€§çš„SSL VPNï¼Œæ”¯æŒå¼¹æ€§çš„å®¢æˆ·ç«¯è®¤è¯æ–¹æ³•ï¼ŒåŸºäºè¯ä¹¦ã€æ™ºèƒ½å¡ï¼Œå’Œ/æˆ–ç”¨æˆ·ååŠå¯†ç å‡­è¯ç­‰ï¼Œå¹¶ä¸”é€šè¿‡åº”ç”¨äºVPNè™šæ‹Ÿæ¥å£çš„é˜²ç«å¢™è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹å®šç”¨æˆ·æˆ–ç»„çš„è®¿é—®æ§åˆ¶ç­–ç•¥ã€‚</p>
<p>VPN å…¨ç§°ä¸ºè™šæ‹Ÿç§äººç½‘ç»œ(Virtual Private Network)ï¼Œå¸¸ç”¨äºè¿æ¥ä¸­ã€å¤§å‹ä¼ä¸šæˆ–å›¢ä½“é—´ç§äººç½‘ç»œçš„é€šè®¯æ–¹æ³•ï¼Œåˆ©ç”¨éš§é“åè®®ï¼ˆTunneling Protocolï¼‰æ¥è¾¾åˆ°å‘é€ç«¯è®¤è¯ã€æ¶ˆæ¯ä¿å¯†ä¸å‡†ç¡®æ€§ç­‰åŠŸèƒ½ã€‚</p>
<p>æ¯”å¦‚å¤šåœ°åŠå…¬çš„å…¬å¸ï¼Œå¯ä»¥ä½¿ç”¨ VPN å°†ä¸åŒåœ°åŒºè¿æ¥åœ¨åŒä¸€å†…ç½‘ä¸‹ï¼›æˆ–è€…åœ¨å®¶åŠå…¬çš„æ—¶å€™ä¹Ÿå¯ä»¥é€šè¿‡ VPN æ¥å…¥å…¬å¸å†…ç½‘ä¸­ã€‚</p>
<p>VPN ä»¥ CS æ¶æ„è¿è¡Œï¼Œå·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="/../../image/t01e5f45317f16d05bb.png"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p>VPNå·¥ä½œæµç¨‹</p>
<p>åœ¨å¤–ç½‘çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ <code>vpn client</code> è¿æ¥ç»„ç»‡æ­å»ºçš„ <code>vpn server</code> ä»¥å»ºç«‹é€šä¿¡éš§é“ï¼Œéšåä¾¿å»ºç«‹äº†è™šæ‹Ÿçš„ç§äººç½‘ç»œï¼Œå¤„äºå¤–ç½‘çš„ <code>worker</code> å’Œå†…ç½‘ä¸­çš„ <code>server</code> å¯ä»¥ç›¸äº’é€šä¿¡ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç®€å•ç†è§£ VPNï¼Œç”± <code>VPN client</code> æ•è·ç”¨æˆ·å‘å‡ºçš„æŠ¥æ–‡ï¼Œå°è£…æŠ¥æ–‡åé€šè¿‡ç‰©ç†ç½‘ç»œé€šä¿¡é“¾è·¯å°†æŠ¥æ–‡å‘ç»™ <code>VPN server</code>ï¼Œ<code>VPN server</code> æ¥æ”¶åˆ°æŠ¥æ–‡åè¿›è¡Œè§£åŒ…ï¼Œå†å°†å…¶è½¬å‘ç»™å®é™…çš„ç›®æ ‡ï¼Œåä¹‹åŒç†ï¼› VPN åœ¨é€»è¾‘å±‚é¢æ„å»ºäº†è™šæ‹Ÿç½‘ç»œã€‚</p>
<h3 id="openvpnåŸç†">openvpnåŸç†</h3>
<p>OpenVpnçš„æŠ€æœ¯æ ¸å¿ƒæ˜¯è™šæ‹Ÿç½‘å¡ï¼Œå…¶æ¬¡æ˜¯SSLåè®®å®ç°ï¼Œç”±äºSSLåè®®åœ¨å…¶å®ƒçš„è¯æ¡ä¸­ä»‹ç»çš„æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œè¿™é‡Œé‡ç‚¹å¯¹è™šæ‹Ÿç½‘å¡åŠå…¶åœ¨OpenVpnçš„ä¸­çš„å·¥ä½œæœºç†è¿›è¡Œä»‹ç»ï¼š</p>
<p>è™šæ‹Ÿç½‘å¡æ˜¯ä½¿ç”¨ç½‘ç»œåº•å±‚ç¼–ç¨‹æŠ€æœ¯å®ç°çš„ä¸€ä¸ªé©±åŠ¨è½¯ä»¶ï¼Œå®‰è£…ååœ¨ä¸»æœºä¸Šå¤šå‡ºç°ä¸€ä¸ªç½‘å¡ï¼Œå¯ä»¥åƒå…¶å®ƒç½‘å¡ä¸€æ ·è¿›è¡Œé…ç½®ã€‚æœåŠ¡ç¨‹åºå¯ä»¥åœ¨åº”ç”¨å±‚æ‰“å¼€è™šæ‹Ÿç½‘å¡ï¼Œå¦‚æœåº”ç”¨è½¯ä»¶ï¼ˆå¦‚IEï¼‰å‘è™šæ‹Ÿç½‘å¡å‘é€æ•°æ®ï¼Œåˆ™æœåŠ¡ç¨‹åºå¯ä»¥è¯»å–åˆ°è¯¥æ•°æ®ï¼Œå¦‚æœæœåŠ¡ç¨‹åºå†™åˆé€‚çš„æ•°æ®åˆ°è™šæ‹Ÿç½‘å¡ï¼Œåº”ç”¨è½¯ä»¶ä¹Ÿå¯ä»¥æ¥æ”¶å¾—åˆ°ã€‚è™šæ‹Ÿç½‘å¡åœ¨å¾ˆå¤šçš„æ“ä½œç³»ç»Ÿä¸‹éƒ½æœ‰ç›¸åº”çš„å®ç°ï¼Œè¿™ä¹Ÿæ˜¯OpenVpnèƒ½å¤Ÿè·¨å¹³å°ä¸€ä¸ªå¾ˆé‡è¦çš„ç†ç”±ã€‚</p>
<p>åœ¨OpenVpnä¸­ï¼Œå¦‚æœç”¨æˆ·è®¿é—®ä¸€ä¸ªè¿œç¨‹çš„è™šæ‹Ÿåœ°å€ï¼ˆå±äºè™šæ‹Ÿç½‘å¡é…ç”¨çš„åœ°å€ç³»åˆ—ï¼ŒåŒºåˆ«äºçœŸå®åœ°å€ï¼‰ï¼Œåˆ™æ“ä½œç³»ç»Ÿä¼šé€šè¿‡è·¯ç”±æœºåˆ¶å°†æ•°æ®åŒ…ï¼ˆTUNæ¨¡å¼ï¼‰æˆ–æ•°æ®å¸§ï¼ˆTAPæ¨¡å¼ï¼‰å‘é€åˆ°è™šæ‹Ÿç½‘å¡ä¸Šï¼ŒæœåŠ¡ç¨‹åºæ¥æ”¶è¯¥æ•°æ®å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†åï¼Œé€šè¿‡SOCKETä»å¤–ç½‘ä¸Šå‘é€å‡ºå»ï¼Œè¿œç¨‹æœåŠ¡ç¨‹åºé€šè¿‡SOCKETä»å¤–ç½‘ä¸Šæ¥æ”¶æ•°æ®ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†åï¼Œå‘é€ç»™è™šæ‹Ÿç½‘å¡ï¼Œåˆ™åº”ç”¨è½¯ä»¶å¯ä»¥æ¥æ”¶åˆ°ï¼Œå®Œæˆäº†ä¸€ä¸ªå•å‘ä¼ è¾“çš„è¿‡ç¨‹ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<h3 id="openvpnåº”ç”¨åœºæ™¯">OpenVPNåº”ç”¨åœºæ™¯</h3>
<p>Peer-to-Peer VPN(ç‚¹å¯¹ç‚¹è¿æ¥)ï¼Œå°†Internetä¸¤å°æœºå™¨ï¼ˆå…¬ç½‘åœ°å€ï¼‰ä½¿ç”¨VPNè¿æ¥èµ·æ¥ï¼Œæ¯”å¦‚ä¸Šæµ·æœåŠ¡å™¨å’ŒåŒ—äº¬æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®éœ€è¦ç›¸äº’è°ƒç”¨ï¼Œä½†æ˜¯æ•°æ®åˆæ¯”è¾ƒæ•æ„Ÿï¼Œç›´æ¥é€šè¿‡httpå…¬å…±ç½‘ç»œä¼ è¾“ï¼Œå®¹æ˜“è¢«çªƒå–ï¼Œå¦‚æœæ‹‰ä¸€æ¡ä¸“çº¿æˆæœ¬åˆå¤ªé«˜ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡VPNä½¿ç”¨ç°æœ‰ç½‘ç»œï¼Œå°†ä¸¤å°ä¸»æœºé€»è¾‘ä¸Šæ†ç»‘åœ¨ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œä¸­ï¼Œè¿™æ ·æ—¢ä¿è¯äº†æ•°æ®ä¼ è¾“å®‰å…¨ï¼ŒåŒæ—¶åˆèŠ‚çœäº†æˆæœ¬ã€‚</p>
<p>1.ç”¨æˆ·é€šè¿‡Internetè¿æ¥vpnæœåŠ¡é€šè¿‡åŠ å¯†æŠ€æœ¯è¿›è¡Œæ•°æ®ä¼ è¾“ï¼›</p>
<p>2.åŠ å¯†å®ç°æ–¹å¼æ˜¯å®¢æˆ·ç«¯å…¬é’¥åŠ å¯†ï¼ŒæœåŠ¡ç«¯ç§é’¥è§£å¯†ï¼›</p>
<p>3.å®¢æˆ·ç«¯è¿æ¥vpnåï¼Œvpnä¼šç»™å®¢æˆ·ç«¯æ¨é€ä¸€æ¡å†…ç½‘è·¯ç”±ä»¥æ­¤å®ç°å†…éƒ¨ä¸»æœºé€šä¿¡</p>
<h3 id="ç§æœ‰ç½‘æ®µåˆ’åˆ†">ç§æœ‰ç½‘æ®µåˆ’åˆ†</h3>
<p>æ­å»ºVPNé€šå¸¸æ˜¯ä¸ºäº†å°†ä½äºä¸åŒåœ°ç†ä½ç½®çš„ç§æœ‰ç½‘æ®µè¿æ¥èµ·æ¥ã€‚è¦æ³¨æ„ï¼ŒVPNæ‰€è¿æ¥çš„ä¸¤ç«¯çš„ç§ç½‘ç½‘æ®µä¸èƒ½å†²çªã€‚</p>
<p>IANA (The Internet Assigned Numbers Authority)å®šä¹‰äº†ä¸‹é¢ä¸‰ä¸ªIPåœ°å€å—ç”¨äºç§æœ‰ç½‘ç»œï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>10.0.0.0</th>
<th>10.255.255.255</th>
<th>(10/8å‰ç¼€)</th>
</tr>
</thead>
<tbody>
<tr>
<td>172.16.0.0</td>
<td>172.31.255.255</td>
<td>(172.16/12å‰ç¼€)</td>
</tr>
<tr>
<td>192.168.0.0</td>
<td>192.168.255.255</td>
<td>(192.168/16å‰ç¼€)</td>
</tr>
</tbody>
</table></div>
<h2 id="openvpnéƒ¨ç½²">Openvpnéƒ¨ç½²</h2>
<p>ç¯å¢ƒä»‹ç»</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ä¸»æœº</th>
<th>ip</th>
<th>ç½‘æ®µ</th>
</tr>
</thead>
<tbody>
<tr>
<td>openvpn-server(vpn-192.168.83.44 )</td>
<td>192.168.83.10ï¼ˆç‰©ç†ipï¼‰/192.168.255.1(è™šæ‹Ÿip)</td>
<td>192.168.0.0/16</td>
</tr>
<tr>
<td>openvpn-client01&ndash;ï¼ˆä¸»èŠ‚ç‚¹ï¼‰</td>
<td>10.134.18.10ï¼ˆç‰©ç†ipï¼‰/192.168.255.10(è™šæ‹Ÿip)</td>
<td>10.0.0.0/8</td>
</tr>
<tr>
<td>openvpn-client02&ndash;ï¼ˆå¤‡èŠ‚ç‚¹ï¼‰</td>
<td>10.128.19.10ï¼ˆç‰©ç†ipï¼‰/192.168.255.6</td>
<td>10.0.0.0/8</td>
</tr>
<tr>
<td>serverè™šæ‹Ÿip</td>
<td>192.168.255.1/24</td>
<td>192.168.255.0/16</td>
</tr>
</tbody>
</table></div>
<p>å®‰è£…ç³»ç»Ÿï¼šCentOS Linux release 7.5.1804 (Core)</p>
<p>å¯ç”¨EPELçš„yumæºï¼Œå®‰è£…OpenVPNï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@gw ~<span class="o">]</span><span class="c1"># yum install epel-release</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@gw ~<span class="o">]</span><span class="c1"># yum install openvpn </span>
</span></span><span class="line"><span class="cl">OpenVPNç¨‹åºåº”è¯¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æœºå™¨éƒ½å®‰è£…ï¼Œå®ƒæ˜¯åŒä¸€ä¸ªç¨‹åºåŒ…æä¾›å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯çš„åŠŸèƒ½ï¼Œå–å†³äºä½ çš„é…ç½®
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æœåŠ¡ç«¯">æœåŠ¡ç«¯</h3>
<p><img src="/../../image/image-20220627093050143.png"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<h4 id="ç”Ÿæˆæ‰€æœ‰è¯ä¹¦å¯†é’¥åŸç†">ç”Ÿæˆæ‰€æœ‰è¯ä¹¦&amp;å¯†é’¥åŸç†</h4>
<p>æ­å»ºOpenVPNï¼Œéœ€è¦è®¾ç½®ä½ è‡ªå·±çš„CA(Certificate Authority)å¹¶ä¸”ä¸ºOpenVPNæœåŠ¡å™¨å’Œå¤šä¸ªå®¢æˆ·ç«¯åˆ†åˆ«ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥ã€‚</p>
<p>æ„å»ºä¸€ä¸ªOpenVPN 2.xé…ç½®çš„ç¬¬ä¸€ä¸ªæ­¥éª¤æ˜¯å»ºç«‹ä¸€ä¸ªPKI(public key infrastructure)ã€‚è¯¥PKIåŒ…å«ï¼š</p>
<ul>
<li>
<p>æœåŠ¡å™¨å’Œæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½è¦æœ‰ä¸€ä¸ªå•ç‹¬çš„è¯ä¹¦(ä¹Ÿå«åšå…¬é’¥)å’Œç§é’¥ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªmaster CA (Certificate Authority)è¯ä¹¦å’Œå¯†é’¥ï¼Œç”¨äºä¸ºæ¯ä¸€ä¸ªæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯ä¹¦ç­¾åã€‚</p>
</li>
</ul>
<p>OpenVPNæ”¯æŒåŸºäºè¯ä¹¦çš„åŒå‘è®¤è¯ï¼Œè¿™æ„å‘³ç€ï¼Œåœ¨å»ºç«‹ç›¸äº’ä¿¡ä»»ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å¿…é¡»è®¤è¯æœåŠ¡å™¨è¯ä¹¦ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¿…é¡»è®¤è¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åœ¨è®¤è¯å½¼æ­¤æ—¶ï¼Œä¼šé¦–å…ˆéªŒè¯å¯¹æ–¹å‘ˆç°çš„è¯ä¹¦æ˜¯å¦ç”±master CAç­¾åï¼Œç„¶åæµ‹è¯•è¯ä¹¦æŠ¥å¤´ä¸­çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯ä¹¦common nameæˆ–è¯ä¹¦ç±»å‹(å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨)ã€‚</p>
<p>æ³¨æ„ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ—¶é’Ÿéœ€è¦åŸºæœ¬åŒæ­¥ï¼Œå¦åˆ™è¯ä¹¦å¯èƒ½ä¸ä¼šæ­£å¸¸å·¥ä½œã€‚</p>
<h4 id="ç”Ÿæˆcaçš„è¯ä¹¦å¯†é’¥">ç”ŸæˆCAçš„è¯ä¹¦&amp;å¯†é’¥</h4>
<p>ç”Ÿæˆä¸€ä¸ªmaster CAè¯ä¹¦å’Œå¯†é’¥ï¼Œä¸€ä¸ªæœåŠ¡å™¨è¯ä¹¦å’Œå¯†é’¥ï¼Œå’Œä¸º3ä¸ªä¸åŒçš„å®¢æˆ·ç«¯ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥ã€‚</p>
<p>å¯¹äºPKIç®¡ç†ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨easy-rsa 2ï¼Œè¿™æ˜¯ä¸OpenVPN 2.2.xå’Œä¹‹å‰çš„ç‰ˆæœ¬ç»‘å®šçš„ä¸€ä¸ªè„šæœ¬é›†åˆã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯OpenVPN 2.3.xï¼Œä½ éœ€è¦å•ç‹¬ä»<a class="link" href="https://github.com/OpenVPN/easy-rsa-old"  target="_blank" rel="noopener"
    >easy-rsa-old</a>é¡¹ç›®é¡µé¢ä¸‹è½½easy-rsa 2ã€‚è€Œåœ¨*NIXå¹³å°ä¸Šï¼Œä½ åº”è¯¥ä½¿ç”¨<a class="link" href="https://github.com/OpenVPN/easy-rsa"  target="_blank" rel="noopener"
    >easy-rsa 3</a>ï¼Œå‚è€ƒå®ƒçš„æ–‡æ¡£ä»¥äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@gw ~<span class="o">]</span><span class="c1"># yum install easy-rsa</span>
</span></span><span class="line"><span class="cl">å°†æ•´ä¸ªeasy-rsaçš„ç›®å½•æ‹·è´åˆ°å¦ä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ¯”å¦‚/etc/openvpnï¼Œè¿™æ ·æœªæ¥å‡çº§OpenVPNåŒ…æ—¶ä¸ä¼šè¦†ç›–ä½ çš„ä¿®æ”¹ã€‚
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@gw ~<span class="o">]</span><span class="c1"># cp -ar /usr/share/easy-rsa /etc/openvpn</span>
</span></span><span class="line"><span class="cl">ç”Ÿæˆå˜é‡é…ç½®æ–‡ä»¶ï¼š
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@gw ~<span class="o">]</span><span class="c1"># cp /usr/share/doc/easy-rsa-3.0.3/vars.example /etc/openvpn/easy-rsa/3.0.3/vars</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¯ä»¥åœ¨varsä¸­è®¾ç½®è¯ä¹¦æœ‰æ•ˆæœŸ
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@gw ~<span class="o">]</span><span class="c1"># vim vars</span>
</span></span><span class="line"><span class="cl"><span class="c1">#é…ç½®ä¸€ä¸‹ç›¸å…³çš„ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KEY_COUNTRY</span><span class="o">=</span><span class="s2">&#34;CN&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KEY_PROVINCE</span><span class="o">=</span><span class="s2">&#34;ShangHai&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KEY_CITY</span><span class="o">=</span><span class="s2">&#34;ShangHai&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KEY_ORG</span><span class="o">=</span><span class="s2">&#34;YCZB&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KEY_EMAIL</span><span class="o">=</span><span class="s2">&#34;heian@heian.com&#34;</span>
</span></span><span class="line"><span class="cl">set_var EASYRSA_CA_EXPIRE       <span class="m">3650</span>                                      // CAè¯ä¹¦çš„é»˜è®¤æœ‰æ•ˆæœŸ
</span></span><span class="line"><span class="cl">set_var EASYRSA_CERT_EXPIRE     <span class="m">3650</span>                                      // CAç­¾å‘çš„è¯ä¹¦çš„é»˜è®¤æœ‰æ•ˆæœŸ
</span></span><span class="line"><span class="cl">set_var EASYRSA_CRL_DAYS        <span class="m">3650</span>       // è²Œä¼¼å¦‚æœCRLæ–‡ä»¶åœ¨è¯¥æ—¶é—´å†…éƒ½æœªä¿®æ”¹è¿‡çš„è¯ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½å°†æ— æ³•è¿æ¥
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿›å…¥easy-rsaçš„ç›®å½•ï¼Œåˆå§‹åŒ–ç¯å¢ƒï¼š
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /etc/openvpn/easy-rsa/3.0.3/
</span></span><span class="line"><span class="cl"><span class="nb">source</span> ./vars
</span></span><span class="line"><span class="cl"> ./easyrsa init-pki   <span class="c1">#åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„PKIï¼Œå…¶å®å°±æ˜¯ç§»é™¤å¹¶é‡æ–°åˆ›å»ºpkiç›®å½•ç»“æ„</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">åˆ›å»ºCAè¯ä¹¦å’Œå¯†é’¥å¯¹ï¼š
</span></span><span class="line"><span class="cl"> ./easyrsa build-ca nopass
</span></span><span class="line"><span class="cl"> <span class="c1"># build-caå‘½ä»¤åˆ›å»ºCAè¯ä¹¦å’Œå¯†é’¥å¯¹ã€‚nopassé€‰é¡¹è¡¨ç¤ºä¸å¯¹CAå¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚nopass é…ç½®æ— å¯†ç ã€‚</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®å¯†ç ã€‚åœ¨ç”Ÿæˆè¯ä¹¦ã€å¯†é’¥çš„æ—¶å€™ï¼Œä¼šè¦æ±‚è¾“å…¥è¯¥CAå¯†é’¥çš„å¯†ç ã€‚</span>
</span></span><span class="line"><span class="cl"> ç°åœ¨ï¼Œå·²ç»ç”Ÿæˆäº†CAçš„è¯ä¹¦æ–‡ä»¶pki/ca.crtå’Œç§é’¥æ–‡ä»¶pki/private/ca.keyã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Generating a <span class="m">2048</span> bit RSA private key
</span></span><span class="line"><span class="cl">.................................+++
</span></span><span class="line"><span class="cl">...............+++
</span></span><span class="line"><span class="cl">writing new private key to <span class="s1">&#39;/etc/openvpn/easy-rsa/3.0.3/pki/private/ca.key.lhgETNINjO&#39;</span>
</span></span><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">You are about to be asked to enter information that will be incorporated
</span></span><span class="line"><span class="cl">into your certificate request.
</span></span><span class="line"><span class="cl">What you are about to enter is what is called a Distinguished Name or a DN.
</span></span><span class="line"><span class="cl">There are quite a few fields but you can leave some blank
</span></span><span class="line"><span class="cl">For some fields there will be a default value,
</span></span><span class="line"><span class="cl">If you enter <span class="s1">&#39;.&#39;</span>, the field will be left blank.
</span></span><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">Common Name <span class="o">(</span>eg: your user, host, or server name<span class="o">)</span> <span class="o">[</span>Easy-RSA CA<span class="o">]</span>:Guowei_CA       <span class="c1">#è¾“å…¥ç”¨äºè¾¨è¯†çš„ä¸€ä¸ªåç§° </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CA creation <span class="nb">complete</span> and you may now import and sign cert requests.
</span></span><span class="line"><span class="cl">Your new CA certificate file <span class="k">for</span> publishing is at:
</span></span><span class="line"><span class="cl">/etc/openvpn/easy-rsa/3.0.3/pki/ca.crt
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œå·²ç»ç”Ÿæˆäº†CAçš„è¯ä¹¦æ–‡ä»¶pki/ca.crtå’Œç§é’¥æ–‡ä»¶pki/private/ca.keyã€‚</p>
<h4 id="ç”ŸæˆæœåŠ¡ç«¯çš„è¯ä¹¦å¯†é’¥">ç”ŸæˆæœåŠ¡ç«¯çš„è¯ä¹¦&amp;å¯†é’¥</h4>
<p>ç”ŸæˆOpenVPNæœåŠ¡ç«¯çš„è¯ä¹¦å’Œå¯†é’¥å¯¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./easyrsa build-server-full server nopass
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># build-server-fullå‘½ä»¤ç”ŸæˆæœåŠ¡ç«¯çš„è¯ä¹¦å’Œå¯†é’¥å¯¹ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1"># serverå‚æ•°æ˜¯ç”Ÿæˆè¯ä¹¦æ—¶ç”¨çš„Common Nameï¼Œå»ºè®®å°±ä½¿ç”¨serverã€‚nopassé€‰é¡¹è¡¨ç¤ºä¸å¯¹å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Generating a <span class="m">2048</span> bit RSA private key
</span></span><span class="line"><span class="cl">..+++
</span></span><span class="line"><span class="cl">................+++
</span></span><span class="line"><span class="cl">writing new private key to <span class="s1">&#39;/etc/openvpn/easy-rsa/3.0.3/pki/private/server.key.gYkfUBDAFl&#39;</span>
</span></span><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">Using configuration from ./openssl-1.0.cnf
</span></span><span class="line"><span class="cl">Check that the request matches the signature
</span></span><span class="line"><span class="cl">Signature ok
</span></span><span class="line"><span class="cl">The Subject<span class="s1">&#39;s Distinguished Name is as follows
</span></span></span><span class="line"><span class="cl"><span class="s1">commonName            :ASN.1 12:&#39;</span>server<span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">Certificate is to be certified <span class="k">until</span> Aug <span class="m">12</span> 01:22:27 <span class="m">2028</span> GMT <span class="o">(</span><span class="m">3650</span> days<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Write out database with <span class="m">1</span> new entries
</span></span><span class="line"><span class="cl">Data Base Updated
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œå·²ç»ç”Ÿæˆäº†æœåŠ¡ç«¯çš„è¯ä¹¦æ–‡ä»¶pki/issued/server.crtå’Œç§é’¥æ–‡ä»¶pki/private/server.keyã€‚å¹¶ä¸”ï¼Œç”Ÿæˆçš„æœåŠ¡ç«¯è¯ä¹¦å·²ç»æ˜¯ç»è¿‡å…ˆå‰çš„CAå¯†é’¥ç­¾åçš„äº†ã€‚</p>
<h4 id="ç”Ÿæˆå®¢æˆ·ç«¯çš„è¯ä¹¦å¯†é’¥">ç”Ÿæˆå®¢æˆ·ç«¯çš„è¯ä¹¦&amp;å¯†é’¥</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./easyrsa build-client-full clientname nopass
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># build-client-fullå‘½ä»¤ç”Ÿæˆå®¢æˆ·ç«¯çš„è¯ä¹¦å’Œå¯†é’¥å¯¹ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1"># client1å‚æ•°æ˜¯ç”Ÿæˆè¯ä¹¦æ—¶ç”¨çš„Common Nameã€‚nopassé€‰é¡¹è¡¨ç¤ºä¸å¯¹å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Generating a <span class="m">2048</span> bit RSA private key
</span></span><span class="line"><span class="cl">......................................+++
</span></span><span class="line"><span class="cl">............................................................................+++
</span></span><span class="line"><span class="cl">writing new private key to <span class="s1">&#39;/etc/openvpn/easy-rsa/3.0.3/pki/private/client1.key.wQ7i2qbP93&#39;</span>
</span></span><span class="line"><span class="cl">-----
</span></span><span class="line"><span class="cl">Using configuration from ./openssl-1.0.cnf
</span></span><span class="line"><span class="cl">Check that the request matches the signature
</span></span><span class="line"><span class="cl">Signature ok
</span></span><span class="line"><span class="cl">The Subject<span class="s1">&#39;s Distinguished Name is as follows
</span></span></span><span class="line"><span class="cl"><span class="s1">commonName            :ASN.1 12:&#39;</span>client1<span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">Certificate is to be certified <span class="k">until</span> Aug <span class="m">12</span> 02:08:02 <span class="m">2028</span> GMT <span class="o">(</span><span class="m">3650</span> days<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Write out database with <span class="m">1</span> new entries
</span></span><span class="line"><span class="cl">Data Base Updated
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œå·²ç»ç”Ÿæˆäº†æœåŠ¡ç«¯çš„è¯ä¹¦æ–‡ä»¶pki/issued/client1.crtå’Œç§é’¥æ–‡ä»¶pki/private/client1.keyã€‚å¹¶ä¸”ï¼Œç”Ÿæˆçš„å®¢æˆ·ç«¯è¯ä¹¦å·²ç»æ˜¯ç»è¿‡å…ˆå‰çš„CAå¯†é’¥ç­¾åçš„äº†ã€‚</p>
<p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºclient2ã€client3ç­‰åˆ†åˆ«ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥å¯¹ã€‚æ€»æ˜¯ä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ä¸€ä¸ªå”¯ä¸€çš„Common Nameã€‚</p>
<h4 id="ç”Ÿæˆdiffie-hellmanå‚æ•°">ç”ŸæˆDiffie Hellmanå‚æ•°</h4>
<p>æˆ‘ä»¬éœ€è¦ä¸ºOpenVPNæœåŠ¡ç«¯ç”Ÿæˆ<a class="link" href="http://www.rsasecurity.com/rsalabs/node.asp?id=2248"  target="_blank" rel="noopener"
    >Diffie Hellman</a>å‚æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./easyrsa gen-dh     
</span></span><span class="line"><span class="cl">Generating DH parameters, <span class="m">2048</span> bit long safe prime, generator <span class="m">2</span>
</span></span><span class="line"><span class="cl">This is going to take a long <span class="nb">time</span>
</span></span><span class="line"><span class="cl">......................................................................+.......+...........................+......................................+................................................+....+..............................................................................................................................................................................
</span></span><span class="line"><span class="cl">DH parameters of size <span class="m">2048</span> created at /etc/openvpn/easy-rsa/3.0.3/pki/dh.pem
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œå·²ç»ç”Ÿæˆäº†Diffie Hellmanå‚æ•°æ–‡ä»¶pki/dh.pemã€‚</p>
<h4 id="ç”Ÿæˆtls-auth-key">ç”Ÿæˆtls-auth key</h4>
<p>ç”Ÿæˆtls-auth keyï¼Œä¸ºäº†é˜²æ­¢DDOSå’ŒTLSæ”»å‡»ï¼Œè¿™ä¸ªå±äºå¯é€‰å®‰å…¨é…ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openvpn --genkey --secret ta.key
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æœåŠ¡ç«¯å’Œåˆ›å»ºé…ç½®æ–‡ä»¶">æœåŠ¡ç«¯å’Œåˆ›å»ºé…ç½®æ–‡ä»¶</h2>
<p>OpenVPNè½¯ä»¶åŒ…è‡ªå¸¦äº†ä¸€äº›ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ä½¿ç”¨rpmåŒ…å®‰è£…çš„ï¼Œå¯ä»¥åœ¨/usr/share/doc/openvpn-2.4.6/sample/sample-config-files/ç›®å½•ä¸‹æ‰¾åˆ°ï¼š</p>
<p><img src="/../../image/image-20220701153303964.png"
	
	
	
	loading="lazy"
	
		alt="image-20220701153303964"
	
	
></p>
<p>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶åˆ†åˆ«æ˜¯server.confå’Œclient.conf</p>
<h3 id="è¯ä¹¦ç›®å½•ä¼˜åŒ–">è¯ä¹¦ç›®å½•ä¼˜åŒ–</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># mkdir /etc/openvpn/server/certs &amp;&amp; cd /etc/openvpn/server/certs</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cp /etc/openvpn/easy-rsa/pki/dh.pem ./</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cp /etc/openvpn/easy-rsa/pki/ca.crt ./</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cp /etc/openvpn/easy-rsa/pki/issued/server.crt ./</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cp /etc/openvpn/easy-rsa/pki/private/server.key ./</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cp /etc/openvpn/easy-rsa/ta.key ./</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="serveræœåŠ¡å™¨é…ç½®æ–‡ä»¶">ServeræœåŠ¡å™¨é…ç½®æ–‡ä»¶</h3>
<p>OpenVPNè½¯ä»¶åŒ…è‡ªå¸¦çš„æœåŠ¡å™¨ç¤ºä¾‹é…ç½®æ–‡ä»¶å¾ˆé€‚åˆç”¨æ¥ç”ŸæˆçœŸæ­£ä½¿ç”¨çš„æœåŠ¡å™¨é…ç½®æ–‡ä»¶ã€‚å®ƒä¼šåˆ›å»ºä¸€ä¸ªVPNï¼Œä½¿ç”¨ä¸€ä¸ªè™šæ‹Ÿçš„TUNç½‘ç»œæ¥å£(ç”¨äºè·¯ç”±)ï¼Œä¼šåœ¨UDPç«¯å£1194(OpenVPNçš„å®˜æ–¹ç«¯å£å·)ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶åˆ†å‘10.8.0.0/24å­ç½‘ä¸­çš„è™šæ‹Ÿåœ°å€ç»™è¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯ã€‚</p>
<p>åœ¨ä½ ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œä½ åº”è¯¥ä¿®æ”¹è¯¥é…ç½®æ–‡ä»¶ä¸­çš„caã€certã€keyå’Œdhé€‰é¡¹ï¼Œè®©å®ƒä»¬æŒ‡å‘å„è‡ªçš„æ–‡ä»¶(æˆ‘ä»¬å…ˆå‰ç”Ÿæˆçš„)ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#å¯åŠ¨çš„ç«¯å£</span>
</span></span><span class="line"><span class="cl">port <span class="m">1194</span>
</span></span><span class="line"><span class="cl"><span class="c1">#ä½¿ç”¨çš„tcpåè®®</span>
</span></span><span class="line"><span class="cl">proto tcp
</span></span><span class="line"><span class="cl"><span class="c1">## &#34;dev tun&#34;å°†ä¼šåˆ›å»ºä¸€ä¸ªè·¯ç”±IPéš§é“</span>
</span></span><span class="line"><span class="cl">dev tun
</span></span><span class="line"><span class="cl"><span class="c1"># ç”Ÿæˆçš„caè¯ä¹¦</span>
</span></span><span class="line"><span class="cl">ca /etc/openvpn/server/certs/ca.crt
</span></span><span class="line"><span class="cl"><span class="c1">#æœåŠ¡ç«¯çš„è¯ä¹¦</span>
</span></span><span class="line"><span class="cl">cert /etc/openvpn/server/certs/server.crt
</span></span><span class="line"><span class="cl"><span class="c1">#æœåŠ¡ç«¯çš„å¯†é’¥</span>
</span></span><span class="line"><span class="cl">key /etc/openvpn/server/certs/server.key
</span></span><span class="line"><span class="cl"><span class="c1">#Diffie-Hellmanå¯†é’¥äº¤æ¢ æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">dh /etc/openvpn/server/certs/dh.pem
</span></span><span class="line"><span class="cl"><span class="c1">#openvpn serverçš„è™šæ‹Ÿipç½‘æ®µ</span>
</span></span><span class="line"><span class="cl">server 192.168.255.0 255.255.255.0
</span></span><span class="line"><span class="cl"><span class="c1">#routeæ§åˆ¶äº†ä»å†…æ ¸åˆ°OpenVPNæœåŠ¡å™¨(é€šè¿‡TUNæ¥å£)çš„è·¯ç”±</span>
</span></span><span class="line"><span class="cl"><span class="c1">### å…·ä½“ä¸‹ä¸€è·³æ˜¯å“ªé‡Œï¼Œç”± client-config é‡Œçš„ iroute æŒ‡å®š</span>
</span></span><span class="line"><span class="cl">route 10.0.0.0 255.0.0.0
</span></span><span class="line"><span class="cl"><span class="c1"># åœ¨æ­¤æ–‡ä»¶ä¸­ç»´æŠ¤å®¢æˆ·ç«¯ä¸è™šæ‹ŸIPåœ°å€ä¹‹é—´çš„å…³è”è®°å½•</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœOpenVPNé‡å¯ï¼Œé‡æ–°è¿æ¥çš„å®¢æˆ·ç«¯å¯ä»¥è¢«åˆ†é…åˆ°å…ˆå‰åˆ†é…çš„è™šæ‹ŸIPåœ°å€</span>
</span></span><span class="line"><span class="cl">ifconfig-pool-persist /etc/openvpn/server/ipp.txt
</span></span><span class="line"><span class="cl"><span class="c1">#ä¸‹é¢æ˜¯å®šä¹‰æœåŠ¡å™¨è¯»å–ç‰¹æ®Šå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶çš„ç›®å½•ä¸ºccdï¼›</span>
</span></span><span class="line"><span class="cl">client-config-dir /etc/openvpn/ccd
</span></span><span class="line"><span class="cl"><span class="c1">#å…è®¸å®¢æˆ·ç«¯å­ç½‘äº’é€š</span>
</span></span><span class="line"><span class="cl">client-to-client
</span></span><span class="line"><span class="cl"><span class="c1"># keepaliveæŒ‡ä»¤å°†å¯¼è‡´ç±»ä¼¼äºpingå‘½ä»¤çš„æ¶ˆæ¯è¢«æ¥å›å‘é€ï¼Œä»¥ä¾¿äºæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çŸ¥é“å¯¹æ–¹ä½•æ—¶è¢«å…³é—­</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ¯10ç§’é’Ÿpingä¸€æ¬¡ï¼Œå¦‚æœ120ç§’å†…éƒ½æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„å›å¤ï¼Œåˆ™è¡¨ç¤ºè¿œç¨‹è¿æ¥å·²ç»å…³é—­</span>
</span></span><span class="line"><span class="cl">keepalive <span class="m">10</span> <span class="m">120</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æœåŠ¡å™¨å’Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦æ‹¥æœ‰è¯¥å¯†é’¥çš„ä¸€ä¸ªæ‹·è´</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç¬¬äºŒä¸ªå‚æ•°åœ¨æœåŠ¡å™¨ç«¯åº”è¯¥ä¸º&#39;0&#39;ï¼Œåœ¨å®¢æˆ·ç«¯åº”è¯¥ä¸º&#39;1&#39;</span>
</span></span><span class="line"><span class="cl">tls-auth /etc/openvpn/server/certs/ta.key <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># é€‰æ‹©ä¸€ä¸ªå¯†ç åŠ å¯†ç®—æ³•ï¼Œè¯¥é…ç½®é¡¹ä¹Ÿå¿…é¡»å¤åˆ¶åˆ°æ¯ä¸ªå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­</span>
</span></span><span class="line"><span class="cl">cipher AES-256-CBC
</span></span><span class="line"><span class="cl"><span class="c1"># æŒä¹…åŒ–é€‰é¡¹å¯ä»¥å°½é‡é¿å…è®¿é—®é‚£äº›åœ¨é‡å¯ä¹‹åç”±äºç”¨æˆ·æƒé™é™ä½è€Œæ— æ³•è®¿é—®çš„æŸäº›èµ„æº</span>
</span></span><span class="line"><span class="cl">persist-key
</span></span><span class="line"><span class="cl">persist-tun
</span></span><span class="line"><span class="cl"><span class="c1">#æ—¥å¿—æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">status /var/log/openvpn-status.log
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸ºæ—¥å¿—æ–‡ä»¶è®¾ç½®é€‚å½“çš„å†—ä½™çº§åˆ«(0~9)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å†—ä½™çº§åˆ«è¶Šé«˜ï¼Œè¾“å‡ºçš„ä¿¡æ¯è¶Šè¯¦ç»†</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0 è¡¨ç¤ºé™é»˜è¿è¡Œï¼Œåªè®°å½•è‡´å‘½é”™è¯¯</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4 è¡¨ç¤ºåˆç†çš„å¸¸è§„ç”¨æ³•</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 5å’Œ6 å¯ä»¥å¸®åŠ©è°ƒè¯•è¿æ¥é”™è¯¯</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 9 è¡¨ç¤ºæåº¦å†—ä½™ï¼Œè¾“å‡ºéå¸¸è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">verb <span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="c1"># é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå½“æœåŠ¡å™¨é‡æ–°å¯åŠ¨æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é‡æ–°è¿æ¥</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åªèƒ½æ˜¯UDPåè®®ä½¿ç”¨ï¼ŒTCPä½¿ç”¨çš„è¯ä¸èƒ½å¯åŠ¨æœåŠ¡</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æµ‹è¯•éœ€è¦pushåˆ°å®¢æˆ·ç«¯æ‰æœ‰æ•ˆæœ</span>
</span></span><span class="line"><span class="cl"><span class="c1">#explicit-exit-notify 1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">explicit-exit-notify <span class="m">1</span>
</span></span><span class="line"><span class="cl">script-security <span class="m">2</span>
</span></span><span class="line"><span class="cl">client-connect /etc/openvpn/script/connect.sh
</span></span><span class="line"><span class="cl">client-disconnect /etc/openvpn/script/disconnect.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>connect.sh</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">Time</span><span class="o">=</span><span class="sb">`</span>date +%F<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -f /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">  touch /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;`date &#39;+%F %H:%M:%S&#39;` User </span><span class="nv">$common_name</span><span class="s2"> trust_ip </span><span class="nv">$trusted_ip</span><span class="s2"> is login,Remote_ip is </span><span class="nv">$ifconfig_pool_remote_ip</span><span class="s2">, Mask is </span><span class="nv">$route_netmask_1</span><span class="s2">&#34;</span> &gt;&gt; /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  touch /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;`date &#39;+%F %H:%M:%S&#39;` User </span><span class="nv">$common_name</span><span class="s2"> trust_ip </span><span class="nv">$trusted_ip</span><span class="s2"> is login,Remote_ip is </span><span class="nv">$ifconfig_pool_remote_ip</span><span class="s2">, Mask is </span><span class="nv">$route_netmask_1</span><span class="s2">&#34;</span> &gt;&gt; /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>disconnect.sh</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">Time</span><span class="o">=</span><span class="sb">`</span>date +%F<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -f /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">  touch /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;`date &#39;+%F %H:%M:%S&#39;` User </span><span class="nv">$common_name</span><span class="s2"> trust_ip </span><span class="nv">$trusted_ip</span><span class="s2"> is logout,Remote_ip is </span><span class="nv">$ifconfig_pool_remote_ip</span><span class="s2">, Mask is </span><span class="nv">$route_netmask_1</span><span class="s2">&#34;</span> &gt;&gt; /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  touch /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;`date &#39;+%F %H:%M:%S&#39;` User </span><span class="nv">$common_name</span><span class="s2"> trust_ip </span><span class="nv">$trusted_ip</span><span class="s2"> is logout,Remote_ip is </span><span class="nv">$ifconfig_pool_remote_ip</span><span class="s2">, Mask is </span><span class="nv">$route_netmask_1</span><span class="s2">&#34;</span> &gt;&gt; /etc/openvpn/log/openvpn_<span class="nv">$Time</span>.log
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¼€å¯forwardè½¬å‘">å¼€å¯forwardè½¬å‘</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl stop firewalld
</span></span><span class="line"><span class="cl">systemctl mask firewalld
</span></span><span class="line"><span class="cl">setenforce 0				<span class="c1"># ä¸´æ—¶å…³é—­</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span> /etc/selinux/config	
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> net.ipv4.ip_forward <span class="o">=</span> <span class="m">1</span> &gt;&gt;/etc/sysctl.conf
</span></span><span class="line"><span class="cl">sysctl -p
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é…ç½®iptablesè§„åˆ™">é…ç½®iptablesè§„åˆ™</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl <span class="nb">enable</span> iptables
</span></span><span class="line"><span class="cl">systemctl start iptables
</span></span><span class="line"><span class="cl">iptables -F   <span class="c1"># æ¸…ç†æ‰€æœ‰é˜²ç«å¢™è§„åˆ™</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°† openvpn çš„ç½‘ç»œæµé‡è½¬å‘åˆ°å…¬ç½‘ï¼šsnat è§„åˆ™</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å¦‚ä¸‹ç½‘æ®µè®°å¾—ä¸server.conf å½“ä¸­å®šä¹‰çš„ç½‘æ®µä¿æŒä¸€è‡´</span>
</span></span><span class="line"><span class="cl">iptables -t nat -A POSTROUTING -s 10.0.0.0/8 -o eth0 -j MASQUERADE
</span></span><span class="line"><span class="cl">iptables -L -t nat
</span></span><span class="line"><span class="cl">iptables-save &gt; /etc/sysconfig/iptables   <span class="c1"># iptables è§„åˆ™æŒä¹…åŒ–ä¿å­˜</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">æŠŠiptablesè§„åˆ™å¤‡ä»½åˆ°/etc/sysconfig/iptablesæ–‡ä»¶ä¸­
</span></span><span class="line"><span class="cl">iptables-save &gt; /etc/sysconfig/iptables
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ¢å¤åˆšæ‰å¤‡ä»½çš„è§„åˆ™
</span></span><span class="line"><span class="cl">iptables-restore &lt; /etc/sysconfig/iptables
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘æµ‹è¯•ç¯å¢ƒçš„iptablesé…ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[dev][root@foxconn-vpn-192.168.83.44 backup_openvpn]# cat /etc/sysconfig/iptables
</span></span><span class="line"><span class="cl"># Generated by iptables-save v1.4.21 on Thu May  6 14:02:02 2021
</span></span><span class="line"><span class="cl">*nat
</span></span><span class="line"><span class="cl">:PREROUTING ACCEPT [4743102:251117700]
</span></span><span class="line"><span class="cl">:INPUT ACCEPT [2104299:126313633]
</span></span><span class="line"><span class="cl">:OUTPUT ACCEPT [54995:3991628]
</span></span><span class="line"><span class="cl">:POSTROUTING ACCEPT [25003:2044398]
</span></span><span class="line"><span class="cl">:l - [0:0]
</span></span><span class="line"><span class="cl">#è¡¨ç¤ºèµ° 10.0.0.0/8æ•°æ®çš„æºIPéƒ½è½¬æ¢tun0è¿™ä¸ªæ¥å£çš„IPç„¶åè½¬å‘å‡ºå»ã€‚
</span></span><span class="line"><span class="cl">-A POSTROUTING -d 10.0.0.0/8 -o tun0 -j MASQUERADE
</span></span><span class="line"><span class="cl">#è¡¨ç¤ºèµ° 192.168.0.0/16æ•°æ®çš„æºIPéƒ½è½¬æ¢eth0è¿™ä¸ªæ¥å£çš„IPç„¶åè½¬å‘å‡ºå»ã€‚
</span></span><span class="line"><span class="cl">-A POSTROUTING -d 192.168.0.0/16 -o eth0 -j MASQUERADE
</span></span><span class="line"><span class="cl">COMMIT
</span></span><span class="line"><span class="cl"># Completed on Thu May  6 14:02:02 2021
</span></span><span class="line"><span class="cl"># Generated by iptables-save v1.4.21 on Thu May  6 14:02:02 2021
</span></span><span class="line"><span class="cl">*filter
</span></span><span class="line"><span class="cl">:INPUT ACCEPT [431:383193]
</span></span><span class="line"><span class="cl">:FORWARD ACCEPT [512:393937]
</span></span><span class="line"><span class="cl">:OUTPUT ACCEPT [374:70793]
</span></span><span class="line"><span class="cl">-A FORWARD -d 10.128.199.248/32 -j DROP
</span></span><span class="line"><span class="cl">-A FORWARD -d 10.128.199.254/32 -j DROP
</span></span><span class="line"><span class="cl">COMMIT
</span></span><span class="line"><span class="cl"># Completed on Thu May  6 14:02:02 2021
</span></span><span class="line"><span class="cl"># Generated by iptables-save v1.4.21 on Thu May  6 14:02:02 2021
</span></span><span class="line"><span class="cl">*mangle
</span></span><span class="line"><span class="cl">:PREROUTING ACCEPT [64983188:19955544594]
</span></span><span class="line"><span class="cl">:INPUT ACCEPT [32316135:9267024863]
</span></span><span class="line"><span class="cl">:FORWARD ACCEPT [30855150:10615986243]
</span></span><span class="line"><span class="cl">:OUTPUT ACCEPT [31879646:5718904613]
</span></span><span class="line"><span class="cl">:POSTROUTING ACCEPT [62734647:16334877032]
</span></span><span class="line"><span class="cl">COMMIT
</span></span><span class="line"><span class="cl"># Completed on Thu May  6 14:02:02 2021
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç‰¹æ®Šå®¢æˆ·ç«¯é…ç½®ccd">ç‰¹æ®Šå®¢æˆ·ç«¯é…ç½®ccd</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>dev<span class="o">][</span>root@foxconn-vpn-192.168.83.44 ccd<span class="o">]</span><span class="c1"># pwd</span>
</span></span><span class="line"><span class="cl">/etc/openvpn/ccd
</span></span><span class="line"><span class="cl"><span class="o">[</span>dev<span class="o">][</span>root@foxconn-vpn-192.168.83.44 ccd<span class="o">]</span><span class="c1"># ls</span>
</span></span><span class="line"><span class="cl">lh.dmz
</span></span><span class="line"><span class="cl"><span class="o">[</span>dev<span class="o">][</span>root@foxconn-vpn-192.168.83.44 ccd<span class="o">]</span><span class="c1"># cat lh.dmz </span>
</span></span><span class="line"><span class="cl">iroute 10.0.0.0 255.0.0.0
</span></span><span class="line"><span class="cl"><span class="c1">#10.0.0.0/8å­ç½‘ç½‘æ®µåº”è¯¥è¢«è·¯ç”±åˆ°lh.dmz </span>
</span></span><span class="line"><span class="cl"><span class="c1">#irouteæ§åˆ¶äº†ä»OpenVPNæœåŠ¡å™¨åˆ°è¿œç¨‹å®¢æˆ·ç«¯çš„è·¯ç”±</span>
</span></span><span class="line"><span class="cl"><span class="c1">#å’Œå‰é¢server.conf é…ç½®ç›¸äº’ route 10.0.0.0 255.0.0.0 é…åˆ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ˜¯å¦å…è®¸client2å­ç½‘(10.0.0.0/8)å’Œå…¶å®ƒå®¢æˆ·ç«¯ä¹‹é—´çš„ç½‘ç»œæµé‡ã€‚å¦‚æœæ˜¯ï¼Œæ·»åŠ ä¸‹é¢çš„è¯­å¥åˆ°æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­ï¼š(ç›®å‰çš„ç¯å¢ƒæš‚æ—¶æ²¡æœ‰ç”¨åˆ°)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">client-to-client
</span></span><span class="line"><span class="cl">push &#34;route 10.0.0.0 255.0.0.0&#34;
</span></span><span class="line"><span class="cl">#è¿™ä¼šè®©OpenVPNæœåŠ¡å™¨é€šå‘Šclient2çš„å­ç½‘åˆ°å…¶å®ƒå®¢æˆ·ç«¯ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æœåŠ¡ç«¯è„šæœ¬é…ç½®">æœåŠ¡ç«¯è„šæœ¬é…ç½®</h3>
<h4 id="é’‰é’‰å‘é€æ¥å£è„šæœ¬">é’‰é’‰å‘é€æ¥å£è„šæœ¬</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/python</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hmac</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">signature</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">  <span class="n">timestamp</span> <span class="o">=</span> <span class="n">long</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="n">secret</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxx&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="n">secret_enc</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">string_to_sign</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\n</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">string_to_sign_enc</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">string_to_sign</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">hmac_code</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">secret_enc</span><span class="p">,</span> <span class="n">string_to_sign_enc</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">sign</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">hmac_code</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">timestamp</span><span class="p">,</span><span class="n">sign</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">Dingtalk_Push</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">msgtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="n">timestamp</span><span class="p">,</span><span class="n">sign</span><span class="p">)</span> <span class="o">=</span> <span class="n">signature</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json;charset=utf-8&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">token</span> <span class="o">=</span> <span class="s2">&#34;xxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&#34;https://oapi.dingtalk.com/robot/send?access_token=</span><span class="si">%s</span><span class="s2">&amp;timestamp=</span><span class="si">%s</span><span class="s2">&amp;sign=</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">timestamp</span><span class="p">,</span><span class="n">sign</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;msgtype&#34;</span><span class="p">:</span> <span class="s2">&#34;markdown&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;markdown&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;title&#34;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;text&#34;</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;at&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;isAtAll&#34;</span><span class="p">:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;/tmp/dd_notice.log&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_data</span><span class="p">),</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">title</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">message</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">Dingtalk_Push</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="çº¿è·¯æ£€æŸ¥-ä¸»å¤‡åˆ‡æ¢è„šæœ¬">çº¿è·¯æ£€æŸ¥-ä¸»å¤‡åˆ‡æ¢è„šæœ¬</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#Check To Fox Network Script</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PingCheck<span class="o">(){</span>
</span></span><span class="line"><span class="cl">  <span class="nv">ip</span><span class="o">=</span><span class="nv">$1</span>
</span></span><span class="line"><span class="cl">  <span class="nv">status_code</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> i in <span class="o">{</span>1..3<span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">    /usr/sbin/fping -c <span class="m">10</span> -t <span class="m">1</span> <span class="nv">$ip</span> &gt;/dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> !<span class="o">=</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">      <span class="nv">status_code</span><span class="o">=</span><span class="k">$(</span>expr <span class="nv">$status_code</span> + 1<span class="k">)</span> 
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="nv">$status_code</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CheckLine<span class="o">(){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -f /etc/openvpn/ccd/lh.fox <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;lh.fox&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> -f /etc/openvpn/ccd/lh.dmz <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;lh.dmz&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ChangeLine<span class="o">(){</span>
</span></span><span class="line"><span class="cl">  <span class="nv">S_Line</span><span class="o">=</span><span class="nv">$1</span>
</span></span><span class="line"><span class="cl">  <span class="nv">D_Line</span><span class="o">=</span><span class="nv">$2</span>
</span></span><span class="line"><span class="cl">  mv /etc/openvpn/ccd/<span class="nv">$S_Line</span> /etc/openvpn/ccd/<span class="nv">$D_Line</span> 
</span></span><span class="line"><span class="cl">  <span class="nb">kill</span> <span class="k">$(</span>ps -ef <span class="p">|</span>grep <span class="s2">&#34;/sbin/openvpn --daemo[n]&#34;</span><span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">  sleep <span class="m">3</span>
</span></span><span class="line"><span class="cl">  /sbin/openvpn --daemon --config /etc/openvpn/server.conf --log-append /var/log/openvpn.log 
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Start Check</span>
</span></span><span class="line"><span class="cl"><span class="nv">M_IP</span><span class="o">=</span><span class="s2">&#34;192.168.255.10&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">B_IP</span><span class="o">=</span><span class="s2">&#34;192.168.255.6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">M_S</span><span class="o">=</span><span class="k">$(</span>PingCheck <span class="nv">$M_IP</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">Line</span><span class="o">=</span><span class="k">$(</span>CheckLine<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$M_S</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;3&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$Line</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;lh.dmz&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nv">B_S</span><span class="o">=</span><span class="k">$(</span>PingCheck <span class="nv">$B_IP</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$B_S</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;3&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>date +<span class="s2">&#34;%Y/%m/%d %H:%M:%S&#34;</span><span class="k">)</span><span class="s2">\\\nå£¹åŸToå‚åŒºï¼šä¸»çº¿è·¯ä¸å¤‡ç”¨çº¿è·¯å‡å¼‚å¸¸&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>date +<span class="s2">&#34;%Y/%m/%d %H:%M:%S&#34;</span><span class="k">)</span><span class="s2">\\\nå£¹åŸToå‚åŒºï¼šä¸»çº¿è·¯å¼‚å¸¸ï¼Œåˆ‡æ¢å¤‡ç”¨çº¿è·¯&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  ChangeLine lh.dmz lh.fox  
</span></span><span class="line"><span class="cl">  /usr/bin/python /etc/openvpn/script/dd-notice.py <span class="s2">&#34;å£¹åŸToå‚åŒºç½‘ç»œå‘Šè­¦&#34;</span> <span class="s2">&#34;</span><span class="nv">$msg</span><span class="s2">&#34;</span> 
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$M_S</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$Line</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;lh.fox&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>date +<span class="s2">&#34;%Y/%m/%d %H:%M:%S&#34;</span><span class="k">)</span><span class="s2">\\\nå£¹åŸToå‚åŒºï¼šä¸»çº¿è·¯æ¢å¤ï¼Œåˆ‡å›ä¸»çº¿è·¯&#34;</span>
</span></span><span class="line"><span class="cl">  ChangeLine lh.fox lh.dmz 
</span></span><span class="line"><span class="cl">  /usr/bin/python /etc/openvpn/script/dd-notice.py <span class="s2">&#34;å£¹åŸToå‚åŒºç½‘ç»œå‘Šè­¦&#34;</span> <span class="s2">&#34;</span><span class="nv">$msg</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å®šæ—¶ä»»åŠ¡">å®šæ—¶ä»»åŠ¡</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">*/5 * * * * /bin/bash -x /etc/openvpn/script/check-network.sh &gt; /tmp/debug.log 2&gt;&amp;1
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="openvpnç®¡ç†è„šæœ¬ç¬¬ä¸€ç‰ˆ">openvpnç®¡ç†è„šæœ¬ï¼ˆç¬¬ä¸€ç‰ˆï¼‰</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nv">USER</span><span class="o">=</span><span class="nv">$2</span>
</span></span><span class="line"><span class="cl"><span class="nv">PASS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">@xxxx.com </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&#34;</span><span class="p">|</span>md5sum <span class="p">|</span>cut -b 1-12<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">CA_PASS</span><span class="o">=</span><span class="s2">&#34;xxxxx.88&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">OVDIR</span><span class="o">=</span><span class="s2">&#34;/etc/openvpn&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">SER_ERSA</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">OVDIR</span><span class="si">}</span><span class="s2">/easy-rsa/3.0.6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">CLI_ERSA</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">OVDIR</span><span class="si">}</span><span class="s2">/easy-rsa/3.0.6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">KEYS_DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">OVDIR</span><span class="si">}</span><span class="s2">/client&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">DB_FILE</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span><span class="s2">/pki/index.txt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -f /bin/expect <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;expect is not installed, start the installation...&#34;</span>
</span></span><span class="line"><span class="cl">  yum -y install expect
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> !<span class="o">=</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">     <span class="nb">echo</span> <span class="s2">&#34;Installation failed, please install manually&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> GenerateAkey<span class="o">(){</span>
</span></span><span class="line"><span class="cl">  <span class="nv">rlist</span><span class="o">=</span><span class="k">$(</span>find /etc/openvpn/ -name <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">*&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$rlist</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;ç”¨æˆ·: </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2"> å·²å­˜åœ¨&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">CLI_ERSA</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">/bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa gen-req $USER
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter PEM pass phrase:&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Verifying - Enter PEM pass phrase&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Common Name&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> GenerateAconf<span class="o">(){</span>
</span></span><span class="line"><span class="cl">cat &gt; <span class="si">${</span><span class="nv">KEYS_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>.ovpn <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">client
</span></span></span><span class="line"><span class="cl"><span class="s">dev tun
</span></span></span><span class="line"><span class="cl"><span class="s">proto udp
</span></span></span><span class="line"><span class="cl"><span class="s">remote xxx.xxx.xxx.xxx 1194
</span></span></span><span class="line"><span class="cl"><span class="s">resolv-retry infinite
</span></span></span><span class="line"><span class="cl"><span class="s">nobind
</span></span></span><span class="line"><span class="cl"><span class="s">persist-key
</span></span></span><span class="line"><span class="cl"><span class="s">persist-tun
</span></span></span><span class="line"><span class="cl"><span class="s">ca ca.crt
</span></span></span><span class="line"><span class="cl"><span class="s">cert ${USER}.crt
</span></span></span><span class="line"><span class="cl"><span class="s">key ${USER}.key
</span></span></span><span class="line"><span class="cl"><span class="s">remote-cert-tls server
</span></span></span><span class="line"><span class="cl"><span class="s">tls-auth ta.key 1
</span></span></span><span class="line"><span class="cl"><span class="s">cipher AES-256-CBC
</span></span></span><span class="line"><span class="cl"><span class="s">verb 3
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> ImportAkey<span class="o">(){</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">  ./easyrsa import-req <span class="si">${</span><span class="nv">CLI_ERSA</span><span class="si">}</span>/pki/reqs/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>.req <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa sign client $USER
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Confirm request details:&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;yes\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter pass phrase for&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${CA_PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> CreateUser<span class="o">(){</span>
</span></span><span class="line"><span class="cl">  GenerateAkey
</span></span><span class="line"><span class="cl">  ImportAkey
</span></span><span class="line"><span class="cl">  mkdir <span class="si">${</span><span class="nv">KEYS_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  cp <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/pki/issued/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>.crt <span class="si">${</span><span class="nv">KEYS_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">  cp <span class="si">${</span><span class="nv">CLI_ERSA</span><span class="si">}</span>/pki/private/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>.key <span class="si">${</span><span class="nv">KEYS_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">  cp <span class="si">${</span><span class="nv">OVDIR</span><span class="si">}</span>/<span class="o">{</span>ca.crt,ta.key<span class="o">}</span> <span class="si">${</span><span class="nv">KEYS_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">KEYS_DIR</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">  GenerateAconf
</span></span><span class="line"><span class="cl">  zip -r <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>.zip <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    rm -rf <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e <span class="s2">&#34;\033[32mPlease Download </span><span class="si">${</span><span class="nv">KEYS_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">.zip\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -f <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/pki/issued/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>.crt <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#/bin/python2.7 /etc/openvpn/script/mail.py reg ${USER} ${PASS} ${KEYS_DIR}/${USER}.zip</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;\033[32mSenMail To </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">@fujfu.com\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;\033[31mUser creation failed\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> RemoveUser<span class="o">(){</span>
</span></span><span class="line"><span class="cl">  <span class="nv">rlist</span><span class="o">=</span><span class="k">$(</span>find /etc/openvpn/ -name <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">*&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! -n <span class="s2">&#34;</span><span class="nv">$rlist</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;ç”¨æˆ·: </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2"> ä¸å­˜åœ¨&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="si">${</span><span class="nv">rlist</span><span class="si">}</span><span class="s2">\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">read</span> -p <span class="s2">&#34;ä¸Šè¿°æ–‡ä»¶å°†è¢«ç§»é™¤,è¯·ç¡®è®¤(yes/no): &#34;</span> yn
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$yn</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;yes&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> f in <span class="nv">$rlist</span><span class="p">;</span><span class="k">do</span>
</span></span><span class="line"><span class="cl">      rm -rf <span class="nv">$f</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="o">=</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="nv">$f</span><span class="s2">\033[0m       \033[32m[del]\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="nv">$f</span><span class="s2">\033[0m       \033[31m[fail]\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="k">fi</span>
</span></span><span class="line"><span class="cl">      sleep 0.5
</span></span><span class="line"><span class="cl">    <span class="k">done</span>
</span></span><span class="line"><span class="cl">    sed -i <span class="s2">&#34;/=</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>$<span class="s2">/d&#34;</span> <span class="si">${</span><span class="nv">DB_FILE</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="o">=</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">      <span class="nb">cd</span> <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">/bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa update-db
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter pass phrase for&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${CA_PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">      <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="si">${</span><span class="nv">DB_FILE</span><span class="si">}</span><span class="s2">\033[0m       \033[32m[update]\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="si">${</span><span class="nv">DB_FILE</span><span class="si">}</span><span class="s2">\033[0m       \033[32m[fail]\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>   
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> RevokeUser<span class="o">(){</span>
</span></span><span class="line"><span class="cl">  <span class="nv">rlist</span><span class="o">=</span><span class="k">$(</span>find /etc/openvpn/ -name <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">*&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! -n <span class="s2">&#34;</span><span class="nv">$rlist</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;ç”¨æˆ·: </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2"> ä¸å­˜åœ¨&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">/bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa revoke ${USER}
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Continue with revocation&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;yes\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter pass phrase for&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${CA_PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> Gencrl<span class="o">(){</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">/bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa gen-crl
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter pass phrase for&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${CA_PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">    start<span class="o">)</span>
</span></span><span class="line"><span class="cl">        /usr/sbin/openvpn --daemon --config /etc/openvpn/server.conf --log-append /var/log/openvpn.log
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    restart<span class="o">)</span>
</span></span><span class="line"><span class="cl">        /usr/bin/pkill --signal SIGHUP --exact openvpn
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    add<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">          CreateUser
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">          <span class="nb">echo</span> $<span class="s2">&#34;Usage: </span><span class="nv">$0</span><span class="s2"> add username&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    remove<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">          RevokeUser
</span></span><span class="line"><span class="cl">          Gencrl
</span></span><span class="line"><span class="cl">          RemoveUser
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">          <span class="nb">echo</span> $<span class="s2">&#34;Usage: </span><span class="nv">$0</span><span class="s2"> remove username&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    *<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> $<span class="s2">&#34;Usage: </span><span class="nv">$0</span><span class="s2"> {start|restart|add|remove} username&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="k">esac</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="openvpnç®¡ç†è„šæœ¬ç¬¬äºŒç‰ˆ">openvpnç®¡ç†è„šæœ¬ï¼ˆç¬¬äºŒç‰ˆï¼‰</h4>
<p>ä¸ºäº†ç®€åŒ–å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶çš„ç®¡ç†ï¼ŒOpenVPN æä¾›äº†ä¸€ç§ä¾¿æ·çš„å†…è”æ–‡ä»¶æ–¹å¼ï¼Œå…è®¸ç”¨æˆ·å°†æ ¹è¯ä¹¦ï¼ˆca.crtï¼‰ã€å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆclient.crtï¼‰ä»¥åŠå®¢æˆ·ç«¯ç§é’¥ï¼ˆclient.keyï¼‰ç­‰å¿…è¦æ–‡ä»¶ç›´æ¥åµŒå…¥åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç”¨æˆ·æ— éœ€åˆ†åˆ«ç®¡ç†å¤šä¸ªæ–‡ä»¶ï¼Œä»è€Œæé«˜äº†é…ç½®çš„ä¾¿æ·æ€§å’Œå®‰å…¨æ€§ã€‚ å…·ä½“æ¥è¯´ï¼Œç”¨æˆ·å¯ä»¥åœ¨OpenVPNçš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯.ovpnæ–‡ä»¶ï¼‰ä¸­ï¼Œé€šè¿‡ç‰¹å®šçš„æŒ‡ä»¤å°†è¿™äº›è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶çš„å†…å®¹ç›´æ¥åŒ…å«è¿›æ¥ã€‚è¿™æ ·ï¼Œå½“é…ç½®æ–‡ä»¶è¢«åŠ è½½æ—¶ï¼ŒOpenVPNä¼šè‡ªåŠ¨è¯»å–å¹¶åº”ç”¨è¿™äº›å†…è”çš„è¯ä¹¦å’Œå¯†é’¥ä¿¡æ¯ï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨æŒ‡å®šè¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶çš„è·¯å¾„ã€‚ è¿™ç§æ–¹æ³•ä¸ä»…ä½¿å¾—æ–‡ä»¶ç®¡ç†æ›´ä¸ºé›†ä¸­å’Œé«˜æ•ˆï¼Œè€Œä¸”ä¹Ÿå‡å°‘äº†é…ç½®é”™è¯¯çš„å¯èƒ½æ€§ï¼Œå› ä¸ºæ‰€æœ‰çš„ä¿¡æ¯éƒ½åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç”¨æˆ·åªéœ€ç»´æŠ¤ä¸€ä¸ªé…ç½®æ–‡ä»¶å³å¯ã€‚è¿™å¯¹äºç”¨æˆ·æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä¾¿åˆ©ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›éœ€è¦é¢‘ç¹éƒ¨ç½²å’Œæ›´æ–°VPNé…ç½®çš„åœºæ™¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">#è·å–ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°</span>
</span></span><span class="line"><span class="cl"><span class="nv">USER</span><span class="o">=</span><span class="nv">$2</span>
</span></span><span class="line"><span class="cl"><span class="nv">PASS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2"> </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&#34;</span> <span class="p">|</span> md5sum <span class="p">|</span> cut -b 1-12<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">CA_PASS</span><span class="o">=</span><span class="s2">&#34;xxxx.88&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">OVDIR</span><span class="o">=</span><span class="s2">&#34;/etc/openvpn&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">SER_ERSA</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">OVDIR</span><span class="si">}</span><span class="s2">/easy-rsa/3.0.6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">CLI_ERSA</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">OVDIR</span><span class="si">}</span><span class="s2">/easy-rsa/3.0.6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">KEYS_DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">OVDIR</span><span class="si">}</span><span class="s2">/client&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">DB_FILE</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span><span class="s2">/pki/index.txt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#åˆ¤æ–­æ˜¯å¦å®‰è£…expect</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -f /bin/expect <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;expect is not installed, start the installation...&#34;</span>
</span></span><span class="line"><span class="cl">    yum -y install expect
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> !<span class="o">=</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Installation failed, please install manually&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> GenerateAkey<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span>
</span></span><span class="line"><span class="cl">    <span class="nv">rlist</span><span class="o">=</span><span class="k">$(</span>find /etc/openvpn/ -name <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">*&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$rlist</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;ç”¨æˆ·: </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2"> å·²å­˜åœ¨&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> <span class="si">${</span><span class="nv">CLI_ERSA</span><span class="si">}</span>/ <span class="o">||</span> <span class="nb">exit</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ç”Ÿæˆå®¢æˆ·å•çš„è¯ä¹¦</span>
</span></span><span class="line"><span class="cl">    /bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa gen-req $USER
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter PEM pass phrase:&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Verifying - Enter PEM pass phrase&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Common Name&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">#ç”Ÿæˆå•ä¸ªé…ç½®æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">new_client<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Generates the custom client.ovpn</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        cat /etc/openvpn/server/client-common.txt
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&lt;ca&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        cat /etc/openvpn/easy-rsa/3.0.6/pki/ca.crt
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&lt;/ca&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&lt;cert&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        sed -ne <span class="s1">&#39;/BEGIN CERTIFICATE/,$ p&#39;</span> /etc/openvpn/easy-rsa/3.0.6/pki/issued/<span class="s2">&#34;</span><span class="nv">$USER</span><span class="s2">&#34;</span>.crt
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&lt;/cert&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&lt;key&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        cat /etc/openvpn/easy-rsa/3.0.6/pki/private/<span class="s2">&#34;</span><span class="nv">$USER</span><span class="s2">&#34;</span>.key
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&lt;/key&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;key-direction 1&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&lt;tls-auth&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        sed -ne <span class="s1">&#39;/BEGIN OpenVPN Static key/,$ p&#39;</span> /etc/openvpn/server/ta.key
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&lt;/tls-auth&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> &gt;~/<span class="s2">&#34;</span><span class="nv">$USER</span><span class="s2">&#34;</span>.ovpn
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> ImportAkey<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/ <span class="o">||</span> <span class="nb">exit</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#å¯¼å…¥clientç­¾çº¦è¯ä¹¦</span>
</span></span><span class="line"><span class="cl">    ./easyrsa import-req <span class="si">${</span><span class="nv">CLI_ERSA</span><span class="si">}</span>/pki/reqs/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>.req <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#ç»™clientç«¯è¯ä¹¦åšç­¾å</span>
</span></span><span class="line"><span class="cl">    /bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa sign client $USER
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Confirm request details:&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;yes\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter pass phrase for&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${CA_PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">#åˆ›å»ºè¯ä¹¦ç›®å½•ï¼Œè¿›è¡Œå½’çº³ å‹ç¼©ï¼Œå‘é€é‚®ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> CreateUser<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    GenerateAkey
</span></span><span class="line"><span class="cl">    ImportAkey
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">client
</span></span></span><span class="line"><span class="cl"><span class="s2">dev tun
</span></span></span><span class="line"><span class="cl"><span class="s2">proto tcp
</span></span></span><span class="line"><span class="cl"><span class="s2">remote xxx.xxx.xxx.xxx 11191
</span></span></span><span class="line"><span class="cl"><span class="s2">resolv-retry infinite
</span></span></span><span class="line"><span class="cl"><span class="s2">nobind
</span></span></span><span class="line"><span class="cl"><span class="s2">persist-key
</span></span></span><span class="line"><span class="cl"><span class="s2">persist-tun
</span></span></span><span class="line"><span class="cl"><span class="s2">remote-cert-tls server
</span></span></span><span class="line"><span class="cl"><span class="s2">cipher AES-256-CBC
</span></span></span><span class="line"><span class="cl"><span class="s2">block-outside-dns
</span></span></span><span class="line"><span class="cl"><span class="s2">verb 3&#34;</span> &gt;/etc/openvpn/server/client-common.txt
</span></span><span class="line"><span class="cl">    new_client
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;\033[32mPlease Download </span><span class="si">${</span><span class="nv">KEYS_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">-yc.zip\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#åˆ¤æ–­client ç”Ÿæˆæ–‡ä»¶å­˜åœ¨</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> -f <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/pki/issued/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>.crt <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#é€šè¿‡Pythonå‘é€é‚®ä»¶ ï¼ŒåŒ…å«è¯ä¹¦å’Œä½¿ç”¨æ–¹æ³•</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># /bin/python2.7 /etc/openvpn/script/mail.py ${USER} ${PASS} ${KEYS_DIR}/${USER}-yc.zip</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># /bin/python2.7 /etc/openvpn/script/mail.py ${USER} ${PASS} ~/&#34;$USER&#34;.ovpn</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> -e <span class="s2">&#34;\033[32mSenMail To </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">@fujfu.com\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> -e <span class="s2">&#34;\033[32mPrivate Key Password: \033[0m\033[31m</span><span class="si">${</span><span class="nv">PASS</span><span class="si">}</span><span class="s2">\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> -e <span class="s2">&#34;\033[31mUser creation failed\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">#ç§»é™¤è´¦å·æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> RemoveUser<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span>
</span></span><span class="line"><span class="cl">    <span class="nv">rlist</span><span class="o">=</span><span class="k">$(</span>find /etc/openvpn/ -name <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">*&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> ! -n <span class="s2">&#34;</span><span class="nv">$rlist</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;ç”¨æˆ·: </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2"> ä¸å­˜åœ¨&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="si">${</span><span class="nv">rlist</span><span class="si">}</span><span class="s2">\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">read</span> -p <span class="s2">&#34;ä¸Šè¿°æ–‡ä»¶å°†è¢«ç§»é™¤,è¯·ç¡®è®¤(yes/no): &#34;</span> yn
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$yn</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;yes&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> f in <span class="nv">$rlist</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">            rm -rf <span class="nv">$f</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="o">=</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="nv">$f</span><span class="s2">\033[0m       \033[32m[del]\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="nv">$f</span><span class="s2">\033[0m       \033[31m[fail]\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">fi</span>
</span></span><span class="line"><span class="cl">        <span class="k">done</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#åˆ é™¤openvpnçš„è¯ä¹¦ä¸­çš„ç”¨æˆ·</span>
</span></span><span class="line"><span class="cl">        sed -i <span class="s2">&#34;/=</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>$<span class="s2">/d&#34;</span> <span class="si">${</span><span class="nv">DB_FILE</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="o">=</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">            <span class="nb">cd</span> <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">            <span class="c1"># update-db å‘½ä»¤æ¥æ›´æ–°è¯ä¹¦æ•°æ®åº“</span>
</span></span><span class="line"><span class="cl">            /bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa update-db
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter pass phrase for&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${CA_PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">            <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="si">${</span><span class="nv">DB_FILE</span><span class="si">}</span><span class="s2">\033[0m       \033[32m[update]\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="nb">echo</span> -e <span class="s2">&#34;\033[31m</span><span class="si">${</span><span class="nv">DB_FILE</span><span class="si">}</span><span class="s2">\033[0m       \033[32m[fail]\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">#åˆ é™¤è´¦å·</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> RevokeUser<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">rlist</span><span class="o">=</span><span class="k">$(</span>find /etc/openvpn/ -name <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">*&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> ! -n <span class="s2">&#34;</span><span class="nv">$rlist</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;ç”¨æˆ·: </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2"> ä¸å­˜åœ¨&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">    <span class="c1">#gen-crlä¼šç”Ÿæˆä¸€ä»½åŠé”€è¯ä¹¦çš„åå•ï¼Œæ”¾åœ¨pki/crl.pemæ–‡ä»¶é‡Œ</span>
</span></span><span class="line"><span class="cl">    /bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa revoke ${USER}
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Continue with revocation&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;yes\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter pass phrase for&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${CA_PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ’¤é”€è¯ä¹¦å¹¶åˆ›å»ºCRL</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿™æ˜¯CAç‰¹å®šçš„ä»»åŠ¡ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¦æ°¸ä¹…æ’¤æ¶ˆå·²é¢å‘çš„è¯ä¹¦ï¼Œè¯·æä¾›å¯¼å…¥æœŸé—´ä½¿ç”¨çš„çŸ­åç§°ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ./easyrsa revoke EntityName</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¦åˆ›å»ºåŒ…å«æ‰€æœ‰å·²æ’¤é”€çš„è¯ä¹¦çš„æ›´æ–°CRLï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ./easyrsa gen-crl</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> Gencrl<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> <span class="si">${</span><span class="nv">SER_ERSA</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">    /bin/expect <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">  spawn ./easyrsa gen-crl
</span></span></span><span class="line"><span class="cl"><span class="s">  expect &#34;Enter pass phrase for&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  send &#34;${CA_PASS}\r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">start<span class="o">)</span>
</span></span><span class="line"><span class="cl">    /usr/sbin/openvpn --daemon --config /etc/openvpn/server.conf --log-append /var/log/openvpn.log
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">restart<span class="o">)</span>
</span></span><span class="line"><span class="cl">    /usr/bin/pkill --signal SIGHUP --exact openvpn
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">add<span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        CreateUser
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> $<span class="s2">&#34;Usage: </span><span class="nv">$0</span><span class="s2"> add username&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">remove<span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        RevokeUser
</span></span><span class="line"><span class="cl">        Gencrl
</span></span><span class="line"><span class="cl">        RemoveUser
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> $<span class="s2">&#34;Usage: </span><span class="nv">$0</span><span class="s2"> remove username&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*<span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> $<span class="s2">&#34;Usage: </span><span class="nv">$0</span><span class="s2"> {start|restart|add|remove} username&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl"><span class="k">esac</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢ç”Ÿæˆä¸‹æ–¹æ ¼å¼é…ç½®æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">client
</span></span><span class="line"><span class="cl">dev tun
</span></span><span class="line"><span class="cl">proto udp
</span></span><span class="line"><span class="cl">sndbuf <span class="m">0</span>
</span></span><span class="line"><span class="cl">rcvbuf <span class="m">0</span>
</span></span><span class="line"><span class="cl">remote openvpnserver <span class="m">1194</span>
</span></span><span class="line"><span class="cl">resolv-retry infinite
</span></span><span class="line"><span class="cl">nobind
</span></span><span class="line"><span class="cl">persist-key
</span></span><span class="line"><span class="cl">persist-tun
</span></span><span class="line"><span class="cl">remote-cert-tls server
</span></span><span class="line"><span class="cl">comp-lzo
</span></span><span class="line"><span class="cl">verb <span class="m">3</span>
</span></span><span class="line"><span class="cl">cipher AES-256-CBC
</span></span><span class="line"><span class="cl">script-security <span class="m">3</span>
</span></span><span class="line"><span class="cl">key-direction <span class="m">1</span>
</span></span><span class="line"><span class="cl">auth-nocache
</span></span><span class="line"><span class="cl">auth-user-pass
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ca ca.crt</span>
</span></span><span class="line"><span class="cl">&lt;ca&gt;
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl">&lt;/ca&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># cert client.crt</span>
</span></span><span class="line"><span class="cl">&lt;cert&gt;
</span></span><span class="line"><span class="cl">Certificate:
</span></span><span class="line"><span class="cl">    Data:
</span></span><span class="line"><span class="cl">        Version: <span class="m">3</span> <span class="o">(</span>0x2<span class="o">)</span>
</span></span><span class="line"><span class="cl">        Serial Number:
</span></span><span class="line"><span class="cl">            89:53:31:72:cf:04:52:82:fb:e9:53:fe:82:fc:13:25
</span></span><span class="line"><span class="cl">    Signature Algorithm: sha256WithRSAEncryption
</span></span><span class="line"><span class="cl">        Issuer: <span class="nv">CN</span><span class="o">=</span>192.168.1.10
</span></span><span class="line"><span class="cl">        Validity
</span></span><span class="line"><span class="cl">            Not Before: Nov <span class="m">14</span> 03:32:32 <span class="m">2023</span> GMT
</span></span><span class="line"><span class="cl">            Not After : Feb <span class="m">16</span> 03:32:32 <span class="m">2026</span> GMT
</span></span><span class="line"><span class="cl">        Subject: <span class="nv">CN</span><span class="o">=</span>client
</span></span><span class="line"><span class="cl">        Subject Public Key Info:
</span></span><span class="line"><span class="cl">            Public Key Algorithm: rsaEncryption
</span></span><span class="line"><span class="cl">                Public-Key: <span class="o">(</span><span class="m">2048</span> bit<span class="o">)</span>
</span></span><span class="line"><span class="cl">                Modulus:
</span></span><span class="line"><span class="cl">                    ......
</span></span><span class="line"><span class="cl">                    ......
</span></span><span class="line"><span class="cl">                    ......
</span></span><span class="line"><span class="cl">                Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
</span></span><span class="line"><span class="cl">        X509v3 extensions:
</span></span><span class="line"><span class="cl">            X509v3 Basic Constraints: 
</span></span><span class="line"><span class="cl">                CA:FALSE
</span></span><span class="line"><span class="cl">            X509v3 Subject Key Identifier: 
</span></span><span class="line"><span class="cl">                6E:0A:D2:EF:CE:55:4F:56:C7:57:D1:77:37:0D:AD:28:EF:A2:C8:41
</span></span><span class="line"><span class="cl">            X509v3 Authority Key Identifier: 
</span></span><span class="line"><span class="cl">                keyid:1A:CE:DD:A8:65:0E:3D:32:E0:74:17:15:5D:F7:6E:3B:7D:C1:59:05
</span></span><span class="line"><span class="cl">                DirName:/CN<span class="o">=</span>192.168.1.10
</span></span><span class="line"><span class="cl">                serial:D8:A8:9B:71:84:77:C8:9B
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            X509v3 Extended Key Usage: 
</span></span><span class="line"><span class="cl">                TLS Web Client Authentication
</span></span><span class="line"><span class="cl">            X509v3 Key Usage: 
</span></span><span class="line"><span class="cl">                Digital Signature
</span></span><span class="line"><span class="cl">            Netscape Comment: 
</span></span><span class="line"><span class="cl">                Easy-RSA <span class="o">(</span>3.0.8<span class="o">)</span> Generated Certificate
</span></span><span class="line"><span class="cl">            Netscape Cert Type: 
</span></span><span class="line"><span class="cl">                SSL Client
</span></span><span class="line"><span class="cl">    Signature Algorithm: sha256WithRSAEncryption
</span></span><span class="line"><span class="cl">                    ......
</span></span><span class="line"><span class="cl">                    ......
</span></span><span class="line"><span class="cl">                    ......
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl">&lt;/cert&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># key client.key</span>
</span></span><span class="line"><span class="cl">&lt;key&gt;
</span></span><span class="line"><span class="cl">-----BEGIN PRIVATE KEY-----
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">-----END PRIVATE KEY-----
</span></span><span class="line"><span class="cl">&lt;/key&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># tls-crypt ta.key 1</span>
</span></span><span class="line"><span class="cl">&lt;tls-crypt&gt;
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2048 bit OpenVPN static key</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl">-----BEGIN OpenVPN Static key V1-----
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">-----END OpenVPN Static key V1-----
</span></span><span class="line"><span class="cl">&lt;/tls-crypt&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¼€é€šè´¦å·è‡ªåŠ¨å‘é€é‚®ä»¶">å¼€é€šè´¦å·è‡ªåŠ¨å‘é€é‚®ä»¶</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">datetime</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">smtplib</span><span class="o">,</span><span class="nn">os</span><span class="o">,</span><span class="nn">datetime</span><span class="o">,</span><span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">email.header</span> <span class="kn">import</span> <span class="n">Header</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">email.mime.base</span> <span class="kn">import</span> <span class="n">MIMEBase</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">email.mime.application</span> <span class="kn">import</span> <span class="n">MIMEApplication</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">email.MIMEMultipart</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">GenHtml</span><span class="p">(</span><span class="n">UserName</span><span class="p">,</span><span class="n">UserPass</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">Data</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">  <span class="n">html</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;head&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=utf-8&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;style type=&#34;text/css&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">table {  
</span></span></span><span class="line"><span class="cl"><span class="s2">     border-collapse: collapse;  
</span></span></span><span class="line"><span class="cl"><span class="s2">     font-family: Futura, Arial, sans-serif;  
</span></span></span><span class="line"><span class="cl"><span class="s2">}  
</span></span></span><span class="line"><span class="cl"><span class="s2">caption {  
</span></span></span><span class="line"><span class="cl"><span class="s2">     font-size: larger;  
</span></span></span><span class="line"><span class="cl"><span class="s2">     margin: 1em auto;  
</span></span></span><span class="line"><span class="cl"><span class="s2">} 
</span></span></span><span class="line"><span class="cl"><span class="s2">th,td {  
</span></span></span><span class="line"><span class="cl"><span class="s2">     padding: .65em;  
</span></span></span><span class="line"><span class="cl"><span class="s2">}  
</span></span></span><span class="line"><span class="cl"><span class="s2">th {  
</span></span></span><span class="line"><span class="cl"><span class="s2">     background: #555 nonerepeat scroll 0 0;  
</span></span></span><span class="line"><span class="cl"><span class="s2">   border: 1px solid #777;  
</span></span></span><span class="line"><span class="cl"><span class="s2">   color: #fff;  
</span></span></span><span class="line"><span class="cl"><span class="s2">}  
</span></span></span><span class="line"><span class="cl"><span class="s2">td {  
</span></span></span><span class="line"><span class="cl"><span class="s2">     border: 1px solid#000000;  
</span></span></span><span class="line"><span class="cl"><span class="s2">} 
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/style&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;div id=&#34;container&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;div id=&#34;content&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;table style=&#34;tablestyle&#34; border=&#34;1&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td bgcolor=&#34;#66B3FF&#34; style=&#34;color: #F3F3FA&#34; align=&#34;center&#34;&gt;&lt;b&gt;å¼€é€šæ—¶é—´&lt;/b&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td align=&#34;center&#34;&gt;</span><span class="si">%s</span><span class="s2">&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td bgcolor=&#34;#66B3FF&#34; style=&#34;color: #F3F3FA&#34; align=&#34;center&#34;&gt;&lt;b&gt;è´¦å·&lt;/b&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td align=&#34;center&#34;&gt;&lt;font color=&#34;red&#34;&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s2">&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td bgcolor=&#34;#66B3FF&#34; style=&#34;color: #F3F3FA&#34; align=&#34;center&#34;&gt;&lt;b&gt;å¯†ç &lt;/b&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td align=&#34;center&#34;&gt;&lt;font color=&#34;red&#34;&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s2">&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td bgcolor=&#34;#66B3FF&#34; style=&#34;color: #F3F3FA&#34; align=&#34;center&#34;&gt;&lt;b&gt;æœ‰æ•ˆæœŸ&lt;/b&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td align=&#34;center&#34;&gt;&lt;font color=&#34;red&#34;&gt;&lt;b&gt;7å¤©&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td bgcolor=&#34;#66B3FF&#34; style=&#34;color: #F3F3FA&#34; align=&#34;center&#34;&gt;&lt;b&gt;è¯ä¹¦åŠé…ç½®æ–‡ä»¶&lt;/b&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">  &lt;td align=&#34;center&#34;&gt;&lt;font color=&#34;red&#34;&gt;&lt;b&gt;è§é™„ä»¶&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/table&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/br&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;h2&gt;ä½¿ç”¨è¯´æ˜:&lt;/h2&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;ul&gt;&lt;li&gt;&lt;b&gt;Windows&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;p&gt;ä¸‹è½½ openvpn çš„å®‰è£…ç¨‹åº &lt;a href=&#34;https://aliyuncs.com/software/OpenVPN-2.5.3-I601-amd64.msi&#34; title=&#34;OpenVPN-2.5.3-I601-amd64.msi&#34;&gt;OpenVPN-2.5.3-I601-amd64.msi&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">å®‰è£…å®Œæˆï¼Œå°†è¯ä¹¦æ‹·è´è‡³ OpenVPN\config ä¸‹å³å¯ï¼Œopenvpn çš„è½¯ä»¶è¯·ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€ã€‚&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;ul&gt;&lt;li&gt;&lt;b&gt;MacOS&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;p&gt;ä¸‹è½½ Tunnelblick ç­‰ï¼Œæ”¯æŒopenvpn çš„å®¢æˆ·ç«¯åŒå‡» *.ovpn å³å¯å¯¼å…¥ã€‚&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;p&gt;ä¸‹è½½ Tunnelblick å®‰è£…ç¨‹åº &lt;a href=&#34;https://aliyuncs.com/software/Tunnelblick_3.8.5a_build_5671.dmg&#34; title=&#34;Tunnelblick_3.8.5a_build_5671.dmg&#34;&gt;Tunnelblick_3.8.5a_build_5671.dmg&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;ul&gt;&lt;li&gt;&lt;b&gt;æ¸©é¦¨æç¤º&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;p&gt;è¯·å¦¥å–„ä¿ç®¡å¥½ä½ çš„è´¦å·ã€å¯†ç ä»¥åŠå¯†é’¥æ–‡ä»¶ï¼Œå¦‚å‘ç”Ÿä¿¡æ¯ä¸¢å¤±ï¼Œè¯·åŠæ—¶è”ç³»ç®¡ç†å‘˜ã€‚&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/html&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">UserName</span><span class="p">,</span> <span class="n">UserPass</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">html</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">VpnMailTo</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">mailSubject</span><span class="p">,</span> <span class="n">mailto</span><span class="p">,</span> <span class="n">key_file</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">mailuser</span> <span class="o">=</span> <span class="s2">&#34;yunwei@qq.com&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">mailpass</span> <span class="o">=</span> <span class="s2">&#34;xxxxxxx&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP_SSL</span><span class="p">(</span><span class="s1">&#39;smtp.qq.com&#39;</span><span class="p">,</span> <span class="mi">465</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">mailuser</span><span class="p">,</span> <span class="n">mailpass</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">main_msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">MIMEMultipart</span><span class="o">.</span><span class="n">MIMEMultipart</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">MIMEText</span><span class="o">.</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">_subtype</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="n">_charset</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">main_msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">text_msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">contype</span> <span class="o">=</span> <span class="s1">&#39;application/octet-stream&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">maintype</span><span class="p">,</span> <span class="n">subtype</span> <span class="o">=</span> <span class="n">contype</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;/etc/openvpn/script/docs/åŠå…¬å®¤å†…ç½‘OpenVPNä½¿ç”¨æ‰‹å†Œ.docx&#34;</span><span class="p">,</span> <span class="n">key_file</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#for f in files:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#  data = open(f, &#39;rb&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#  file_msg = email.MIMEBase.MIMEBase(maintype, subtype)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#  file_msg.set_payload(data.read())</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#  data.close()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#  email.Encoders.encode_base64(f)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#  basename = os.path.basename(f)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#  file_msg.add_header(&#39;Content-Disposition&#39;,&#39;attachment&#39;, filename = f)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#  main_msg.attach(f)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">          <span class="n">part</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s1">&#39;attachment&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">main_msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">main_msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;VPNService &lt;yunwei@qq.com&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">main_msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">mailSubject</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">main_msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mailto</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">main_msg</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">Utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="s1">&#39;yunwei@qq.com&#39;</span><span class="p">,</span> <span class="n">mailto</span><span class="p">,</span> <span class="n">main_msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">VpnReg</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Pass</span><span class="p">,</span> <span class="n">KeysFile</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">mailSubject</span> <span class="o">=</span> <span class="n">User</span> <span class="o">+</span> <span class="s2">&#34; ä½ å¥½ï¼ŒåŠå…¬ç½‘ç»œç¯å¢ƒçš„VPNè´¦å·å·²å¼€é€šæˆåŠŸï¼&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">html</span> <span class="o">=</span> <span class="n">GenHtml</span><span class="p">(</span><span class="n">User</span><span class="p">,</span><span class="n">Pass</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">MailTo</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="n">MailTo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">User</span><span class="o">+</span><span class="s2">&#34;@qq.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">VpnMailTo</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">mailSubject</span><span class="p">,</span> <span class="n">MailTo</span><span class="p">,</span> <span class="n">KeysFile</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">User</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">Pass</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">KeysFile</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">VpnReg</span><span class="p">(</span><span class="n">User</span><span class="p">,</span><span class="n">Pass</span><span class="p">,</span><span class="n">KeysFile</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="openvpnç®¡ç†">openvpnç®¡ç†</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>dev<span class="o">][</span>root@foxconn-vpn-192.168.1.1 script<span class="o">]</span><span class="c1"># pwd</span>
</span></span><span class="line"><span class="cl">/etc/openvpn/script
</span></span><span class="line"><span class="cl"><span class="o">[</span>dev<span class="o">][</span>root@foxconn-vpn-192.168.1.1 script<span class="o">]</span><span class="c1"># ./vpncli -h</span>
</span></span><span class="line"><span class="cl">Usage: ./vpncli <span class="o">{</span>start<span class="p">|</span>restart<span class="p">|</span>add<span class="p">|</span>remove<span class="o">}</span> username
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="openvpn-clientå®¢æˆ·ç«¯">openvpn-clientå®¢æˆ·ç«¯</h2>
<h3 id="openvpn-å®¢æˆ·ç«¯é…ç½®---ä¸»èŠ‚ç‚¹">OpenVPN å®¢æˆ·ç«¯é…ç½® - ä¸»èŠ‚ç‚¹</h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>å®¢æˆ·ç«¯æ ‡è¯†</th>
<th>ç‰©ç† IP / è™šæ‹Ÿ IP</th>
<th>ç›®æ ‡ç½‘ç»œèŒƒå›´</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸»èŠ‚ç‚¹ï¼ˆopenvpn-client01ï¼‰</td>
<td>10.134.18.10 / 192.168.255.10</td>
<td>10.0.0.0/8</td>
</tr>
</tbody>
</table></div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#å®¢æˆ·æ®µ</span>
</span></span><span class="line"><span class="cl">client
</span></span><span class="line"><span class="cl"><span class="c1">#ä½¿ç”¨çš„tcpåè®®</span>
</span></span><span class="line"><span class="cl">dev tun
</span></span><span class="line"><span class="cl"><span class="c1">## &#34;dev tun&#34;å°†ä¼šåˆ›å»ºä¸€ä¸ªè·¯ç”±IPéš§é“</span>
</span></span><span class="line"><span class="cl">proto tcp
</span></span><span class="line"><span class="cl"><span class="c1">#vpn serverçš„åœ°å€</span>
</span></span><span class="line"><span class="cl">remote xxx.xxx.xxx.xxx <span class="m">1194</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¯ç”¨è¯¥æŒ‡ä»¤ï¼Œä¸æœåŠ¡å™¨è¿æ¥ä¸­æ–­åå°†è‡ªåŠ¨é‡æ–°è¿æ¥ï¼Œ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿™åœ¨ç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µä¸‹(ä¾‹å¦‚ï¼šç¬”è®°æœ¬ç”µè„‘æ— çº¿ç½‘ç»œ)éå¸¸æœ‰ç”¨</span>
</span></span><span class="line"><span class="cl">resolv-retry infinite
</span></span><span class="line"><span class="cl"><span class="c1"># å¤§å¤šæ•°å®¢æˆ·ç«¯ä¸éœ€è¦ç»‘å®šæœ¬æœºç‰¹å®šçš„ç«¯å£å·</span>
</span></span><span class="line"><span class="cl">nobind
</span></span><span class="line"><span class="cl"><span class="c1"># æŒä¹…åŒ–é€‰é¡¹å¯ä»¥å°½é‡é¿å…è®¿é—®åœ¨é‡å¯æ—¶ç”±äºç”¨æˆ·æƒé™é™ä½è€Œæ— æ³•è®¿é—®çš„æŸäº›èµ„æº</span>
</span></span><span class="line"><span class="cl">persist-key
</span></span><span class="line"><span class="cl">persist-tun
</span></span><span class="line"><span class="cl"><span class="c1">#caè¯ä¹¦</span>
</span></span><span class="line"><span class="cl">ca ca.crt
</span></span><span class="line"><span class="cl"><span class="c1">#å®¢æˆ·ç«¯è¯ä¹¦</span>
</span></span><span class="line"><span class="cl">cert lh.dmz.crt
</span></span><span class="line"><span class="cl"><span class="c1">#å®¢æˆ·ç«¯ç§˜é’¥</span>
</span></span><span class="line"><span class="cl">key lh.dmz.key
</span></span><span class="line"><span class="cl"><span class="c1"># é€šè¿‡æ£€æŸ¥è¯ä¹¦å…·æœ‰æ­£ç¡®çš„å¯†é’¥ä½¿ç”¨è®¾ç½®æ¥éªŒè¯æœåŠ¡å™¨è¯ä¹¦</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿™æ˜¯é˜²æ­¢æ­¤å¤„è®¨è®ºçš„æ½œåœ¨æ”»å‡»çš„é‡è¦é¢„é˜²æªæ–½ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  http://openvpn.net/howto.html#mitm</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼ŒEasyRSAç”ŸæˆæœåŠ¡å™¨è¯ä¹¦çš„æ—¶å€™è¿›è¡Œç›¸å…³è®¾ç½®</span>
</span></span><span class="line"><span class="cl">remote-cert-tls server
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœåœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨tls-authå¯†é’¥ï¼Œé‚£ä¹ˆæ¯ä¸ªå®¢æˆ·ç«¯ä¹Ÿå¿…é¡»æ‹¥æœ‰å¯†é’¥</span>
</span></span><span class="line"><span class="cl">tls-auth ta.key <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1">## é€‰æ‹©ä¸€ä¸ªåŠ å¯†ç®—æ³•ï¼ŒæœåŠ¡å™¨ä½¿ç”¨çš„ç®—æ³•é€‰é¡¹ï¼Œä¹Ÿå¿…é¡»åœ¨è¿™é‡ŒæŒ‡å®šå®ƒ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ³¨æ„ï¼Œv2.4å®¢æˆ·ç«¯/æœåŠ¡å™¨å°†è‡ªåŠ¨ä»¥TLSæ¨¡å¼åå•†AES-256-GCMã€‚</span>
</span></span><span class="line"><span class="cl">cipher AES-256-CBC
</span></span><span class="line"><span class="cl"><span class="c1">#ä¿¡æ¯æ—¥å¿—</span>
</span></span><span class="line"><span class="cl">verb <span class="m">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¯åŠ¨å®¢æˆ·ç«¯">å¯åŠ¨å®¢æˆ·ç«¯</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">openvpn --daemon --cd /etc/openvpn/lh.dmz/ --config lh.dmz.ovpn --log-append /var/log/openvpn_dmz.log --askpass /etc/openvpn/lh.dmz/lh.dmz.pass
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="openvpn-å®¢æˆ·ç«¯é…ç½®---å¤‡èŠ‚ç‚¹é€šè¿‡ä»£ç†">OpenVPN å®¢æˆ·ç«¯é…ç½® - å¤‡èŠ‚ç‚¹ï¼ˆé€šè¿‡ä»£ç†ï¼‰</h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>å®¢æˆ·ç«¯æ ‡è¯†</th>
<th>ç‰©ç† IP / è™šæ‹Ÿ IP</th>
<th>ç›®æ ‡ç½‘ç»œèŒƒå›´</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¤‡èŠ‚ç‚¹ï¼ˆopenvpn-client02ï¼‰</td>
<td>10.128.19.10 / 192.168.255.6</td>
<td>10.0.0.0/8</td>
</tr>
</tbody>
</table></div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">client
</span></span><span class="line"><span class="cl">dev tun
</span></span><span class="line"><span class="cl">proto tcp
</span></span><span class="line"><span class="cl">remote xxx.xxx.xxx.xxx <span class="m">1194</span>
</span></span><span class="line"><span class="cl">resolv-retry infinite
</span></span><span class="line"><span class="cl">route 192.168.0.0 255.255.0.0
</span></span><span class="line"><span class="cl">route xxx.xxx.xxx.xxx 255.255.255.255 <span class="c1">#å…¬ç½‘è·¯ç”±</span>
</span></span><span class="line"><span class="cl">nobind
</span></span><span class="line"><span class="cl">persist-key
</span></span><span class="line"><span class="cl">persist-tun
</span></span><span class="line"><span class="cl">ca ca.crt
</span></span><span class="line"><span class="cl">cert lh.fox.crt
</span></span><span class="line"><span class="cl">key lh.fox.key
</span></span><span class="line"><span class="cl">remote-cert-tls server
</span></span><span class="line"><span class="cl">tls-auth ta.key <span class="m">1</span>
</span></span><span class="line"><span class="cl">cipher AES-256-CBC
</span></span><span class="line"><span class="cl">verb <span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="c1">#http-proxy 10.xxx.xxx.xxx 3128</span>
</span></span><span class="line"><span class="cl"><span class="c1">#http-proxy 10.xxx.xxx.xxx 3128</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœé€šè¿‡HTTPä»£ç†æ–¹å¼æ¥è¿æ¥åˆ°å®é™…çš„VPNæœåŠ¡å™¨</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åœ¨æ­¤å¤„æŒ‡å®šä»£ç†æœåŠ¡å™¨çš„ä¸»æœºå(æˆ–IP)å’Œç«¯å£å·</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœä»£ç†æœåŠ¡å™¨éœ€è¦èº«ä»½è®¤è¯ï¼Œè¯·å‚è€ƒå®˜æ–¹æ‰‹å†Œ</span>
</span></span><span class="line"><span class="cl">http-proxy 10.xxx.xxx.xxx <span class="m">3128</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•</span>
</span></span><span class="line"><span class="cl">http-proxy-retry
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¯åŠ¨å®¢æˆ·ç«¯-1">å¯åŠ¨å®¢æˆ·ç«¯</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openvpn --daemon --cd /etc/openvpn/lh.fox --config lh.fox.ovpn --log-append /var/log/openvpn.log --askpass /etc/openvpn/lh.fox/lh.fox.pass  <span class="c1">#è¿™ä¸ªvpnåœ¨è¿æ¥æ—¶ï¼Œä¼šä½¿ç”¨åˆ°å¯†ç </span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº¤æ¢æœºé…ç½®">äº¤æ¢æœºé…ç½®</h2>
<p>äº¤æ¢æœºæ·»åŠ è·¯ç”±</p>
<p><strong>10.0.0.0/8 è¿™ä¸ªç½‘æ®µæ˜¯ å¼‚åœ° çš„ç½‘æ®µ</strong></p>
<p>è®¿é—® 10.0.0.0/8çš„ æ•°æ®ï¼Œä¸‹ä¸€è·³ 192.168.83.44 ï¼ˆopenvpn-serverï¼‰</p>
<p><img src="/../../image/image-20220701174558080.png"
	
	
	
	loading="lazy"
	
		alt="image-20220701174558080"
	
	
></p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a class="link" href="https://www.gaoyufu.cn/archives/openvpn"  target="_blank" rel="noopener"
    >https://www.gaoyufu.cn/archives/openvpn</a></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/opevpn/">opevpn</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>æœªæ¥çš„ä½ ï¼Œä¼šæ„Ÿè°¢ä»Šå¤©ä»åœ¨åŠªåŠ›å¥‹æ–—çš„ä½ </span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/202410251628/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/01.jpg" loading="lazy" data-key="202410251628" data-hash="/../../title_pic/01.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">æœºæˆ¿ç§æœ‰äº‘OpenStackæ­å»ºè¯¦ç»†æ­¥éª¤æµç¨‹</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/202410231844/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/77.jpg" loading="lazy" data-key="202410231844" data-hash="/../../title_pic/77.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">OpenStackå°†è¿è¡Œçš„ç³»ç»Ÿå¯¼å‡º QCOW2 é•œåƒå¹¶å¯¼å…¥é˜¿é‡Œäº‘</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/202407302222/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/11.jpg" loading="lazy" data-key="202407302222" data-hash="/../../title_pic/11.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Openvpnæ‰“é€šåŒ—äº¬å’Œæ·±åœ³ä¸¤åœ°åŠå…¬å®¤ç½‘ç»œ</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/202407281721/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/68.jpg" loading="lazy" data-key="202407281721" data-hash="/../../title_pic/68.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PowerDNSæ¶æ„è§£æä¸å®‰è£…éƒ¨ç½²æŒ‡å—</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/202407181155/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/58.jpg" loading="lazy" data-key="202407181155" data-hash="/../../title_pic/58.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">å¤„ç†.gitæ–‡ä»¶å¤¹è¿‡å¤§å‡ºç°è‡ƒè‚¿é—®é¢˜</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="nangongchengfeng/nangongchengfeng.github.io"
    data-repo-id="R_kgDOIwWL4Q"
    data-category="Announcements"
    data-category-id="DIC_kwDOIwWL4c4Cg8Rs"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark_dimmed');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2018 - 
        
        2024 å—å®«ä¹˜é£
    </section>
    
    <section class="powerby">
        
            <a href="https://beian.miit.gov.cn/" target="_blank">å¤‡æ¡ˆå·</a> <a href="https://beian.miit.gov.cn/" target="_blank">é™•ICPå¤‡2021004364å·-1</a> <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
