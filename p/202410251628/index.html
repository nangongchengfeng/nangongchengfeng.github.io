<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='OpenStack是一个开源的云计算管理平台，旨在为公共及私有云的建设与管理提供软件。它由几个主要的组件组合起来完成一些具体的工作，包括计算、存储和网络资源的管理。OpenStack支持所有类型的云环境，可以简单地实施并大规模扩展，提供了一个丰富、标准化、统一的云计算管理平台。在私有云的部署中，OpenStack提供了强大的灵活性和可扩展性，允许企业根据自己的需求来定制和优化云环境。例如，通过OpenStack，企业可以规划并管理大量虚拟机，提供所需的对象及块存储资源，并实现网络资源的高扩展和自动化管理。'>
<title>机房私有云OpenStack搭建详细步骤流程</title>

<link rel='canonical' href='https://www.ownit.top/p/202410251628/'>

<link rel="stylesheet" href="/scss/style.min.f8f67bed86aec9bc8e9eb410ba9583e51cb34eee82f3d10e0abbae72b51272ce.css"><meta property='og:title' content='机房私有云OpenStack搭建详细步骤流程'>
<meta property='og:description' content='OpenStack是一个开源的云计算管理平台，旨在为公共及私有云的建设与管理提供软件。它由几个主要的组件组合起来完成一些具体的工作，包括计算、存储和网络资源的管理。OpenStack支持所有类型的云环境，可以简单地实施并大规模扩展，提供了一个丰富、标准化、统一的云计算管理平台。在私有云的部署中，OpenStack提供了强大的灵活性和可扩展性，允许企业根据自己的需求来定制和优化云环境。例如，通过OpenStack，企业可以规划并管理大量虚拟机，提供所需的对象及块存储资源，并实现网络资源的高扩展和自动化管理。'>
<meta property='og:url' content='https://www.ownit.top/p/202410251628/'>
<meta property='og:site_name' content='南宫乘风'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='openstack' /><meta property='article:published_time' content='2024-10-25T16:28:51&#43;00:00'/><meta property='article:modified_time' content='2024-10-25T16:28:51&#43;00:00'/><meta property='og:image' content='https://www.ownit.top/title_pic/01.jpg' />
<meta name="twitter:title" content="机房私有云OpenStack搭建详细步骤流程">
<meta name="twitter:description" content="OpenStack是一个开源的云计算管理平台，旨在为公共及私有云的建设与管理提供软件。它由几个主要的组件组合起来完成一些具体的工作，包括计算、存储和网络资源的管理。OpenStack支持所有类型的云环境，可以简单地实施并大规模扩展，提供了一个丰富、标准化、统一的云计算管理平台。在私有云的部署中，OpenStack提供了强大的灵活性和可扩展性，允许企业根据自己的需求来定制和优化云环境。例如，通过OpenStack，企业可以规划并管理大量虚拟机，提供所需的对象及块存储资源，并实现网络资源的高扩展和自动化管理。"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://www.ownit.top/title_pic/01.jpg' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu227367ba8544f2fc7811ed9508937bec_102665_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">南宫乘风</a></h1>
            <h2 class="site-description">当你的才华撑不起你的野心时，只有静下心学习才是唯一的出路</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://blog.csdn.net/heian_99'
                        target="_blank"
                        title="CSDN"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="32.000000pt" height="32.000000pt" viewBox="0 0 32.000000 32.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,32.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M0 160 l0 -160 160 0 160 0 0 160 0 160 -160 0 -160 0 0 -160z m225
108 c24 -11 34 -41 16 -52 -4 -3 -17 1 -27 9 -43 32 -95 3 -109 -62 -5 -27 -2
-37 19 -58 29 -29 62 -32 94 -9 25 17 42 11 42 -15 0 -27 -51 -45 -107 -38
-70 8 -97 42 -91 115 4 48 10 60 41 89 39 35 76 42 122 21z"/>
</g>
</svg>

                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/nangongchengfeng/'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='/index.xml'
                        target="_blank"
                        title="RSS"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 viewBox="0 0 455.731 455.731" xml:space="preserve">
<g>
	<rect x="0" y="0" style="fill:#F78422;" width="455.731" height="455.731"/>
	<g>
		<path style="fill:#FFFFFF;" d="M296.208,159.16C234.445,97.397,152.266,63.382,64.81,63.382v64.348
			c70.268,0,136.288,27.321,185.898,76.931c49.609,49.61,76.931,115.63,76.931,185.898h64.348
			C391.986,303.103,357.971,220.923,296.208,159.16z"/>
		<path style="fill:#FFFFFF;" d="M64.143,172.273v64.348c84.881,0,153.938,69.056,153.938,153.939h64.348
			C282.429,270.196,184.507,172.273,64.143,172.273z"/>
		<circle style="fill:#FFFFFF;" cx="109.833" cy="346.26" r="46.088"/>
	</g>
</g>
</svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/link/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友链</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>暗色模式</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#openstack介绍">OpenStack介绍</a></li>
    <li><a href="#公司需求">公司需求</a></li>
    <li><a href="#准备">准备</a>
      <ol>
        <li><a href="#初始化">初始化</a></li>
        <li><a href="#网络时间协议ntp">网络时间协议（NTP）</a></li>
      </ol>
    </li>
    <li><a href="#安装openstack软件包">安装OpenStack软件包</a></li>
    <li><a href="#部署基础组件">部署基础组件</a>
      <ol>
        <li><a href="#安装数据库">安装数据库</a></li>
        <li><a href="#安装消息队列服务">安装消息队列服务</a></li>
        <li><a href="#安装缓存服务">安装缓存服务</a></li>
        <li><a href="#安装键值存储服务">安装键值存储服务</a></li>
        <li><a href="#系统参数优化">系统参数优化</a></li>
      </ol>
    </li>
    <li><a href="#安装keystone">安装keystone</a></li>
    <li><a href="#安装glance">安装glance</a></li>
    <li><a href="#安装compute控制节点">安装Compute|控制节点</a></li>
    <li><a href="#安装compute计算节点">安装Compute|计算节点</a></li>
    <li><a href="#安装neutron">安装neutron</a></li>
    <li><a href="#安装dashboard">安装dashboard</a></li>
    <li><a href="#创建网络虚拟机">创建网络&amp;虚拟机</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/202410251628/">
                
                    <img src="/../../title_pic/01.jpg" loading="lazy" alt="Featured image of post 机房私有云OpenStack搭建详细步骤流程" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/" >
                项目实战
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/202410251628/">机房私有云OpenStack搭建详细步骤流程</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            OpenStack是一个开源的云计算管理平台，旨在为公共及私有云的建设与管理提供软件。它由几个主要的组件组合起来完成一些具体的工作，包括计算、存储和网络资源的管理。OpenStack支持所有类型的云环境，可以简单地实施并大规模扩展，提供了一个丰富、标准化、统一的云计算管理平台。在私有云的部署中，OpenStack提供了强大的灵活性和可扩展性，允许企业根据自己的需求来定制和优化云环境。例如，通过OpenStack，企业可以规划并管理大量虚拟机，提供所需的对象及块存储资源，并实现网络资源的高扩展和自动化管理。
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Oct 25, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 19 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="openstack介绍">OpenStack介绍</h2>
<p>OpenStack是一个开源的云计算管理平台，旨在为公共及私有云的建设与管理提供软件。它由几个主要的组件组合起来完成一些具体的工作，包括计算、存储和网络资源的管理。OpenStack支持所有类型的云环境，可以简单地实施并大规模扩展，提供了一个丰富、标准化、统一的云计算管理平台。</p>
<p>在私有云的部署中，OpenStack提供了强大的灵活性和可扩展性，允许企业根据自己的需求来定制和优化云环境。例如，通过OpenStack，企业可以规划并管理大量虚拟机，提供所需的对象及块存储资源，并实现网络资源的高扩展和自动化管理</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>组件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nova</td>
<td>Compute HyperV管理(libvirt,qumu&hellip;)</td>
</tr>
<tr>
<td>Neutron</td>
<td>网络和地址管理(原名Quantum)</td>
</tr>
<tr>
<td>Swift</td>
<td>对象存储(Object)</td>
</tr>
<tr>
<td>Cinder</td>
<td>块存储管理(Cinder):主机指虚拟机的存储管理</td>
</tr>
<tr>
<td>Keystone</td>
<td>身份认证授权(Identity)</td>
</tr>
<tr>
<td>Glance</td>
<td>镜象管理(Image)，支持本地存储、NFS、Swift、sheepdog和Ceph</td>
</tr>
<tr>
<td>Horizon</td>
<td>UI界面 (Dashboard)</td>
</tr>
<tr>
<td>Ceilometer</td>
<td>监控计量(Metering)</td>
</tr>
<tr>
<td>Heat</td>
<td>软件部署(编配Orchestration)</td>
</tr>
<tr>
<td>Lbass</td>
<td>负载均衡，后端可以是各种商业和开源产品，如：F5、Nginx、Haproxy、LVS</td>
</tr>
<tr>
<td>oslo</td>
<td>把所有组件需要用的相同的东西集中起来</td>
</tr>
<tr>
<td>Moniker</td>
<td>DNS:每个虚拟机，都会自动有一个dns记录</td>
</tr>
<tr>
<td>marconi</td>
<td>消息队列扩展(Queue Service)</td>
</tr>
<tr>
<td>Trove</td>
<td>Database Service</td>
</tr>
<tr>
<td>Ironic</td>
<td>裸机部署(Bare Metal)</td>
</tr>
<tr>
<td>Savannah</td>
<td>Data Processing</td>
</tr>
<tr>
<td><img src="/../../image/d6fd4680be1046e299193100e9ff8ebb.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
></td>
<td></td>
</tr>
</tbody>
</table></div>
<h2 id="公司需求">公司需求</h2>
<p>因为公司业务拓展，需要有相关的设备建设对应的环境，我们采购多台服务器，使用raid5在组成存储。在这基础上使用OpenStack搭建私有云，来运行相关的业务和虚拟机。</p>
<p>机房检测环境通常需要一个稳定、安全、可控制的私有云环境。在这样的环境中，OpenStack能够提供以下优势：</p>
<ol>
<li><strong>自主可控</strong>：企业可以根据自己的需求定制和优化云环境，不受外部云服务提供商的限制。</li>
<li><strong>安全性</strong>：私有云部署在企业内部，可以提供更高的安全和隐私级别，确保敏感数据不被第三方访问。</li>
<li><strong>灵活性</strong>：OpenStack的开源特性使得企业可以灵活地选择硬件和软件，以及如何部署和管理这些资源。</li>
<li><strong>成本效益</strong>：虽然初期建设成本可能较高，但随着业务量的增加，私有云的平均运营成本可能会低于公有云。</li>
</ol>
<h2 id="准备">准备</h2>
<p>OS：Centos 7 1804 Minimal
CPU：4c
MEM：8G
xvda：50G 系统盘
xvdb：100G 数据盘
Master IP：192.168.81.40</p>
<p>目标：
1.安装openstack Ocata
2.参考文档 <a class="link" href="https://docs.openstack.org/ocata/install-guide-rdo/"  target="_blank" rel="noopener"
    >https://docs.openstack.org/ocata/install-guide-rdo/</a></p>
<h3 id="初始化">初始化</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#初始化配置</span>
</span></span><span class="line"><span class="cl">1.配置静态IP
</span></span><span class="line"><span class="cl">2.关闭 selinux
</span></span><span class="line"><span class="cl">sed -i <span class="s2">&#34;s/SELINUX=.*/SELINUX=disabled/g&#34;</span> /etc/selinux/config
</span></span><span class="line"><span class="cl">3.关闭 NetworkManger
</span></span><span class="line"><span class="cl">systemctl stop NetworkManger
</span></span><span class="line"><span class="cl">systemctl disable NetworkManager
</span></span><span class="line"><span class="cl">4.关闭 firewalld
</span></span><span class="line"><span class="cl">systemctl stop firewalld
</span></span><span class="line"><span class="cl">systemctl disable firewalld
</span></span><span class="line"><span class="cl">5.配置主机名
</span></span><span class="line"><span class="cl">hostnamectl set-hostname controller.openstack.fjf
</span></span><span class="line"><span class="cl">6.重启
</span></span><span class="line"><span class="cl">reboot
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="网络时间协议ntp">网络时间协议（NTP）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">1.编辑 /etc/chrony.conf
</span></span><span class="line"><span class="cl">server ntp1.aliyun.com iburst
</span></span><span class="line"><span class="cl">server ntp2.aliyun.com iburst
</span></span><span class="line"><span class="cl">server ntp3.aliyun.com iburst
</span></span><span class="line"><span class="cl">server 0.centos.pool.ntp.org iburst
</span></span><span class="line"><span class="cl">server 1.centos.pool.ntp.org iburst
</span></span><span class="line"><span class="cl">server 2.centos.pool.ntp.org iburst
</span></span><span class="line"><span class="cl">server 3.centos.pool.ntp.org iburst
</span></span><span class="line"><span class="cl">driftfile /var/lib/chrony/drift
</span></span><span class="line"><span class="cl">makestep 1.0 <span class="m">3</span>
</span></span><span class="line"><span class="cl">rtcsync
</span></span><span class="line"><span class="cl">allow 192.168.0.0/16
</span></span><span class="line"><span class="cl">logdir /var/log/chrony
</span></span><span class="line"><span class="cl">2.重启服务
</span></span><span class="line"><span class="cl">systemctl restart chronyd
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安装openstack软件包">安装OpenStack软件包</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1.准备密码
</span></span><span class="line"><span class="cl"><span class="nv">ADMIN_PASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">CINDER_DBPASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">CINDER_PASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">DASH_DBPASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">DEMO_PASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">GLANCE_DBPASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">GLANCE_PASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">KEYSTONE_DBPASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">METADATA_SECRET</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">NEUTRON_DBPASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">NEUTRON_PASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">NOVA_DBPASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">NOVA_PASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">PLACEMENT_PASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">RABBIT_PASS</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl">2.配置hosts
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;192.168.81.40 controller.openstack.fjf&#34;</span> &gt;&gt; /etc/hosts
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;192.168.81.40 controller&#34;</span> &gt;&gt; /etc/hosts
</span></span><span class="line"><span class="cl">3.安装openstack yum 源，官方已经移除了ocata的yum源，所以用本地同步好的
</span></span><span class="line"><span class="cl">mkdir /etc/yum.repos.d/bak
</span></span><span class="line"><span class="cl">mv /etc/yum.repos.d/* /etc/yum.repos.d/bak/
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in CentOS-Base.repo  CentOS-OpenStack-Ocata.repo epel.repo<span class="p">;</span><span class="k">do</span>
</span></span><span class="line"><span class="cl">  curl -s -o /etc/yum.repos.d/<span class="nv">$i</span> http://source.fjf.com/bdata/centos7/<span class="nv">$i</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl">4.重建yum缓存
</span></span><span class="line"><span class="cl">yum clean all
</span></span><span class="line"><span class="cl">yum makecache
</span></span><span class="line"><span class="cl">5.升级软件
</span></span><span class="line"><span class="cl">yum upgrade -y
</span></span><span class="line"><span class="cl">6.内核可能会有更新，重启一次系统
</span></span><span class="line"><span class="cl">reboot
</span></span><span class="line"><span class="cl">7.安装openstack client
</span></span><span class="line"><span class="cl">yum install python-openstackclient -y
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>创建目录</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p /var/lib/nova
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>分区并格式化磁盘</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller nova<span class="o">]</span><span class="c1"># fdisk /dev/xvdb</span>
</span></span><span class="line"><span class="cl">Welcome to fdisk <span class="o">(</span>util-linux 2.23.2<span class="o">)</span>.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Changes will remain in memory only, <span class="k">until</span> you decide to write them.
</span></span><span class="line"><span class="cl">Be careful before using the write command.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Device does not contain a recognized partition table
</span></span><span class="line"><span class="cl">Building a new DOS disklabel with disk identifier 0x3974d932.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: n
</span></span><span class="line"><span class="cl">Partition type:
</span></span><span class="line"><span class="cl">   p   primary <span class="o">(</span><span class="m">0</span> primary, <span class="m">0</span> extended, <span class="m">4</span> free<span class="o">)</span>
</span></span><span class="line"><span class="cl">   e   extended
</span></span><span class="line"><span class="cl">Select <span class="o">(</span>default p<span class="o">)</span>: p
</span></span><span class="line"><span class="cl">Partition number <span class="o">(</span>1-4, default 1<span class="o">)</span>: <span class="m">1</span>
</span></span><span class="line"><span class="cl">First sector <span class="o">(</span>2048-209715199, default 2048<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Using default value <span class="m">2048</span>
</span></span><span class="line"><span class="cl">Last sector, +sectors or +size<span class="o">{</span>K,M,G<span class="o">}</span> <span class="o">(</span>2048-209715199, default 209715199<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Using default value <span class="m">209715199</span>
</span></span><span class="line"><span class="cl">Partition <span class="m">1</span> of <span class="nb">type</span> Linux and of size <span class="m">100</span> GiB is <span class="nb">set</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: p
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Disk /dev/xvdb: 107.4 GB, <span class="m">107374182400</span> bytes, <span class="m">209715200</span> sectors
</span></span><span class="line"><span class="cl"><span class="nv">Units</span> <span class="o">=</span> sectors of <span class="m">1</span> * <span class="nv">512</span> <span class="o">=</span> <span class="m">512</span> bytes
</span></span><span class="line"><span class="cl">Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
</span></span><span class="line"><span class="cl">I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
</span></span><span class="line"><span class="cl">Disk label type: dos
</span></span><span class="line"><span class="cl">Disk identifier: 0x3974d932
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Device Boot      Start         End      Blocks   Id  System
</span></span><span class="line"><span class="cl">/dev/xvdb1            <span class="m">2048</span>   <span class="m">209715199</span>   <span class="m">104856576</span>   <span class="m">83</span>  Linux
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: w
</span></span><span class="line"><span class="cl">The partition table has been altered!
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Calling ioctl<span class="o">()</span> to re-read partition table.
</span></span><span class="line"><span class="cl">Syncing disks.
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller lib<span class="o">]</span><span class="c1"># mkfs.xfs /dev/xvdb1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>挂载至/var/lib/nova</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mount /dev/xvdb1 /var/lib/nova
</span></span><span class="line"><span class="cl">编辑/etc/fstab,添加一行
</span></span><span class="line"><span class="cl">/dev/xvdb1 /var/lib/nova           xfs     defaults        <span class="m">0</span> <span class="m">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="部署基础组件">部署基础组件</h2>
<h3 id="安装数据库">安装数据库</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">1.安装
</span></span><span class="line"><span class="cl">yum install mariadb mariadb-server python2-PyMySQL -y
</span></span><span class="line"><span class="cl">2.配置
</span></span><span class="line"><span class="cl">cat &gt; /etc/my.cnf.d/openstack.cnf <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">[mysqld]
</span></span></span><span class="line"><span class="cl"><span class="s">bind-address = 192.168.81.40
</span></span></span><span class="line"><span class="cl"><span class="s"> 
</span></span></span><span class="line"><span class="cl"><span class="s">default-storage-engine = innodb
</span></span></span><span class="line"><span class="cl"><span class="s">innodb_file_per_table = on
</span></span></span><span class="line"><span class="cl"><span class="s">max_connections = 4096
</span></span></span><span class="line"><span class="cl"><span class="s">collation-server = utf8_general_ci
</span></span></span><span class="line"><span class="cl"><span class="s">character-set-server = utf8
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">3.优化参数
</span></span><span class="line"><span class="cl">在文件 /usr/lib/systemd/system/mariadb.service 的<span class="o">[</span>Service<span class="o">]</span>字段添加下列参数，否则会造成虚拟机创建失败的情况
</span></span><span class="line"><span class="cl"><span class="nv">LimitNOFILE</span><span class="o">=</span><span class="m">10000</span>
</span></span><span class="line"><span class="cl"><span class="nv">LimitNPROC</span><span class="o">=</span><span class="m">10000</span>
</span></span><span class="line"><span class="cl">4.启动
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> mariadb.service
</span></span><span class="line"><span class="cl">systemctl start mariadb.service
</span></span><span class="line"><span class="cl">5.设置密码
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># mysql_secure_installation</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
</span></span><span class="line"><span class="cl">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">In order to log into MariaDB to secure it, we<span class="s1">&#39;ll need the current
</span></span></span><span class="line"><span class="cl"><span class="s1">password for the root user.  If you&#39;</span>ve just installed MariaDB, and
</span></span><span class="line"><span class="cl">you haven<span class="s1">&#39;t set the root password yet, the password will be blank,
</span></span></span><span class="line"><span class="cl"><span class="s1">so you should just press enter here.
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Enter current password for root (enter for none): 默认没密码，直接回车
</span></span></span><span class="line"><span class="cl"><span class="s1">OK, successfully used password, moving on...
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Setting the root password ensures that nobody can log into the MariaDB
</span></span></span><span class="line"><span class="cl"><span class="s1">root user without the proper authorisation.
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Set root password? [Y/n] Y
</span></span></span><span class="line"><span class="cl"><span class="s1">New password: Pass@w0rd
</span></span></span><span class="line"><span class="cl"><span class="s1">Re-enter new password: Pass@w0rd
</span></span></span><span class="line"><span class="cl"><span class="s1">Password updated successfully!
</span></span></span><span class="line"><span class="cl"><span class="s1">Reloading privilege tables..
</span></span></span><span class="line"><span class="cl"><span class="s1"> ... Success!
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">By default, a MariaDB installation has an anonymous user, allowing anyone
</span></span></span><span class="line"><span class="cl"><span class="s1">to log into MariaDB without having to have a user account created for
</span></span></span><span class="line"><span class="cl"><span class="s1">them.  This is intended only for testing, and to make the installation
</span></span></span><span class="line"><span class="cl"><span class="s1">go a bit smoother.  You should remove them before moving into a
</span></span></span><span class="line"><span class="cl"><span class="s1">production environment.
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Remove anonymous users? [Y/n] Y
</span></span></span><span class="line"><span class="cl"><span class="s1"> ... Success!
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Normally, root should only be allowed to connect from &#39;</span>localhost<span class="s1">&#39;.  This
</span></span></span><span class="line"><span class="cl"><span class="s1">ensures that someone cannot guess at the root password from the network.
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Disallow root login remotely? [Y/n] Y          #禁止root远程登陆，选择为Y之后只有master节点能使用root账号登陆。如果不想这样，按n
</span></span></span><span class="line"><span class="cl"><span class="s1"> ... Success!
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">By default, MariaDB comes with a database named &#39;</span>test<span class="s1">&#39; that anyone can
</span></span></span><span class="line"><span class="cl"><span class="s1">access.  This is also intended only for testing, and should be removed
</span></span></span><span class="line"><span class="cl"><span class="s1">before moving into a production environment.
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Remove test database and access to it? [Y/n] Y
</span></span></span><span class="line"><span class="cl"><span class="s1"> - Dropping test database...
</span></span></span><span class="line"><span class="cl"><span class="s1"> ... Success!
</span></span></span><span class="line"><span class="cl"><span class="s1"> - Removing privileges on test database...
</span></span></span><span class="line"><span class="cl"><span class="s1"> ... Success!
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Reloading the privilege tables will ensure that all changes made so far
</span></span></span><span class="line"><span class="cl"><span class="s1">will take effect immediately.
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Reload privilege tables now? [Y/n] Y
</span></span></span><span class="line"><span class="cl"><span class="s1"> ... Success!
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">Cleaning up...
</span></span></span><span class="line"><span class="cl"><span class="s1"> 
</span></span></span><span class="line"><span class="cl"><span class="s1">All done!  If you&#39;</span>ve completed all of the above steps, your MariaDB
</span></span><span class="line"><span class="cl">installation should now be secure.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Thanks <span class="k">for</span> using MariaDB!
</span></span><span class="line"><span class="cl">6.测试一下
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># mysql -uroot -pPass@w0rd</span>
</span></span><span class="line"><span class="cl">Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span></span><span class="line"><span class="cl">Your MariaDB connection id is <span class="m">16</span>
</span></span><span class="line"><span class="cl">Server version: 10.3.20-MariaDB MariaDB Server
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">show databases<span class="p">;</span>
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Database           <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> information_schema <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> mysql              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> performance_schema <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl"><span class="m">3</span> rows in <span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装消息队列服务">安装消息队列服务</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">1.安装rabbitmq
</span></span><span class="line"><span class="cl">yum install rabbitmq-server -y
</span></span><span class="line"><span class="cl">2.启动
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> rabbitmq-server.service
</span></span><span class="line"><span class="cl">systemctl start rabbitmq-server.service
</span></span><span class="line"><span class="cl">3.设置密码
</span></span><span class="line"><span class="cl">rabbitmqctl add_user openstack Pass@w0rd
</span></span><span class="line"><span class="cl">4.授权
</span></span><span class="line"><span class="cl">rabbitmqctl set_permissions openstack <span class="s2">&#34;.*&#34;</span> <span class="s2">&#34;.*&#34;</span> <span class="s2">&#34;.*&#34;</span>
</span></span><span class="line"><span class="cl">5.开启rabbitmq management方便以后管理
</span></span><span class="line"><span class="cl">rabbitmq-plugins <span class="nb">enable</span> rabbitmq_management
</span></span><span class="line"><span class="cl">默认密码：guest/guest
</span></span><span class="line"><span class="cl">后台：192.168.81.40:15672
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装缓存服务">安装缓存服务</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">1.安装memcached
</span></span><span class="line"><span class="cl">yum install memcached python-memcached -y
</span></span><span class="line"><span class="cl">2.修改配置文件
</span></span><span class="line"><span class="cl">vim /etc/sysconfig/memcached
</span></span><span class="line"><span class="cl"><span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;-l 127.0.0.1,::1,controller.openstack.fjf&#34;</span>
</span></span><span class="line"><span class="cl">3.启动
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> memcached.service
</span></span><span class="line"><span class="cl">systemctl start memcached.service
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装键值存储服务">安装键值存储服务</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">1.安装etcd
</span></span><span class="line"><span class="cl">yum install etcd -y
</span></span><span class="line"><span class="cl">2.配置
</span></span><span class="line"><span class="cl">cat &gt; /etc/etcd/etcd.conf <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">#[Member]
</span></span></span><span class="line"><span class="cl"><span class="s">ETCD_DATA_DIR=&#34;/var/lib/etcd/default.etcd&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">ETCD_LISTEN_PEER_URLS=&#34;http://192.168.81.40:2380&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">ETCD_LISTEN_CLIENT_URLS=&#34;http://192.168.81.40:2379&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">ETCD_NAME=&#34;controller.openstack.fjf&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">#[Clustering]
</span></span></span><span class="line"><span class="cl"><span class="s">ETCD_INITIAL_ADVERTISE_PEER_URLS=&#34;http://192.168.81.40:2380&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">ETCD_ADVERTISE_CLIENT_URLS=&#34;http://192.168.81.40:2379&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">ETCD_INITIAL_CLUSTER=&#34;controller.openstack.fjf=http://192.168.81.40:2380&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">ETCD_INITIAL_CLUSTER_TOKEN=&#34;etcd-cluster-01&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">ETCD_INITIAL_CLUSTER_STATE=&#34;new&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">3.启动
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> etcd
</span></span><span class="line"><span class="cl">systemctl start etcd
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="系统参数优化">系统参数优化</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">1.修改/etc/security/limits.d/20-nproc.conf
</span></span><span class="line"><span class="cl">*          soft    nproc     <span class="m">65535</span>
</span></span><span class="line"><span class="cl">root       soft    nproc     unlimited
</span></span><span class="line"><span class="cl">2.修改
</span></span><span class="line"><span class="cl">/etc/security/limits.conf
</span></span><span class="line"><span class="cl">*     soft  nofile  <span class="m">655350</span>
</span></span><span class="line"><span class="cl">*     hard  nofile  <span class="m">655350</span>
</span></span><span class="line"><span class="cl">*     soft  nproc   <span class="m">655350</span>
</span></span><span class="line"><span class="cl">*     hard  nproc   <span class="m">655350</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安装keystone">安装keystone</h2>
<p>一. 安装keystone(身份认证服务)</p>
<p>建库，建用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># mysql -uroot -pPass@w0rd  </span>
</span></span><span class="line"><span class="cl">Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span></span><span class="line"><span class="cl">Your MariaDB connection id is <span class="m">11</span>
</span></span><span class="line"><span class="cl">Server version: 10.1.20-MariaDB MariaDB Server
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2016, Oracle, MariaDB Corporation Ab and others.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; CREATE DATABASE keystone<span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON keystone.* TO <span class="s1">&#39;keystone&#39;</span>@<span class="s1">&#39;localhost&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON keystone.* TO <span class="s1">&#39;keystone&#39;</span>@<span class="s1">&#39;%&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装组件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum install openstack-keystone httpd mod_wsgi -y
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/keystone/keystone.conf文件并完成以下操作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1.在该<span class="o">[</span>database<span class="o">]</span>部分中，配置数据库访问：
</span></span><span class="line"><span class="cl"><span class="o">[</span>database<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">connection</span> <span class="o">=</span> mysql+pymysql://keystone:Pass@w0rd@controller.openstack.fjf/keystone
</span></span><span class="line"><span class="cl">2.在该<span class="o">[</span>token<span class="o">]</span>部分中，配置Fernet令牌提供者
</span></span><span class="line"><span class="cl"><span class="o">[</span>token<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">provider</span> <span class="o">=</span> fernet
</span></span></code></pre></td></tr></table>
</div>
</div><p>填充身份服务数据库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">su -s /bin/sh -c <span class="s2">&#34;keystone-manage db_sync&#34;</span> keystone
</span></span></code></pre></td></tr></table>
</div>
</div><p>初始化Fernet密钥存储库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
</span></span><span class="line"><span class="cl">keystone-manage credential_setup --keystone-user keystone --keystone-group keystone
</span></span></code></pre></td></tr></table>
</div>
</div><p>引导身份服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">keystone-manage bootstrap --bootstrap-password Pass@w0rd <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --bootstrap-admin-url http://controller.openstack.fjf:5000/v3/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --bootstrap-internal-url http://controller.openstack.fjf:5000/v3/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --bootstrap-public-url http://controller.openstack.fjf:5000/v3/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --bootstrap-region-id RegionOne
</span></span></code></pre></td></tr></table>
</div>
</div><p>配置HTTP接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vim /etc/httpd/conf/httpd.conf
</span></span><span class="line"><span class="cl">ServerName controller.openstack.fjf
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建链接</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl <span class="nb">enable</span> httpd.service
</span></span><span class="line"><span class="cl">systemctl start httpd.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建admin-openrc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat &gt; /root/admin-openrc <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">export OS_USERNAME=admin
</span></span></span><span class="line"><span class="cl"><span class="s">export OS_PASSWORD=Pass@w0rd
</span></span></span><span class="line"><span class="cl"><span class="s">export OS_PROJECT_NAME=admin
</span></span></span><span class="line"><span class="cl"><span class="s">export OS_USER_DOMAIN_NAME=Default
</span></span></span><span class="line"><span class="cl"><span class="s">export OS_PROJECT_DOMAIN_NAME=Default
</span></span></span><span class="line"><span class="cl"><span class="s">export OS_AUTH_URL=http://controller.openstack.fjf:5000/v3
</span></span></span><span class="line"><span class="cl"><span class="s">export OS_IDENTITY_API_VERSION=3
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>加载admin-openrc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">. admin-openrc
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建service</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openstack project create --domain default <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --description <span class="s2">&#34;Service Project&#34;</span> service
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field       <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> description <span class="p">|</span> Service Project                  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> domain_id   <span class="p">|</span> default                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled     <span class="p">|</span> True                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id          <span class="p">|</span> 2c7d5b03d68746229cb60b9ae382d0ae <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> is_domain   <span class="p">|</span> False                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name        <span class="p">|</span> service                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> parent_id   <span class="p">|</span> default                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> tags        <span class="p">|</span> <span class="o">[]</span>                               <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>验证操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">openstack --os-auth-url http://controller.openstack.fjf:5000/v3 \
</span></span><span class="line"><span class="cl"> --os-project-domain-name Default --os-user-domain-name Default \
</span></span><span class="line"><span class="cl"> --os-project-name admin --os-username admin token issue
</span></span><span class="line"><span class="cl">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span><span class="line"><span class="cl">| Field      | Value                                                                                                                                                                                   |
</span></span><span class="line"><span class="cl">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span><span class="line"><span class="cl">| expires    | 2021-03-18T12:10:01+0000                                                                                                                                                                |
</span></span><span class="line"><span class="cl">| id         | gAAAAABgUzUJjJTsx4Vz1OY_vBBN28FQC3hH-xpqhITyvjSdF4pOykX8tCd0WX59rChxhC7kWZkrhQygcLj9Ari3pmKcZ5u9Ae4RTYJh1NpF8418xbbZCeZgxbVb9SOUgqCe0ftFzbewGmEL-hxhOmr3rd3WO2HYG47H6CR9WmDzSWsIei2NpPw |
</span></span><span class="line"><span class="cl">| project_id | 750d6512fc3043d1b1c6d832465cbf9f                                                                                                                                                        |
</span></span><span class="line"><span class="cl">| user_id    | 99cb132981a74d339868e54a0a4deb3c                                                                                                                                                        |
</span></span><span class="line"><span class="cl">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安装glance">安装glance</h2>
<p>二、安装glance(镜像服务)</p>
<p>建库，建用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># mysql -uroot -pPass@w0rd </span>
</span></span><span class="line"><span class="cl">Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span></span><span class="line"><span class="cl">Your MariaDB connection id is <span class="m">3</span>
</span></span><span class="line"><span class="cl">Server version: 10.1.20-MariaDB MariaDB Server
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2016, Oracle, MariaDB Corporation Ab and others.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; CREATE DATABASE glance<span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="s1">&#39;glance&#39;</span>@<span class="s1">&#39;localhost&#39;</span> IDENTIFIED BY <span class="s1">&#39;Passw0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="s1">&#39;glance&#39;</span>@<span class="s1">&#39;%&#39;</span> IDENTIFIED BY <span class="s1">&#39;Passw0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>加载admin-openrc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">. admin-openrc
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack user create --domain default --password-prompt glance</span>
</span></span><span class="line"><span class="cl">User Password:Pass@w0rd
</span></span><span class="line"><span class="cl">Repeat User Password:Pass@w0rd
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field               <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> domain_id           <span class="p">|</span> default                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled             <span class="p">|</span> True                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id                  <span class="p">|</span> 06d7dd9775a3482886790405f3bfe298 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name                <span class="p">|</span> glance                           <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> options             <span class="p">|</span> <span class="o">{}</span>                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> password_expires_at <span class="p">|</span> None                             <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>授权</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openstack role add --project service --user glance admin
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack service create --name glance   --description &#34;OpenStack Image&#34; image</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field       <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> description <span class="p">|</span> OpenStack Image                  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled     <span class="p">|</span> True                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id          <span class="p">|</span> 56c2b257f48d4d7aa4768a0f1f2367ca <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name        <span class="p">|</span> glance                           <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="nb">type</span>        <span class="p">|</span> image                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建API接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne   image public http://controller.openstack.fjf:9292</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> 36c0f0dec23f435fb5e3bbd6ac0ce5ff     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> public                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 56c2b257f48d4d7aa4768a0f1f2367ca     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> glance                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> image                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:9292 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne   image internal http://controller.openstack.fjf:9292</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> 236f70c24afb4049ac2660cbecd0b7a2     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> internal                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 56c2b257f48d4d7aa4768a0f1f2367ca     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> glance                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> image                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:9292 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne   image admin http://controller.openstack.fjf:9292</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> 36f005f69dd74f52b3f5bf0cce3c46d7     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> admin                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 56c2b257f48d4d7aa4768a0f1f2367ca     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> glance                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> image                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:9292 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装和配置组件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">yum install openstack-glance -y
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/glance/glance-api.conf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>database<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 注意此处的密码是Passw0rd而不是Pass@w0rd,改组件连接串中不支持&#39;@&#39;符号</span>
</span></span><span class="line"><span class="cl"><span class="nv">connection</span> <span class="o">=</span> mysql+pymysql://glance:Passw0rd@controller.openstack.fjf/glance
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">www_authenticate_uri</span>  <span class="o">=</span> http://controller.openstack.fjf:5000
</span></span><span class="line"><span class="cl"><span class="nv">auth_url</span> <span class="o">=</span> http://controller.openstack.fjf:5000
</span></span><span class="line"><span class="cl"><span class="nv">memcached_servers</span> <span class="o">=</span> controller.openstack.fjf:11211
</span></span><span class="line"><span class="cl"><span class="nv">auth_type</span> <span class="o">=</span> password
</span></span><span class="line"><span class="cl"><span class="nv">project_domain_name</span> <span class="o">=</span> Default
</span></span><span class="line"><span class="cl"><span class="nv">user_domain_name</span> <span class="o">=</span> Default
</span></span><span class="line"><span class="cl"><span class="nv">project_name</span> <span class="o">=</span> service
</span></span><span class="line"><span class="cl"><span class="nv">username</span> <span class="o">=</span> glance
</span></span><span class="line"><span class="cl"><span class="nv">password</span> <span class="o">=</span> Pass@w0rd
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>paste_deploy<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">flavor</span> <span class="o">=</span> keystone
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>glance_store<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">stores</span> <span class="o">=</span> file,http
</span></span><span class="line"><span class="cl"><span class="nv">default_store</span> <span class="o">=</span> file
</span></span><span class="line"><span class="cl"><span class="nv">filesystem_store_datadir</span> <span class="o">=</span> /var/lib/glance/images/
</span></span></code></pre></td></tr></table>
</div>
</div><p>填充图像服务数据库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># su -s /bin/sh -c &#34;glance-manage db_sync&#34; glance</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 出现此警告可以忽略   </span>
</span></span><span class="line"><span class="cl">/usr/lib/python2.7/site-packages/oslo_db/sqlalchemy/enginefacade.py:1336: OsloDBDeprecationWarning: EngineFacade is deprecated<span class="p">;</span> please use oslo_db.sqlalchemy.enginefacade
</span></span><span class="line"><span class="cl">  <span class="nv">expire_on_commit</span><span class="o">=</span>expire_on_commit, <span class="nv">_conf</span><span class="o">=</span>conf<span class="o">)</span>
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade  -&gt; liberty, liberty initial
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade liberty -&gt; mitaka01, add index on created_at and updated_at columns of <span class="s1">&#39;images&#39;</span> table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade mitaka01 -&gt; mitaka02, update metadef os_nova_server
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade mitaka02 -&gt; ocata_expand01, add visibility to images
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade ocata_expand01 -&gt; pike_expand01, empty expand <span class="k">for</span> symmetry with pike_contract01
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade pike_expand01 -&gt; queens_expand01
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">Upgraded database to: queens_expand01, current revision<span class="o">(</span>s<span class="o">)</span>: queens_expand01
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">Database migration is up to date. No migration needed.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade mitaka02 -&gt; ocata_contract01, remove is_public from images
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade ocata_contract01 -&gt; pike_contract01, drop glare artifacts tables
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade pike_contract01 -&gt; queens_contract01
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">Upgraded database to: queens_contract01, current revision<span class="o">(</span>s<span class="o">)</span>: queens_contract01
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">Database is synced successfully.
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl <span class="nb">enable</span> openstack-glance-api.service
</span></span><span class="line"><span class="cl">systemctl start openstack-glance-api.service
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安装compute控制节点">安装Compute|控制节点</h2>
<p>三、安装Compute(计算服务)&amp;Placement(调度服务)</p>
<p>建库，建用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># mysql -uroot -pPass@w0rd               </span>
</span></span><span class="line"><span class="cl">Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span></span><span class="line"><span class="cl">Your MariaDB connection id is <span class="m">11</span>
</span></span><span class="line"><span class="cl">Server version: 10.1.20-MariaDB MariaDB Server
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2016, Oracle, MariaDB Corporation Ab and others.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; CREATE DATABASE nova_api<span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; CREATE DATABASE nova<span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; CREATE DATABASE nova_cell0<span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON nova_api.* TO <span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;localhost&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON nova_api.* TO <span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;%&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON nova.* TO <span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;localhost&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON nova.* TO <span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;%&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;localhost&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;%&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>加载admin-openrc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">. admin-openrc
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建Nova用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack user create --domain default --password-prompt nova</span>
</span></span><span class="line"><span class="cl">User Password:Pass@w0rd
</span></span><span class="line"><span class="cl">Repeat User Password:Pass@w0rd
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field               <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> domain_id           <span class="p">|</span> default                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled             <span class="p">|</span> True                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id                  <span class="p">|</span> fa90e0ee1be34a7c8d9d77bf2db3ca7e <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name                <span class="p">|</span> nova                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> options             <span class="p">|</span> <span class="o">{}</span>                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> password_expires_at <span class="p">|</span> None                             <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>授权Nova</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openstack role add --project service --user nova admin
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建计算服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack service create --name nova --description &#34;OpenStack Compute&#34; compute</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field       <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> description <span class="p">|</span> OpenStack Compute                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled     <span class="p">|</span> True                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id          <span class="p">|</span> 0795642e98ce42c8bac111a21625976c <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name        <span class="p">|</span> nova                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="nb">type</span>        <span class="p">|</span> compute                          <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建计算API接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne compute public http://controller.openstack.fjf:8774/v2.1</span>
</span></span><span class="line"><span class="cl">+--------------+-------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                     <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+-------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> f1569159f0444831b29d4e0732aeca27          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> public                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 0795642e98ce42c8bac111a21625976c          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> nova                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> compute                                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:8774/v2.1 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+-------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne compute internal http://controller.openstack.fjf:8774/v2.1</span>
</span></span><span class="line"><span class="cl">+--------------+-------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                     <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+-------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> 465c36ab7dcc4e849c835ae9ef174eba          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> internal                                  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 0795642e98ce42c8bac111a21625976c          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> nova                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> compute                                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:8774/v2.1 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+-------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne compute admin http://controller.openstack.fjf:8774/v2.1</span>
</span></span><span class="line"><span class="cl">+--------------+-------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                     <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+-------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> 879816f84f6444b4a65bab6f8d620d08          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> admin                                     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 0795642e98ce42c8bac111a21625976c          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> nova                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> compute                                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:8774/v2.1 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+-------------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建placement用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack user create --domain default --password-prompt placement</span>
</span></span><span class="line"><span class="cl">User Password:Pass@w0rd
</span></span><span class="line"><span class="cl">Repeat User Password:Pass@w0rd
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field               <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> domain_id           <span class="p">|</span> default                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled             <span class="p">|</span> True                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id                  <span class="p">|</span> f0b41802435f4d3dad27c6711bb3de73 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name                <span class="p">|</span> placement                        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> options             <span class="p">|</span> <span class="o">{}</span>                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> password_expires_at <span class="p">|</span> None                             <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>授权placement</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openstack role add --project service --user placement admin
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建调度器服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack service create --name placement --description &#34;Placement API&#34; placement</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field       <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> description <span class="p">|</span> Placement API                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled     <span class="p">|</span> True                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id          <span class="p">|</span> 315aa5dae18c4c6bb2a6105f25a11c98 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name        <span class="p">|</span> placement                        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="nb">type</span>        <span class="p">|</span> placement                        <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建调度器API接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne placement public http://controller.openstack.fjf:8778</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> bb6eeb117b2c421498bd5d74ab2304e0     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> public                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 7b2281d9a2e1436e8d6b9721774deb01     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> placement                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> placement                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:8778 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne placement internal http://controller.openstack.fjf:8778</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> fed2080d301247e4b9cb9e2b2a4bde55     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> internal                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 7b2281d9a2e1436e8d6b9721774deb01     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> placement                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> placement                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:8778 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne placement admin http://controller.openstack.fjf:8778</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> 3d255c3a2ebb4d249f063e1392767fd7     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> admin                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 7b2281d9a2e1436e8d6b9721774deb01     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> placement                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> placement                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:8778 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装和配置组件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum install openstack-nova-api openstack-nova-conductor   openstack-nova-console openstack-nova-novncproxy   openstack-nova-scheduler openstack-nova-placement-api -y
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/nova/nova.conf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>DEFAULT<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">enabled_apis</span> <span class="o">=</span> osapi_compute,metadata
</span></span><span class="line"><span class="cl"><span class="nv">use_neutron</span> <span class="o">=</span> True
</span></span><span class="line"><span class="cl"><span class="nv">firewall_driver</span> <span class="o">=</span> nova.virt.firewall.NoopFirewallDriver
</span></span><span class="line"><span class="cl"><span class="nv">my_ip</span> <span class="o">=</span> 192.168.81.40
</span></span><span class="line"><span class="cl"><span class="nv">connection</span> <span class="o">=</span> mysql+pymysql://nova:Pass@w0rd@controller.openstack.fjf/nova_api
</span></span><span class="line"><span class="cl"><span class="nv">transport_url</span> <span class="o">=</span> rabbit://openstack:Pass@w0rd@controller.openstack.fjf
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>api_database<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">connection</span> <span class="o">=</span> mysql+pymysql://nova:Pass@w0rd@controller.openstack.fjf/nova_api
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>database<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">connection</span> <span class="o">=</span> mysql+pymysql://nova:Pass@w0rd@controller.openstack.fjf/nova
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>api<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">auth_strategy</span> <span class="o">=</span> keystone
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">auth_uri</span> <span class="o">=</span> http://controller.openstack.fjf:5000
</span></span><span class="line"><span class="cl"><span class="nv">auth_url</span> <span class="o">=</span> http://controller.openstack.fjf:35357
</span></span><span class="line"><span class="cl"><span class="nv">memcached_servers</span> <span class="o">=</span> controller.openstack.fjf:11211
</span></span><span class="line"><span class="cl"><span class="nv">auth_type</span> <span class="o">=</span> password
</span></span><span class="line"><span class="cl"><span class="nv">project_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">user_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">project_name</span> <span class="o">=</span> service
</span></span><span class="line"><span class="cl"><span class="nv">username</span> <span class="o">=</span> nova
</span></span><span class="line"><span class="cl"><span class="nv">password</span> <span class="o">=</span> Pass@w0rd
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>vnc<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">vncserver_listen</span> <span class="o">=</span> <span class="nv">$my_ip</span>
</span></span><span class="line"><span class="cl"><span class="nv">vncserver_proxyclient_address</span> <span class="o">=</span> <span class="nv">$my_ip</span>
</span></span><span class="line"><span class="cl"><span class="nv">novncproxy_base_url</span> <span class="o">=</span> http://controller.openstack.fjf:6080/vnc_auto.html
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>glance<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">api_servers</span> <span class="o">=</span> http://controller.openstack.fjf:9292
</span></span><span class="line"><span class="cl"><span class="o">[</span>oslo_concurrency<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">lock_path</span> <span class="o">=</span> /var/lib/nova/tmp
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>placement<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">os_region_name</span> <span class="o">=</span> RegionOne
</span></span><span class="line"><span class="cl"><span class="nv">project_domain_name</span> <span class="o">=</span> Default
</span></span><span class="line"><span class="cl"><span class="nv">project_name</span> <span class="o">=</span> service
</span></span><span class="line"><span class="cl"><span class="nv">auth_type</span> <span class="o">=</span> password
</span></span><span class="line"><span class="cl"><span class="nv">user_domain_name</span> <span class="o">=</span> Default
</span></span><span class="line"><span class="cl"><span class="nv">auth_url</span> <span class="o">=</span> http://controller.openstack.fjf:35357/v3
</span></span><span class="line"><span class="cl"><span class="nv">username</span> <span class="o">=</span> placement
</span></span><span class="line"><span class="cl"><span class="nv">password</span> <span class="o">=</span> Pass@w0rd
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/httpd/conf.d/00-nova-placement-api.conf，尾部添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&lt;Directory /usr/bin&gt;
</span></span><span class="line"><span class="cl">   &lt;IfVersion &gt;<span class="o">=</span> 2.4&gt;
</span></span><span class="line"><span class="cl">      Require all granted
</span></span><span class="line"><span class="cl">   &lt;/IfVersion&gt;
</span></span><span class="line"><span class="cl">   &lt;IfVersion &lt; 2.4&gt;
</span></span><span class="line"><span class="cl">      Order allow,deny
</span></span><span class="line"><span class="cl">      Allow from all
</span></span><span class="line"><span class="cl">   &lt;/IfVersion&gt;
</span></span><span class="line"><span class="cl">&lt;/Directory&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启httpd</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl restart httpd
</span></span></code></pre></td></tr></table>
</div>
</div><p>初始化数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># su -s /bin/sh -c &#34;nova-manage api_db sync&#34; nova</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># su -s /bin/sh -c &#34;nova-manage cell_v2 map_cell0&#34; nova</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># su -s /bin/sh -c &#34;nova-manage cell_v2 create_cell --name=cell1 --verbose&#34; nova</span>
</span></span><span class="line"><span class="cl">5d590937-4a0e-488e-9766-9db19d151a51
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># su -s /bin/sh -c &#34;nova-manage db sync&#34; nova</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 警告信息可以忽略</span>
</span></span><span class="line"><span class="cl">/usr/lib/python2.7/site-packages/pymysql/cursors.py:170: Warning: <span class="o">(</span>1831, u<span class="s1">&#39;Duplicate index `block_device_mapping_instance_uuid_virtual_name_device_name_idx`. This is deprecated and will be disallowed in a future release.&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">result</span> <span class="o">=</span> self._query<span class="o">(</span>query<span class="o">)</span>
</span></span><span class="line"><span class="cl">/usr/lib/python2.7/site-packages/pymysql/cursors.py:170: Warning: <span class="o">(</span>1831, u<span class="s1">&#39;Duplicate index `uniq_instances0uuid`. This is deprecated and will be disallowed in a future release.&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">result</span> <span class="o">=</span> self._query<span class="o">(</span>query<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># nova-manage cell_v2 list_cells</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 验证数据</span>
</span></span><span class="line"><span class="cl">+-------+--------------------------------------+--------------------------------------------------+---------------------------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span>  Name <span class="p">|</span>                 UUID                 <span class="p">|</span>                  Transport URL                   <span class="p">|</span>                      Database Connection                      <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------+--------------------------------------+--------------------------------------------------+---------------------------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> cell0 <span class="p">|</span> 00000000-0000-0000-0000-000000000000 <span class="p">|</span>                      none:/                      <span class="p">|</span> mysql+pymysql://nova:****@controller.openstack.fjf/nova_cell0 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> cell1 <span class="p">|</span> 5d590937-4a0e-488e-9766-9db19d151a51 <span class="p">|</span> rabbit://openstack:****@controller.openstack.fjf <span class="p">|</span>    mysql+pymysql://nova:****@controller.openstack.fjf/nova    <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------+--------------------------------------+--------------------------------------------------+---------------------------------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> openstack-nova-api.service   openstack-nova-consoleauth.service openstack-nova-scheduler.service   openstack-nova-conductor.service openstack-nova-novncproxy.service
</span></span><span class="line"><span class="cl">systemctl start openstack-nova-api.service   openstack-nova-consoleauth.service openstack-nova-scheduler.service   openstack-nova-conductor.service openstack-nova-novncproxy.service
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安装compute计算节点">安装Compute|计算节点</h2>
<p>四、安装Compute(计算服务)，为了节省资源可以将计算节点和控制节点安装在一起这样控制节点也可以运行虚拟机</p>
<p>安装组件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum install openstack-nova-compute
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑配置/etc/nova/nova.conf，如果是在控制节点上添加计算服务则不需要修改</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>DEFAULT<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">enabled_apis</span> <span class="o">=</span> osapi_compute,metadata
</span></span><span class="line"><span class="cl"><span class="nv">my_ip</span> <span class="o">=</span> 192.168.81.40
</span></span><span class="line"><span class="cl"><span class="nv">use_neutron</span> <span class="o">=</span> True
</span></span><span class="line"><span class="cl"><span class="nv">firewall_driver</span> <span class="o">=</span> nova.virt.firewall.NoopFirewallDriver
</span></span><span class="line"><span class="cl"><span class="nv">transport_url</span> <span class="o">=</span> rabbit://openstack:Pass@w0rd@controller.openstack.fjf
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>api<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">auth_strategy</span> <span class="o">=</span> keystone
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">auth_uri</span> <span class="o">=</span> http://controller.openstack.fjf:5000
</span></span><span class="line"><span class="cl"><span class="nv">auth_url</span> <span class="o">=</span> http://controller.openstack.fjf:35357
</span></span><span class="line"><span class="cl"><span class="nv">memcached_servers</span> <span class="o">=</span> controller.openstack.fjf:11211
</span></span><span class="line"><span class="cl"><span class="nv">auth_type</span> <span class="o">=</span> password
</span></span><span class="line"><span class="cl"><span class="nv">project_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">user_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">project_name</span> <span class="o">=</span> service
</span></span><span class="line"><span class="cl"><span class="nv">username</span> <span class="o">=</span> nova
</span></span><span class="line"><span class="cl"><span class="nv">password</span> <span class="o">=</span> Pass@w0rd
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>vnc<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span> <span class="o">=</span> True
</span></span><span class="line"><span class="cl"><span class="nv">vncserver_listen</span> <span class="o">=</span> 0.0.0.0
</span></span><span class="line"><span class="cl"><span class="nv">vncserver_proxyclient_address</span> <span class="o">=</span> <span class="nv">$my_ip</span>
</span></span><span class="line"><span class="cl"><span class="nv">novncproxy_base_url</span> <span class="o">=</span> http://controller.openstack.fjf:6080/vnc_auto.html
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>glance<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">api_servers</span> <span class="o">=</span> http://controller.openstack.fjf:9292
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>oslo_concurrency<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">lock_path</span> <span class="o">=</span> /var/lib/nova/tmp
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>placement<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">os_region_name</span> <span class="o">=</span> RegionOne
</span></span><span class="line"><span class="cl"><span class="nv">project_domain_name</span> <span class="o">=</span> Default
</span></span><span class="line"><span class="cl"><span class="nv">project_name</span> <span class="o">=</span> service
</span></span><span class="line"><span class="cl"><span class="nv">auth_type</span> <span class="o">=</span> password
</span></span><span class="line"><span class="cl"><span class="nv">user_domain_name</span> <span class="o">=</span> Default
</span></span><span class="line"><span class="cl"><span class="nv">auth_url</span> <span class="o">=</span> http://controller.openstack.fjf:35357/v3
</span></span><span class="line"><span class="cl"><span class="nv">username</span> <span class="o">=</span> placement
</span></span><span class="line"><span class="cl"><span class="nv">password</span> <span class="o">=</span> Pass@w0rd
</span></span></code></pre></td></tr></table>
</div>
</div><p>检查是否支持硬件虚拟化</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># egrep -c &#39;(vmx|svm)&#39; /proc/cpuinfo</span>
</span></span><span class="line"><span class="cl"><span class="m">8</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 如果结果为0，则需要添加以下配置</span>
</span></span><span class="line"><span class="cl">编辑 /etc/nova/nova.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>libvirt<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">virt_type</span> <span class="o">=</span> qemu
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl <span class="nb">enable</span> libvirtd.service openstack-nova-compute.service
</span></span><span class="line"><span class="cl">systemctl start  libvirtd.service openstack-nova-compute.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>添加计算节点到元数据库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">. admin-openrc
</span></span><span class="line"><span class="cl"><span class="c1"># 扫描计算主机</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># su -s /bin/sh -c &#34;nova-manage cell_v2 discover_hosts --verbose&#34; nova</span>
</span></span><span class="line"><span class="cl">Found <span class="m">2</span> cell mappings.
</span></span><span class="line"><span class="cl">Skipping cell0 since it does not contain hosts.
</span></span><span class="line"><span class="cl">Getting computes from cell <span class="s1">&#39;cell1&#39;</span>: 5d590937-4a0e-488e-9766-9db19d151a51
</span></span><span class="line"><span class="cl">Checking host mapping <span class="k">for</span> compute host <span class="s1">&#39;controller.openstack.fjf&#39;</span>: deb6c5fe-24a6-4b1e-af8f-fe448491a565
</span></span><span class="line"><span class="cl">Creating host mapping <span class="k">for</span> compute host <span class="s1">&#39;controller.openstack.fjf&#39;</span>: deb6c5fe-24a6-4b1e-af8f-fe448491a565
</span></span><span class="line"><span class="cl">Found <span class="m">1</span> unmapped computes in cell: 5d590937-4a0e-488e-9766-9db19d151a51
</span></span><span class="line"><span class="cl"><span class="c1"># 查看主机状态</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack hypervisor list                                          </span>
</span></span><span class="line"><span class="cl">+----+--------------------------+-----------------+---------------+-------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> ID <span class="p">|</span> Hypervisor Hostname      <span class="p">|</span> Hypervisor Type <span class="p">|</span> Host IP       <span class="p">|</span> State <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----+--------------------------+-----------------+---------------+-------+
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> controller.openstack.fjf <span class="p">|</span> QEMU            <span class="p">|</span> 192.168.81.40 <span class="p">|</span> up    <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----+--------------------------+-----------------+---------------+-------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：添加计算节点后必须在控制节点执行nova-manage cell_v2 discover_hosts才能发现新的计算节点，可以调整/etc/nova/nova.conf中的参数discover_hosts_in_cells_interval = 300，表示为300s自动扫描一次</p>
<h2 id="安装neutron">安装neutron</h2>
<p>五、安装neutron(网络服务)</p>
<p>建库，建用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># mysql -uroot -pPass@w0rd              </span>
</span></span><span class="line"><span class="cl">Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span></span><span class="line"><span class="cl">Your MariaDB connection id is <span class="m">3182</span>
</span></span><span class="line"><span class="cl">Server version: 10.1.20-MariaDB MariaDB Server
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2016, Oracle, MariaDB Corporation Ab and others.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; CREATE DATABASE neutron<span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON neutron.* TO <span class="s1">&#39;neutron&#39;</span>@<span class="s1">&#39;localhost&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; GRANT ALL PRIVILEGES ON neutron.* TO <span class="s1">&#39;neutron&#39;</span>@<span class="s1">&#39;%&#39;</span> IDENTIFIED BY <span class="s1">&#39;Pass@w0rd&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>加载admin-openrc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">. admin-openrc
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack user create --domain default --password-prompt neutron</span>
</span></span><span class="line"><span class="cl">User Password:
</span></span><span class="line"><span class="cl">Repeat User Password:
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field               <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> domain_id           <span class="p">|</span> default                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled             <span class="p">|</span> True                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id                  <span class="p">|</span> c6ea433a2f83472f8218b60dbdf1827a <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name                <span class="p">|</span> neutron                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> options             <span class="p">|</span> <span class="o">{}</span>                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> password_expires_at <span class="p">|</span> None                             <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>授权</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">openstack role add --project service --user neutron admin
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack service create --name neutron --description &#34;OpenStack Networking&#34; network</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field       <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> description <span class="p">|</span> OpenStack Networking             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled     <span class="p">|</span> True                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id          <span class="p">|</span> 9b2865e3489c4da3b6c250abf2e73e80 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name        <span class="p">|</span> neutron                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="nb">type</span>        <span class="p">|</span> network                          <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+----------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建API接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne network public http://controller.openstack.fjf:9696</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> f3a7c91366d84b49aa84841585ee3d36     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> public                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 9b2865e3489c4da3b6c250abf2e73e80     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> neutron                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> network                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:9696 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne network internal http://controller.openstack.fjf:9696</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> e5bac77508904343b93f12a19294a7dd     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> internal                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 9b2865e3489c4da3b6c250abf2e73e80     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> neutron                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> network                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:9696 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne network admin http://controller.openstack.fjf:9696</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field        <span class="p">|</span> Value                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> enabled      <span class="p">|</span> True                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id           <span class="p">|</span> 20e22cf74f9b4ac99ee20bc95cfd3433     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> interface    <span class="p">|</span> admin                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region       <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> region_id    <span class="p">|</span> RegionOne                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_id   <span class="p">|</span> 9b2865e3489c4da3b6c250abf2e73e80     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_name <span class="p">|</span> neutron                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> service_type <span class="p">|</span> network                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> url          <span class="p">|</span> http://controller.openstack.fjf:9696 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------+--------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装网络组件，有两种Provider networks和Self-service networks，Self-service networks提供L3（三层路由）的能力，因为网络组件部署后无法更改，所以使用Self-service networks，其可以涵盖更多的网络类型方便以后网络变化</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables -y
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑配置文件</p>
<p>编辑/etc/neutron/neutron.conf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>database<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">connection</span> <span class="o">=</span> mysql+pymysql://neutron:Pass@w0rd@controller.openstack.fjf/neutron
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>DEFAULT<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">core_plugin</span> <span class="o">=</span> ml2
</span></span><span class="line"><span class="cl"><span class="nv">service_plugins</span> <span class="o">=</span> router
</span></span><span class="line"><span class="cl"><span class="nv">allow_overlapping_ips</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nv">transport_url</span> <span class="o">=</span> rabbit://openstack:Pass@w0rd@controller.openstack.fjf
</span></span><span class="line"><span class="cl"><span class="nv">auth_strategy</span> <span class="o">=</span> keystone
</span></span><span class="line"><span class="cl"><span class="nv">notify_nova_on_port_status_changes</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nv">notify_nova_on_port_data_changes</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">auth_uri</span> <span class="o">=</span> http://controller.openstack.fjf:5000
</span></span><span class="line"><span class="cl"><span class="nv">auth_url</span> <span class="o">=</span> http://controller.openstack.fjf:35357
</span></span><span class="line"><span class="cl"><span class="nv">memcached_servers</span> <span class="o">=</span> controller.openstack.fjf:11211
</span></span><span class="line"><span class="cl"><span class="nv">auth_type</span> <span class="o">=</span> password
</span></span><span class="line"><span class="cl"><span class="nv">project_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">user_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">project_name</span> <span class="o">=</span> service
</span></span><span class="line"><span class="cl"><span class="nv">username</span> <span class="o">=</span> neutron
</span></span><span class="line"><span class="cl"><span class="nv">password</span> <span class="o">=</span> Pass@w0rd
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>nova<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">auth_url</span> <span class="o">=</span> http://controller.openstack.fjf:35357
</span></span><span class="line"><span class="cl"><span class="nv">auth_type</span> <span class="o">=</span> password
</span></span><span class="line"><span class="cl"><span class="nv">project_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">user_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">region_name</span> <span class="o">=</span> RegionOne
</span></span><span class="line"><span class="cl"><span class="nv">project_name</span> <span class="o">=</span> service
</span></span><span class="line"><span class="cl"><span class="nv">username</span> <span class="o">=</span> nova
</span></span><span class="line"><span class="cl"><span class="nv">password</span> <span class="o">=</span> Pass@w0rd
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>oslo_concurrency<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">lock_path</span> <span class="o">=</span> /var/lib/neutron/tmp
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/neutron/plugins/ml2/ml2_conf.ini</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>ml2<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">type_drivers</span> <span class="o">=</span> flat,vlan,vxlan
</span></span><span class="line"><span class="cl"><span class="nv">tenant_network_types</span> <span class="o">=</span> vxlan
</span></span><span class="line"><span class="cl"><span class="nv">mechanism_drivers</span> <span class="o">=</span> linuxbridge,l2population
</span></span><span class="line"><span class="cl"><span class="nv">extension_drivers</span> <span class="o">=</span> port_security
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ml2_type_flat<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">flat_networks</span> <span class="o">=</span> provider
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ml2_type_vlan<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">network_vlan_ranges</span> <span class="o">=</span> physvlan:1:1000
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ml2_type_vxlan<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">vni_ranges</span> <span class="o">=</span> 1:1000
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>securitygroup<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">enable_ipset</span> <span class="o">=</span> <span class="nb">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/neutron/plugins/ml2/linuxbridge_agent.ini</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>linux_bridge<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">physical_interface_mappings</span> <span class="o">=</span> provider:eth0
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>vxlan<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">enable_vxlan</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nv">local_ip</span> <span class="o">=</span> 192.168.81.40
</span></span><span class="line"><span class="cl"><span class="nv">l2_population</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>securitygroup<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">enable_security_group</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nv">firewall_driver</span> <span class="o">=</span> neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/neutron/l3_agent.ini</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>DEFAULT<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">interface_driver</span> <span class="o">=</span> linuxbridge
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/neutron/dhcp_agent.ini</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>DEFAULT<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">interface_driver</span> <span class="o">=</span> linuxbridge
</span></span><span class="line"><span class="cl"><span class="nv">dhcp_driver</span> <span class="o">=</span> neutron.agent.linux.dhcp.Dnsmasq
</span></span><span class="line"><span class="cl"><span class="nv">enable_isolated_metadata</span> <span class="o">=</span> <span class="nb">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/neutron/metadata_agent.ini</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>DEFAULT<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">nova_metadata_host</span> <span class="o">=</span> controller.openstack.fjf
</span></span><span class="line"><span class="cl"><span class="c1"># 共享密钥随机生成一个</span>
</span></span><span class="line"><span class="cl"><span class="nv">metadata_proxy_shared_secret</span> <span class="o">=</span> RpP55i3dSRRoHq8x
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑/etc/nova/nova.conf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>neutron<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">url</span> <span class="o">=</span> http://controller.openstack.fjf:9696
</span></span><span class="line"><span class="cl"><span class="nv">auth_url</span> <span class="o">=</span> http://controller.openstack.fjf:35357
</span></span><span class="line"><span class="cl"><span class="nv">auth_type</span> <span class="o">=</span> password
</span></span><span class="line"><span class="cl"><span class="nv">project_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">user_domain_name</span> <span class="o">=</span> default
</span></span><span class="line"><span class="cl"><span class="nv">region_name</span> <span class="o">=</span> RegionOne
</span></span><span class="line"><span class="cl"><span class="nv">project_name</span> <span class="o">=</span> service
</span></span><span class="line"><span class="cl"><span class="nv">username</span> <span class="o">=</span> neutron
</span></span><span class="line"><span class="cl"><span class="nv">password</span> <span class="o">=</span> Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nv">service_metadata_proxy</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nv">metadata_proxy_shared_secret</span> <span class="o">=</span> RpP55i3dSRRoHq8x
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建配置链接</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini
</span></span></code></pre></td></tr></table>
</div>
</div><p>初始化数据库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@controller ~<span class="o">]</span><span class="c1"># su -s /bin/sh -c &#34;neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&#34; neutron</span>
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">  Running upgrade <span class="k">for</span> neutron ...
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Context impl MySQLImpl.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Will assume non-transactional DDL.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade  -&gt; kilo, kilo_initial
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade kilo -&gt; 354db87e3225, nsxv_vdr_metadata.py
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 354db87e3225 -&gt; 599c6a226151, neutrodb_ipam
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 599c6a226151 -&gt; 52c5312f6baf, Initial operations in support of address scopes
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 52c5312f6baf -&gt; 313373c0ffee, Flavor framework
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 313373c0ffee -&gt; 8675309a5c4f, network_rbac
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 8675309a5c4f -&gt; 45f955889773, quota_usage
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 45f955889773 -&gt; 26c371498592, subnetpool <span class="nb">hash</span>
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 26c371498592 -&gt; 1c844d1677f7, add order to dnsnameservers
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 1c844d1677f7 -&gt; 1b4c6e320f79, address scope support in subnetpool
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 1b4c6e320f79 -&gt; 48153cb5f051, qos db changes
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 48153cb5f051 -&gt; 9859ac9c136, quota_reservations
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 9859ac9c136 -&gt; 34af2b5c5a59, Add dns_name to Port
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 34af2b5c5a59 -&gt; 59cb5b6cf4d, Add availability zone
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 59cb5b6cf4d -&gt; 13cfb89f881a, add is_default to subnetpool
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 13cfb89f881a -&gt; 32e5974ada25, Add standard attribute table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 32e5974ada25 -&gt; ec7fcfbf72ee, Add network availability zone
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade ec7fcfbf72ee -&gt; dce3ec7a25c9, Add router availability zone
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade dce3ec7a25c9 -&gt; c3a73f615e4, Add ip_version to AddressScope
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade c3a73f615e4 -&gt; 659bf3d90664, Add tables and attributes to support external DNS integration
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 659bf3d90664 -&gt; 1df244e556f5, add_unique_ha_router_agent_port_bindings
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 1df244e556f5 -&gt; 19f26505c74f, Auto Allocated Topology - aka Get-Me-A-Network
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 19f26505c74f -&gt; 15be73214821, add dynamic routing model data
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 15be73214821 -&gt; b4caf27aae4, add_bgp_dragent_model_data
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade b4caf27aae4 -&gt; 15e43b934f81, rbac_qos_policy
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 15e43b934f81 -&gt; 31ed664953e6, Add resource_versions row to agent table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 31ed664953e6 -&gt; 2f9e956e7532, tag support
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 2f9e956e7532 -&gt; 3894bccad37f, add_timestamp_to_base_resources
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 3894bccad37f -&gt; 0e66c5227a8a, Add desc to standard attr table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 0e66c5227a8a -&gt; 45f8dd33480b, qos dscp db addition
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 45f8dd33480b -&gt; 5abc0278ca73, Add support <span class="k">for</span> VLAN trunking
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 5abc0278ca73 -&gt; d3435b514502, Add device_id index to Port
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade d3435b514502 -&gt; 30107ab6a3ee, provisioning_blocks.py
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 30107ab6a3ee -&gt; c415aab1c048, add revisions table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade c415aab1c048 -&gt; a963b38d82f4, add dns name to portdnses
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade kilo -&gt; 30018084ec99, Initial no-op Liberty contract rule.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 30018084ec99 -&gt; 4ffceebfada, network_rbac
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 4ffceebfada -&gt; 5498d17be016, Drop legacy OVS and LB plugin tables
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 5498d17be016 -&gt; 2a16083502f3, Metaplugin removal
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 2a16083502f3 -&gt; 2e5352a0ad4d, Add missing foreign keys
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 2e5352a0ad4d -&gt; 11926bcfe72d, add geneve ml2 <span class="nb">type</span> driver
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 11926bcfe72d -&gt; 4af11ca47297, Drop cisco monolithic tables
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 4af11ca47297 -&gt; 1b294093239c, Drop embrane plugin table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 1b294093239c -&gt; 8a6d8bdae39, standardattributes migration
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 8a6d8bdae39 -&gt; 2b4c2465d44b, DVR sheduling refactoring
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 2b4c2465d44b -&gt; e3278ee65050, Drop NEC plugin tables
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade e3278ee65050 -&gt; c6c112992c9, rbac_qos_policy
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade c6c112992c9 -&gt; 5ffceebfada, network_rbac_external
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 5ffceebfada -&gt; 4ffceebfcdc, standard_desc
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 4ffceebfcdc -&gt; 7bbb25278f53, device_owner_ha_replicate_int
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 7bbb25278f53 -&gt; 89ab9a816d70, Rename ml2_network_segments table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade a963b38d82f4 -&gt; 3d0e74aa7d37, Add flavor_id to Router
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 3d0e74aa7d37 -&gt; 030a959ceafa, uniq_routerports0port_id
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 030a959ceafa -&gt; a5648cfeeadf, Add support <span class="k">for</span> Subnet Service Types
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade a5648cfeeadf -&gt; 0f5bef0f87d4, add_qos_minimum_bandwidth_rules
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 0f5bef0f87d4 -&gt; 67daae611b6e, add standardattr to qos policies
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 89ab9a816d70 -&gt; c879c5e1ee90, Add segment_id to subnet
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade c879c5e1ee90 -&gt; 8fd3918ef6f4, Add segment_host_mapping table.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 8fd3918ef6f4 -&gt; 4bcd4df1f426, Rename ml2_dvr_port_bindings
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 4bcd4df1f426 -&gt; b67e765a3524, Remove mtu column from networks.
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 67daae611b6e -&gt; 6b461a21bcfc, uniq_floatingips0floating_network_id0fixed_port_id0fixed_ip_addr
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 6b461a21bcfc -&gt; 5cd92597d11d, Add ip_allocation to port
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 5cd92597d11d -&gt; 929c968efe70, add_pk_version_table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 929c968efe70 -&gt; a9c43481023c, extend_pk_with_host_and_add_status_to_ml2_port_binding
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade a9c43481023c -&gt; 804a3c76314c, Add data_plane_status to Port
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 804a3c76314c -&gt; 2b42d90729da, qos add direction to bw_limit_rule table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 2b42d90729da -&gt; 62c781cb6192, add is default to qos policies
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 62c781cb6192 -&gt; c8c222d42aa9, logging api
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade c8c222d42aa9 -&gt; 349b6fd605a6, Add dns_domain to portdnses
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 349b6fd605a6 -&gt; 7d32f979895f, add mtu <span class="k">for</span> networks
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 7d32f979895f -&gt; 594422d373ee, fip qos
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade b67e765a3524 -&gt; a84ccf28f06a, migrate dns name from port
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade a84ccf28f06a -&gt; 7d9d8eeec6ad, rename tenant to project
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 7d9d8eeec6ad -&gt; a8b517cff8ab, Add routerport bindings <span class="k">for</span> L3 HA
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade a8b517cff8ab -&gt; 3b935b28e7a0, migrate to pluggable ipam
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 3b935b28e7a0 -&gt; b12a3ef66e62, add standardattr to qos policies
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade b12a3ef66e62 -&gt; 97c25b0d2353, Add Name and Description to the networksegments table
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 97c25b0d2353 -&gt; 2e0d7a8a1586, Add binding index to RouterL3AgentBinding
</span></span><span class="line"><span class="cl">INFO  <span class="o">[</span>alembic.runtime.migration<span class="o">]</span> Running upgrade 2e0d7a8a1586 -&gt; 5c85685d616d, Remove availability ranges.
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启Nova服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl restart openstack-nova-api.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动网络服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl <span class="nb">enable</span> neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service neutron-l3-agent.service
</span></span><span class="line"><span class="cl">systemctl start neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service neutron-l3-agent.service
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安装dashboard">安装dashboard</h2>
<p>安装Dashboard(WEB管理控制台)</p>
<p>安装组件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum install openstack-dashboard -y
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑配置/etc/openstack-dashboard/local_settings，如果是在控制节点上添加计算服务则不需要修改</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">OPENSTACK_HOST</span> <span class="o">=</span> <span class="s2">&#34;controller.openstack.fjf&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;controller.openstack.fjf&#39;</span>, <span class="s1">&#39;192.168.81.40&#39;</span>,<span class="s1">&#39;localhost&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">SESSION_ENGINE</span> <span class="o">=</span> <span class="s1">&#39;django.contrib.sessions.backends.cache&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">CACHES</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;default&#39;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;BACKEND&#39;</span>: <span class="s1">&#39;django.core.cache.backends.memcached.MemcachedCache&#39;</span>,
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;LOCATION&#39;</span>: <span class="s1">&#39;controller.openstack.fjf:11211&#39;</span>,
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">OPENSTACK_KEYSTONE_URL</span> <span class="o">=</span> <span class="s2">&#34;http://%s:5000/v3&#34;</span> % OPENSTACK_HOST
</span></span><span class="line"><span class="cl"><span class="nv">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT</span> <span class="o">=</span> True
</span></span><span class="line"><span class="cl"><span class="nv">OPENSTACK_API_VERSIONS</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;identity&#34;</span>: 3,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;image&#34;</span>: 2,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;volume&#34;</span>: 2,
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN</span> <span class="o">=</span> <span class="s2">&#34;Default&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">OPENSTACK_KEYSTONE_DEFAULT_ROLE</span> <span class="o">=</span> <span class="s2">&#34;admin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">OPENSTACK_NEUTRON_NETWORK</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;enable_router&#39;</span>: False,
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;enable_quotas&#39;</span>: False,
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;enable_distributed_router&#39;</span>: False,
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;enable_ha_router&#39;</span>: False,
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;enable_lb&#39;</span>: False,
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;enable_firewall&#39;</span>: False,
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;enable_vpn&#39;</span>: False,
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;enable_fip_topology_check&#39;</span>: False,
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">TIME_ZONE</span> <span class="o">=</span> <span class="s2">&#34;Asia/Shanghai&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl restart httpd.service memcached.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>访问控制台：http://192.168.81.40/dashboard
<img src="/../../image/8adb54b355c54a008942b84ee42c5f65.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
账号/密码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat admin-openrc
</span></span><span class="line"><span class="cl"><span class="c1"># 这个账号密码就是用来登陆控制台的，如果要求输入域则参考OS_USER_DOMAIN_NAME</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">OS_USERNAME</span><span class="o">=</span>admin
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">OS_PASSWORD</span><span class="o">=</span>Pass@w0rd
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">OS_USER_DOMAIN_NAME</span><span class="o">=</span>Default
</span></span></code></pre></td></tr></table>
</div>
</div><p>下载并导入镜像
导入镜像</p>
<p>下载镜像</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#测试镜像：cirros，最小的一种镜像，只有16M，方便测试</span>
</span></span><span class="line"><span class="cl">wget http://download.cirros-cloud.net/0.5.1/cirros-0.5.1-x86_64-disk.img
</span></span><span class="line"><span class="cl"><span class="c1">#Centos7镜像</span>
</span></span><span class="line"><span class="cl">http://cloud.centos.org/centos/7/images/
</span></span><span class="line"><span class="cl"><span class="c1">#其他类型镜像</span>
</span></span><span class="line"><span class="cl">https://docs.openstack.org/image-guide/obtain-images.html
</span></span></code></pre></td></tr></table>
</div>
</div><p>加载admin-openrc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">. admin-openrc
</span></span></code></pre></td></tr></table>
</div>
</div><p>导入镜像</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openstack image create <span class="s2">&#34;cirros&#34;</span> --file cirros-0.5.1-x86_64-disk.img --disk-format qcow2 --container-format bare --public
</span></span><span class="line"><span class="cl">+------------------+------------------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field            <span class="p">|</span> Value                                                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+------------------+------------------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> checksum         <span class="p">|</span> 1d3062cd89af34e419f7100277f38b2b                     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> container_format <span class="p">|</span> bare                                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> created_at       <span class="p">|</span> 2021-03-26T11:09:11Z                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> disk_format      <span class="p">|</span> qcow2                                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> file             <span class="p">|</span> /v2/images/b3befb16-19c7-4775-ac0a-1961ff269461/file <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> id               <span class="p">|</span> b3befb16-19c7-4775-ac0a-1961ff269461                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> min_disk         <span class="p">|</span> <span class="m">0</span>                                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> min_ram          <span class="p">|</span> <span class="m">0</span>                                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> name             <span class="p">|</span> cirros                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> owner            <span class="p">|</span> 750d6512fc3043d1b1c6d832465cbf9f                     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> protected        <span class="p">|</span> False                                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> schema           <span class="p">|</span> /v2/schemas/image                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> size             <span class="p">|</span> <span class="m">16338944</span>                                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> status           <span class="p">|</span> active                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> tags             <span class="p">|</span>                                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> updated_at       <span class="p">|</span> 2021-03-26T11:09:11Z                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> virtual_size     <span class="p">|</span> None                                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> visibility       <span class="p">|</span> public                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl">+------------------+------------------------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="创建网络虚拟机">创建网络&amp;虚拟机</h2>
<p>创建一个桥接网络，Flat，管理员 -&gt; 网络 -&gt; 网络 -&gt; 创建网络
物理网络名称通过：cat /etc/neutron/plugins/ml2/ml2_conf.ini |grep flat_networks 获取
<img src="/../../image/c5aa10b479944b8584abeb29130a5ac3.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
配置网络信息
<img src="/../../image/72e83e0953084a759ce7ab11319710c7.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/949387b0a0d24510801b4fa748eaadbb.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/888a545358dd4cf2ab00ec7975a3b20e.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
创建实例类型，管理员 -&gt; 计算 -&gt; 实例类型 -&gt; 创建实例类型
<img src="/../../image/45422397d25d4c0e9f45c083034715db.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/aa54391c2423430ca63ebe6b88ca5340.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
创建密钥对，项目 -&gt; 计算 -&gt; 密钥对 -&gt; 导入公钥，创建完会自动下载私钥，也可以导入已经存在的密钥对公钥
<img src="/../../image/a84626edbfe448cbb9c8ebd8731a80b9.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/a466f4c1ddc94b158899e916a32aec07.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/cc50dceb02f941c9ad331e35ad22790a.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/914ce0e922ff4bc88657040b1cde8907.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/dd307e10fcac4686982087e625d52d15.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/94ef5655778948d8968b3b0da64a7a7e.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/43552dc1715e45daaa122a3ede21d38b.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
></p>
<p>可以进入控制台
<img src="/../../image/ec81196eb82b4b3e848ad8ddc53d5313.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/b0566d45f54146d0b761090c8280ebeb.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
<img src="/../../image/4d6129c9739842ae9a0b6a66542c6a9b.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
>
通过SSH连接
<img src="/../../image/52d2c910474d45d68de622ca7671a108.png"
	
	
	
	loading="lazy"
	
		alt="在这里插入图片描述"
	
	
></p>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/openstack/">openstack</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>未来的你，会感谢今天仍在努力奋斗的你</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/202412192138/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/04.jpg" loading="lazy" data-key="202412192138" data-hash="/../../title_pic/04.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CSDN数据大屏可视化【开源】</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/202412191527/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/47.jpg" loading="lazy" data-key="202412191527" data-hash="/../../title_pic/47.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">集中管理与实时审计：构建Linux集群（1300台服务器）日志平台的最佳实践</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/202412182218/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/16.jpg" loading="lazy" data-key="202412182218" data-hash="/../../title_pic/16.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">构建全面的生产监控体系：从基础设施到业务服务</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/202410231844/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/77.jpg" loading="lazy" data-key="202410231844" data-hash="/../../title_pic/77.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">OpenStack将运行的系统导出 QCOW2 镜像并导入阿里云</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/202407302222/">
        
        
            <div class="article-image">
                
                    <img src="/../../title_pic/11.jpg" loading="lazy" data-key="202407302222" data-hash="/../../title_pic/11.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Openvpn打通北京和深圳两地办公室网络</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="nangongchengfeng/nangongchengfeng.github.io"
    data-repo-id="R_kgDOIwWL4Q"
    data-category="Announcements"
    data-category-id="DIC_kwDOIwWL4c4Cg8Rs"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark_dimmed');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2018 - 
        
        2024 南宫乘风
    </section>
    
    <section class="powerby">
        
            <a href="https://beian.miit.gov.cn/" target="_blank">备案号</a> <a href="https://beian.miit.gov.cn/" target="_blank">陕ICP备2021004364号-1</a> <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
