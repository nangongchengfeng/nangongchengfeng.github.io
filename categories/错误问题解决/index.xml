<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>错误问题解决 on 南宫乘风</title>
        <link>https://www.ownit.top/categories/%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</link>
        <description>Recent content in 错误问题解决 on 南宫乘风</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Thu, 01 Dec 2022 11:59:37 +0000</lastBuildDate><atom:link href="https://www.ownit.top/categories/%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Git引起的 gitlab-runner 报错</title>
        <link>https://www.ownit.top/p/202212011159/</link>
        <pubDate>Thu, 01 Dec 2022 11:59:37 +0000</pubDate>
        
        <guid>https://www.ownit.top/p/202212011159/</guid>
        <description>&lt;img src="https://www.ownit.top/title_pic/63.jpg" alt="Featured image of post Git引起的 gitlab-runner 报错" /&gt;&lt;p&gt;在查看gitlab CI作业时，发现意外报错&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;重新初始化现存的 Git 版本库于 /home/gitlab-runner/builds/nzfEHD8s/0/devops/dig/.git/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fatal: git fetch-pack: expected shallow list
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fatal: The remote end hung up unexpectedly
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Cleaning up project directory and file based variables
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;00:00
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ERROR: Job failed: &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; status &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/9e1bb93b2a564c38aa009350b889c13c.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; 报错时由于git版本引起的，查看git版本&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;root@bt dig&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# git version&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git version 1.8.3.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;使用&lt;a class=&#34;link&#34; href=&#34;https://so.csdn.net/so/search?q=yum&amp;amp;spm=1001.2101.3001.7020&#34;  title=&#34;yum&#34;
     target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;yum&lt;/a&gt; list | grep git，yum默认阿里云源里面最新的版本就是1.18.3 &lt;/p&gt;
&lt;p&gt;我们需要升级git 的版本&lt;/p&gt;
&lt;h2 id=&#34;1安装源&#34;&gt;1、安装源&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;yum install http://opensource.wandisco.com/centos/7/git/x86_64/wandisco-git-release-7-2.noarch.rpm
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;2更新git软件&#34;&gt;2、更新git软件&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;yum install git -y
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;3、检查版本测试&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;root@bt dig&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# git --version&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git version 2.31.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;版本已经更新最2.31了，再次执行gitlab CI作业，报错已经解决了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/d7e780b3bf9345d0b8c736b14cad3b8a.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;</description>
        </item>
        <item>
        <title>Linux虚拟机（lvm）报Unmount and run xfs_repair</title>
        <link>https://www.ownit.top/p/202203091639/</link>
        <pubDate>Wed, 09 Mar 2022 16:39:45 +0000</pubDate>
        
        <guid>https://www.ownit.top/p/202203091639/</guid>
        <description>&lt;img src="https://www.ownit.top/title_pic/32.jpg" alt="Featured image of post Linux虚拟机（lvm）报Unmount and run xfs_repair" /&gt;&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/26026e6e4ee44b2f90bb96bf2941de1f.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;原因：因为突然断电，导致机器关闭&lt;/p&gt;
&lt;p&gt;结果：发现有一台虚拟机无法启动，一直报错 &lt;strong&gt;Unmount and run xfs_repair&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;分析：主机异常掉电后里面的虚拟机无法启动，主要是损坏的分区&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决办法：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;原因：看出来应该是dm-0分区损坏，修复就可以了&lt;/p&gt;
&lt;p&gt;1：启动虚拟机E进入单用户模式&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/f9c0e1a5f93d4cf3bfb7a794d32ff8bc.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;2：在linux16开头的哪一行后面添加rd.break，ctrl+x进入救援模式&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/67f7e52f60bd4486b52ed8438e12c274.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; &lt;/p&gt;
&lt;p&gt;3：分析dm-0&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls -l /dev/mapper
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt; &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/fc4e19ae5524481884e6ea5a2f76236a.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;4:卸载目录&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;umount /dev/mapper/centos-root
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/c02824361f7e4efa91da5ce61776a3ad.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; 5:修复目录&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xfs_repair -L /dev/mapper/centos-root
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/aa06491d5580417bb8788c77006c4568.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; 6：重启机器&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;init &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;修复完成&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/ff745f35825943b68cc4d91ce9459013.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xfs_repair -h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xfs_repair: invalid option -- &lt;span class=&#34;s1&#34;&gt;&amp;#39;h&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Usage: xfs_repair &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;options&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; device
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Options:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-f The device is a file
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-L Force log zeroing. Do this as a last resort.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-l logdev Specifies the device where the external log resides.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-m maxmem Maximum amount of memory to be used in megabytes.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-n No modify mode, just checks the filesystem &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; damage.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-P Disables prefetching.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-r rtdev Specifies the device where the realtime section resides.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-v Verbose output.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-c subopts Change filesystem parameters - use xfs_admin.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-o subopts Override default behaviour, refer to man page.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-t interval Reporting interval in minutes.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-d Repair dangerously.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-V Reports version and exits.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        </item>
        <item>
        <title>截取日志范围（sed）</title>
        <link>https://www.ownit.top/p/202111031653/</link>
        <pubDate>Wed, 03 Nov 2021 16:53:26 +0000</pubDate>
        
        <guid>https://www.ownit.top/p/202111031653/</guid>
        <description>&lt;img src="https://www.ownit.top/title_pic/60.jpg" alt="Featured image of post 截取日志范围（sed）" /&gt;&lt;p&gt;后续补充&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sed  -n  &lt;span class=&#34;s1&#34;&gt;&amp;#39;/2021-02-13 21:00:00/,/2021-02-13 22:00:00/p&amp;#39;&lt;/span&gt;   /usr/local/apache-tomcat-6.0.45/logs/crm.log   &amp;gt; /opt/crm-&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;date +%Y-%m-%d-%H-%M&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;截取某个时间段到某个时间段的日志    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sed  -n  &lt;span class=&#34;s1&#34;&gt;&amp;#39;/2021-01-18 21:10:00/,$p&amp;#39;&lt;/span&gt;   /usr/local/apache-tomcat-6.0.45/logs/crm.log   &amp;gt; /opt/crm-&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;date +%Y-%m-%d-%H-%M&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;.log 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;截取某个时间段到现在的
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        </item>
        <item>
        <title>Centos7 自启没有起作用？？（rc.local）</title>
        <link>https://www.ownit.top/p/202107261639/</link>
        <pubDate>Mon, 26 Jul 2021 16:39:52 +0000</pubDate>
        
        <guid>https://www.ownit.top/p/202107261639/</guid>
        <description>&lt;img src="https://www.ownit.top/title_pic/34.jpg" alt="Featured image of post Centos7 自启没有起作用？？（rc.local）" /&gt;&lt;p&gt;今天机器重启，但是以前加的自启任务的脚本没有执行&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;原因：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在centos7中,/etc/rc.d/rc.local文件的权限被降低了,没有执行权限,需要给它添加可执行权限。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod +x /etc/rc.d/rc.local
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;然后就可以在里面添加你要开机自启的命令了&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vi /etc/rc.d/rc.local
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20210726163905909.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;</description>
        </item>
        <item>
        <title>二进制部署Kubernetes安装metrics-server遇到的问题</title>
        <link>https://www.ownit.top/p/202103231916/</link>
        <pubDate>Tue, 23 Mar 2021 19:16:02 +0000</pubDate>
        
        <guid>https://www.ownit.top/p/202103231916/</guid>
        <description>&lt;img src="https://www.ownit.top/title_pic/04.jpg" alt="Featured image of post 二进制部署Kubernetes安装metrics-server遇到的问题" /&gt;&lt;p&gt;ubernetes部署metrics-server后执行kubectl top pod或kubectl top node报错&lt;br&gt;
Error from server (ServiceUnavailable): the server is currently unable to handle the request (get pods.metrics.k8s.io)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20200322214527823.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;一、问题检查步骤：&lt;/p&gt;
&lt;p&gt;1.1、查看metrics-server服务日志&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Cluster doesn&lt;span class=&#34;s1&#34;&gt;&amp;#39;t provide requestheader-client-ca-file in configmap/extension-apiserver-authentication in kube-system, so request-header client certificate authentication won&amp;#39;&lt;/span&gt;t work.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;检查发现是由于调用metrics-server无权限，返回了http 403错误&lt;/p&gt;
&lt;p&gt;1.2、检查是否配置了以下参数&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        args:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          - --cert-dir&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/tmp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          - --secure-port&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4443&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          - --kubelet-insecure-tls&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          - --kubelet-preferred-address-types&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;InternalIP,Hostname,InternalDNS,externalDNS
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;1.3、问题总结：&lt;/p&gt;
&lt;p&gt;metrics-server服务配置是没有问题的，但服务依然报错 Error from server (ServiceUnavailable): the server is currently unable to handle the request (get pods.metrics.k8s.io)，有两种方法可以解决问题&lt;/p&gt;
&lt;p&gt;1、授权集群角色给用户system:anonymous&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create clusterrolebinding system:anonymous  --clusterrole=cluster-admin  --user=system:anonymous
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;2、创建system:metrics-server角色并授权&lt;/p&gt;
&lt;p&gt;二、问题解决(创建system:metrics-server角色并授权)&lt;/p&gt;
&lt;p&gt;配置metrics-server证书&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# vim metrics-server-csr.json&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;CN&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;system:metrics-server&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;hosts&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;key&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;algo&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;rsa&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;size&amp;#34;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;2048&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;names&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;CN&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;ST&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;BeiJing&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;L&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;BeiJing&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;O&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;k8s&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;OU&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;system&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt; &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cfssl gencert -ca&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ca.pem -ca-key&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ca-key.pem -config&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ca-config.json -profile&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kubernetes metrics-server-csr.json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; cfssljson -bare metrics-server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;配置metrics-server  RBAC授权&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &amp;gt; auth-metrics-server.yaml &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: ClusterRole
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: system:auth-metrics-server-reader
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  labels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    rbac.authorization.k8s.io/aggregate-to-view: &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    rbac.authorization.k8s.io/aggregate-to-edit: &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    rbac.authorization.k8s.io/aggregate-to-admin: &amp;#34;true&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;rules:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;- apiGroups: [&amp;#34;metrics.k8s.io&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  resources: [&amp;#34;pods&amp;#34;, &amp;#34;nodes&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  verbs: [&amp;#34;get&amp;#34;, &amp;#34;list&amp;#34;, &amp;#34;watch&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: ClusterRoleBinding
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: metrics-server:system:auth-metrics-server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;roleRef:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  apiGroup: rbac.authorization.k8s.io
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  kind: ClusterRole
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: system:auth-metrics-server-reader
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;subjects:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;- kind: User
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: system:metrics-server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: kube-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;kube-apiserver添加metrics-server需要的配置&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--requestheader-client-ca-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/opt/kubernetes/ssl/ca.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--requestheader-allowed-names&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;aggregator,metrics-server &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--requestheader-extra-headers-prefix&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X-Remote-Extra- &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--requestheader-group-headers&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X-Remote-Group &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--requestheader-username-headers&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;X-Remote-User &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--proxy-client-cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/opt/kubernetes/ssl/metrics-server.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--proxy-client-key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/opt/kubernetes/ssl/metrics-server-key.pem 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;检查是否能够正常获取到监控信息&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20210323191550516.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;</description>
        </item>
        <item>
        <title>Failed to create client- error while trying to communicate with apiserver- 报错解决</title>
        <link>https://www.ownit.top/p/202103162136/</link>
        <pubDate>Tue, 16 Mar 2021 21:36:32 +0000</pubDate>
        
        <guid>https://www.ownit.top/p/202103162136/</guid>
        <description>&lt;img src="https://www.ownit.top/title_pic/46.jpg" alt="Featured image of post Failed to create client- error while trying to communicate with apiserver- 报错解决" /&gt;&lt;p&gt;问题：Kubernetes安装普罗米修斯，其中kube-state-metrics 容器一直报错&lt;/p&gt;
&lt;p&gt;环境：Kubernetes 1.18&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;root@k8s-master01 manifests&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# kubectl logs -f kube-state-metrics-bdb8874fd-tnrrg  -n monitoring -c kube-state-metrics&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;I0316 13:12:52.295699       &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; main.go:86&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Using default collectors
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;I0316 13:12:52.295788       &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; main.go:98&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Using all namespace
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;I0316 13:12:52.295798       &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; main.go:139&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; metric white-blacklisting: blacklisting the following items: 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;W0316 13:12:52.295807       &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; client_config.go:543&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Neither --kubeconfig nor --master was specified.  Using the inClusterConfig.  This might not work.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;I0316 13:12:52.297186       &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; main.go:184&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Testing communication with server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;F0316 13:13:22.298801       &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; main.go:147&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Failed to create client: error &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; trying to communicate with apiserver: Get https://10.96.0.1:443/version?timeout&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;32s: dial tcp 10.96.0.1:443: i/o timeout
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;分析：&lt;/p&gt;
&lt;p&gt;首先，这个kube-state-metrics-bdb8874fd-tnrrg 中有三个容器。问题出现在kube-state-metrics。导致容器不断的重启&lt;/p&gt;
&lt;p&gt;看问题，是无法连接到10.96.0.1:443这个ip和端口上。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;root@k8s-master01 ~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# kubectl get svc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;    AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;csi-metrics-cephfsplugin   ClusterIP   10.96.218.238   &amp;lt;none&amp;gt;        8080/TCP   21h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubernetes                 ClusterIP   10.96.0.1       &amp;lt;none&amp;gt;        443/TCP    83d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx                      ClusterIP   10.96.215.251   &amp;lt;none&amp;gt;        80/TCP     16d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;由svc可见，这个是Kubernetes的核心ip和端口。但是他那边显示无法连接。&lt;/p&gt;
&lt;p&gt;测试一下&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20210316213148931.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;这个端口是通的，但是无法连接。报错显示io线程延时。&lt;/p&gt;
&lt;p&gt;解决：&lt;/p&gt;
&lt;p&gt;kube-state-metrics原本安装在k8s-node02上。这边删除，还是从重建k8s-node02.&lt;/p&gt;
&lt;p&gt;分析一下node02的cpu有点高，我直接指定到k8s-node01上。&lt;/p&gt;
&lt;p&gt;然后测试，没有显示io延时报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20210316213425478.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/202103162136066.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;</description>
        </item>
        <item>
        <title>运维工作经验汇总-高级运维工程师</title>
        <link>https://www.ownit.top/p/202004291720/</link>
        <pubDate>Wed, 29 Apr 2020 17:20:47 +0000</pubDate>
        
        <guid>https://www.ownit.top/p/202004291720/</guid>
        <description>&lt;img src="https://www.ownit.top/title_pic/02.jpg" alt="Featured image of post 运维工作经验汇总-高级运维工程师" /&gt;&lt;p&gt;&lt;strong&gt;目录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#%e7%ac%ac%e4%b8%80%e7%ab%a0%20%e5%88%9d%e5%85%a5%e5%85%ac%e5%8f%b8&#34; &gt;第一章 初入公司&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#&#34; &gt;第2章 第一阶段：解决物理服务器单电问题&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#&#34; &gt;第3章 第二阶段：解决服务器虚拟化问题&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#&#34; &gt;第4章 第三阶段：数据库备份&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#%e7%ac%ac5%e7%ab%a0%20%e7%ac%ac%e5%9b%9b%e9%98%b6%e6%ae%b5%ef%bc%9a%e8%a7%a3%e5%86%b3%e6%95%b0%e6%8d%ae%e5%ba%93%e5%8d%95%e7%82%b9&#34; &gt;第5章 第四阶段：解决数据库单点&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#%e7%ac%ac6%e7%ab%a0%20%e7%ac%ac%e4%ba%94%e9%98%b6%e6%ae%b5%ef%bc%9a%e5%ae%8c%e5%96%84%e7%9b%91%e6%8e%a7%e9%a1%b9&#34; &gt;第6章 第五阶段：完善监控项&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#%e7%ac%ac7%e7%ab%a0%20%e7%ac%ac%e5%85%ad%e9%98%b6%e6%ae%b5%ef%bc%9a%e7%bb%9f%e4%b8%80%e6%9c%8d%e5%8a%a1%e7%9a%84%e5%ae%89%e8%a3%85%e6%96%b9%e5%bc%8f&#34; &gt;第7章 第六阶段：统一服务的安装方式&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#%e7%ac%ac8%e7%ab%a0%20%e7%ac%ac%e4%b8%83%e9%98%b6%e6%ae%b5%ef%bc%9a%e5%85%b3%e9%94%ae%e6%9c%8d%e5%8a%a1%20NFS%20%e8%bf%81%e7%a7%bb%e5%a4%87%e4%bb%bd&#34; &gt;第8章 第七阶段：关键服务 NFS 迁移备份&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#%e7%ac%ac9%e7%ab%a0%20%e7%ac%ac%e5%85%ab%e9%98%b6%e6%ae%b5%ef%bc%9a%e6%9c%8d%e5%8a%a1%e6%8b%86%e5%88%86-%e7%94%a8%e6%88%b7%e5%92%8c%e7%88%ac%e8%99%ab%e6%b5%81%e9%87%8f%e5%88%86%e7%a6%bb-ELK%20%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86&#34; &gt;第9章 第八阶段：服务拆分-用户和爬虫流量分离-ELK 日志收集&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#%e7%ac%ac10%e7%ab%a0%20%e7%ac%ac%e4%b9%9d%e9%98%b6%e6%ae%b5%ef%bc%9a%e5%a2%9e%e5%8a%a0%e7%ac%ac%e4%ba%8c%e6%9c%ba%e6%88%bf-%e5%a4%a7%e6%95%b0%e6%8d%ae%e6%9c%8d%e5%8a%a1&#34; &gt;第10章 第九阶段：增加第二机房-大数据服务&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#%E5%AE%8C%E6%95%B4%E6%9E%B6%E6%9E%84%E5%9B%BE&#34; &gt;完整架构图&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84%E6%BC%94%E5%8F%98&#34; &gt;整体结构演变&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;第一章-初入公司&#34;&gt;第一章 初入公司&lt;/h2&gt;
&lt;h3 id=&#34;11-架构拓扑图&#34;&gt;1.1 &lt;strong&gt;架构拓扑图&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/2020042915240892.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;12-存在的问题汇总&#34;&gt;1.2 存在的问题汇总&lt;/h3&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;1.物理服务器电源单电，机房电力切割时需要关闭所有服务器，导致服务中断 4-6 小时&lt;/li&gt;
&lt;li&gt;2.物理服务器配置不当，有的服务器系统盘用 SSD，数据盘反而用机械盘&lt;/li&gt;
&lt;li&gt;3.服务器虚拟化 ESXi 上的虚拟机经常无故变成系统只读导致服务不可用&lt;/li&gt;
&lt;li&gt;4.操作系统不统一，有 debian，有 FreeBSD&lt;/li&gt;
&lt;li&gt;5.数据库单点，且没有备份以及恢复计划&lt;/li&gt;
&lt;li&gt;6.keepalived 配置错误导致 HA 高可用没有生效&lt;/li&gt;
&lt;li&gt;7.重要的 NFS 服务器 5T 的数据没有备份，且操作系统为 FreeBSD&lt;/li&gt;
&lt;li&gt;8.zabbix 监控项过多，报警内容太多，关键报警被淹没&lt;/li&gt;
&lt;li&gt;9.软件部署方式不统一，有编译/脚本/tar 包/deb 包多种安装方式&lt;/li&gt;
&lt;li&gt;10.脚本不统一，脚本随处存放，命名混乱，很多不知道有没有用&lt;/li&gt;
&lt;li&gt;11.没有批量操作工具，依靠纯手工或脚本操作&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;第2章-第一阶段解决物理服务器单电问题&#34;&gt;第2章 第一阶段：解决物理服务器单电问题&lt;/h2&gt;
&lt;h3 id=&#34;21-问题现象&#34;&gt;2.1 问题现象&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.物理服务器电源单模块，如果机房进行电力切割，必须关闭所有服务器，等机房电力切割结束再把所有服务器开机&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;22-导致后果&#34;&gt;2.2 导致后果&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.电力切割期间所有的业务完全中断，用户在此期间无法访问&lt;br&gt;
2.服务没有做开机自启动，重新开机之后需要手动起服务&lt;br&gt;
3.因为服务器老旧，关机之后可能起不来&lt;br&gt;
4.因为关机时暴力 kill 了服务，导致服务器重启后数据损坏&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;23-解决方案&#34;&gt;2.3 解决方案&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.因为服务器型号老旧，厂商已经停产，买不到新电源&lt;br&gt;
2.退而求次，淘宝联系卖二手服务器的卖家，购买服务器相同型号的电源&lt;br&gt;
3.服务器电源属于热插拔，可以直接插上测试&lt;br&gt;
4.验收方法为：&lt;br&gt;
- 两个电源模块都插上电，然后拔掉第一个电源模块，查看服务器有没有重启。&lt;br&gt;
- 如果服务器没有重启，再全部插上电源，然后再拔掉另一个电源，查看有没有重启&lt;br&gt;
- 如果都没有重启，就证明服务器双电模块运行正常&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;24-价值体现&#34;&gt;2.4 价值体现&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.由原来业务需要中断 4-6 小时缩短为 0 中断&lt;br&gt;
2.给公司减少了由于业务中断导致的经济损失&lt;br&gt;
3.运维再也不用在机房通宵熬夜等待电力切割了&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;第3章-第二阶段解决服务器虚拟化问题&#34;&gt;第3章 第二阶段：解决服务器虚拟化问题&lt;/h2&gt;
&lt;h3 id=&#34;31-问题现象&#34;&gt;3.1 问题现象&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.服务器虚拟化采用的是 VMware ESXi 虚拟化平台，运行的虚拟机经常无故的系统变成只读，导致服务中断&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;32-导致后果&#34;&gt;3.2 导致后果&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.虚拟机运行的服务不可用，导致业务中断，影响用户体验&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;33-解决方案&#34;&gt;3.3 解决方案&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.找台新服务器安装部署新版本的 ESXi,安装 VCenter 管理中心&lt;br&gt;
2.迁移旧服务到新服务器&lt;br&gt;
3.持续观察检验&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;34-价值体现&#34;&gt;3.4 价值体现&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.新版本虚拟机运行稳定，业务不会中断&lt;br&gt;
2.服务器虚拟化充分利用了硬件资源，为公司节省了购买 3 台物理服务器的价格&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;第4章-第三阶段数据库备份&#34;&gt;第4章 第三阶段：数据库备份&lt;/h2&gt;
&lt;h3 id=&#34;41-问题现象&#34;&gt;4.1 问题现象&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.mysql 数据库只有一台主从，没有备份&lt;br&gt;
2.redis 和 mongo 单点，且没有备份&lt;br&gt;
3.数据库服务器数据盘均为单块 SSD 固态硬盘，一旦损坏没有修复的希望&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;42-导致后果&#34;&gt;4.2 导致后果&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.如果数据库服务器硬件或者硬盘损坏，没有数据可以提供恢复，后果不堪设想&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;43-解决方案&#34;&gt;4.3 解决方案&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.这个阶段重点是先备份数据&lt;br&gt;
2.新增加一个 mysql 从库，使用 xtrabackup 在从库上每天定时备份数据&lt;br&gt;
3.新增加一个 redis 从库，每天物理备份 redis 持久化的 RDB 文件&lt;br&gt;
4.新增加一个 mongo 从库，每天使用 mongodump 导出数据&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;44-价值体现&#34;&gt;4.4 价值体现&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.在服务器有限和时间有限的情况下，按照紧急度优先解决数据库备份&lt;br&gt;
2.降低了因为物理服务器损坏或者人为操作失误导致的数据灾难性丢失情况&lt;br&gt;
3.为下一步数据库服务集群化提供了基础保障&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;45-拓扑图&#34;&gt;4.5 拓扑图&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20200429153536306.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;第5章-第四阶段解决数据库单点&#34;&gt;第5章 第四阶段：解决数据库单点&lt;/h2&gt;
&lt;h3 id=&#34;51-问题现象&#34;&gt;5.1 问题现象&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.数据库故障到完全修复过程中，业务会中断，用户不能访问&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;52-导致后果&#34;&gt;5.2 导致后果&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.虽然已经做了数据库备份，但是一旦数据库损坏，恢复起来依然需要很多时间&lt;br&gt;
2.由于业务代码写死了 IP 地址，一旦数据库损坏，在其他机器上恢复了，业务代码也需要变更 IP 地&lt;br&gt;
址，重新发布，耗时太长&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;53-解决方案&#34;&gt;5.3 解决方案&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.对目前单点数据库升级到集群架构&lt;br&gt;
2.新增加 mysql 从库。&lt;br&gt;
3.redis 由单节点升级为 redis cluster 集群&lt;br&gt;
4.mongo 由主从复制升级为 3 节点副本集&lt;br&gt;
5.新部署 elasticsearch 服务集群&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;54-实施难点&#34;&gt;5.4 实施难点&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.对于运维来说，安装部署不复杂，但是难题在于由于数据库架构升级，从而导致业务代码连接方&lt;br&gt;
式发生改变&lt;br&gt;
2.因为现在的业务代码都是采用框架开发，所以很多数据库插件需要升级，比如 redis 和 mongo 都需&lt;br&gt;
要升级插件才能支持集群化连接&lt;br&gt;
3.需要提前在开发环境搭建部署好。然后开发测试没有问题之后，再采用轮训升级的方式逐步升级&lt;br&gt;
升级数据库以及代码框架&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;55-价值体现&#34;&gt;5.5 价值体现&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.对数据库的稳定性以及安全性有了质的改变&lt;br&gt;
2.由于数据库集群化，性能得到了大大的提升，用户打开网站访问速度更好，体验更好&lt;br&gt;
3.由于数据库集群化，提供了冗余，所以即使服务器损坏或者维护也不会影响架构改变，用户访问&lt;br&gt;
也不会中断&lt;br&gt;
4.减少了因为数据库宕机或恢复导致的经济损失&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;56-拓扑图&#34;&gt;5.6 拓扑图&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20200429153904667.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;第6章-第五阶段完善监控项&#34;&gt;第6章 第五阶段：完善监控项&lt;/h2&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h3 id=&#34;61-问题现象&#34;&gt;6.1 问题现象&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.监控项报警内容太多，有时候几分钟上百条&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;62-导致后果&#34;&gt;6.2 导致后果&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.关键的报警信息被不重要的报警淹没，以至于不能第一时间发现关键问题&lt;br&gt;
2.由于报警监控项配置不当，导致连锁反应，牵动很多不需要的警告&lt;br&gt;
3.由于短时间大量的报警产生，对 zabbix 服务器造成很大压力，甚至导致 zabbix 服务宕机&lt;br&gt;
4.如果配置了短信报警，那么大量的非关键报警导致消耗很多短信条目，很花钱！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;63-解决方案&#34;&gt;6.3 解决方案&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.优化报警内容，只监控必须要监控的，模版自带的一些不需要的监控项停掉&lt;br&gt;
2.报警分级，将报警信息按紧急度拆分，所有报警都发邮件，紧急的报警追加发送到微信&lt;br&gt;
3.取消短信报警，改为邮件和微信报警&lt;br&gt;
4.报警内容优化，尽量看标题就能知道报警内容是什么&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;64-价值体现&#34;&gt;6.4 价值体现&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.接受的报警量大大减少，运维的注意力可以更集中在关键的问题处理上&lt;br&gt;
2.通过不同的发送介质第一时间了解问题的紧急度，比如发送到微信上的都是需要立刻处理的&lt;br&gt;
3.取消短信报警为公司节省开销&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; &lt;/p&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;第7章-第六阶段统一服务的安装方式&#34;&gt;第7章 第六阶段：统一服务的安装方式&lt;/h2&gt;
&lt;h3 id=&#34;71-问题现象&#34;&gt;7.1 问题现象&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.服务安装混乱，有脚本安装，有 tar 包安装，有 deb 包安装，有编译安装&lt;br&gt;
2.软件存放目录不统一，数据存放目录不统一，脚本存放目录不统一&lt;br&gt;
3.防火墙规则不统一，有一些不用的规则没有清理&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;72-导致后果&#34;&gt;7.2 导致后果&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.一些操作无法进行批量执行&lt;br&gt;
2.安装服务基本需要手动操作&lt;br&gt;
3.文档缺失，不知道以前怎么装的，不知道以前配了什么参数&lt;br&gt;
4.防火墙规则混乱，有一些已经不用的服务，但是规则没有删除，看起来很乱&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;73-解决方案&#34;&gt;7.3 解决方案&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.引入 ansible 批量管理工具，统一服务安装方式，新服务统一使用 playbook 安装&lt;br&gt;
2.统一服务安装目录，数据目录，日志目录&lt;br&gt;
3.清理防火墙不用的规则，只保留必须的规则&lt;br&gt;
4.编写运维文档，制定运维规范&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;74-价值体现&#34;&gt;7.4 价值体现&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.新服务安装部署由原来的按小时缩短为分钟级别，提高了运维效率&lt;br&gt;
2.避免了因为手动操作敲错命令导致的不可预料后果，实现了一次编写重复运行&lt;br&gt;
3.编写运维文档，为部门同事和公司留下可持续的价值输出&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;第8章-第七阶段关键服务-nfs-迁移备份&#34;&gt;第8章 第七阶段：关键服务 NFS 迁移备份&lt;/h2&gt;
&lt;h3 id=&#34;81-问题现象&#34;&gt;8.1 问题现象&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.公司成立以来所有的图片数据都保存在一台安装 FreeBSD 操作系统的老旧服务器上且没有备份&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;82-导致后果&#34;&gt;8.2 导致后果&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.NFS 服务器的数据高达 5T，且没有备份，一旦服务器或硬盘损坏，后果不堪设想&lt;br&gt;
2.由于 FreeBSD 操作系统的原因，没有办法使用 sersync 来进行实时同步备份&lt;br&gt;
3.一旦服务器发生损坏，所有业务网站的图片服务都将失效，短时间没有替代方案&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;83-解决方案&#34;&gt;8.3 解决方案&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.虽然 FreeBSD 系统不能使用 sersync，但是可以使用 rsync&lt;br&gt;
2.找一台性能足够服务器，使用四块 6T 磁盘制作 RAID10，安装部署 rsync 服务端和 NFS 服务端&lt;br&gt;
3.分目录进行同步，总目录数据量太大，同步起来时间按天算，拆分成一个个小目录分批进行同步&lt;br&gt;
4.统计记录每次同步的时间，最高在半夜业务低峰期进行同步&lt;br&gt;
5.和开发沟通切换方案，开发修改代码，用户上传数据同时往 2 台服务器上写入，保证数据一致性&lt;br&gt;
6.业务低峰期进行切换，在前端代理轮流更新 WEB 服务器的卸载旧 NFS，然后重新挂载新 NFS&lt;br&gt;
7.修改个别权限不对的目录。测试所有上传业务是否可以正常的写入&lt;br&gt;
8.为了防止意料不到的意外情况，旧服务器数据继续保留 1 个月。确定一切正常之后重做旧服务器&lt;br&gt;
9.然后使用 sersync 同步数据到新服务器，持续观察，保证同步正常工作&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;84-价值体现&#34;&gt;8.4 价值体现&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.在业务不中断，数据不丢失的情况下为公司的宝贵资产提供了可靠的备份方案&lt;br&gt;
2.烫手的山芋在运维手里得到了解决，荣誉感，成就感大增&lt;br&gt;
3.在公司领导和同事心中留下了可靠可信赖的印象&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;85-拓扑图&#34;&gt;8.5 拓扑图&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20200429164751753.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20200429154635701.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;第9章-第八阶段服务拆分-用户和爬虫流量分离-elk-日志收集&#34;&gt;第9章 第八阶段：服务拆分-用户和爬虫流量分离-ELK 日志收集&lt;/h2&gt;
&lt;h3 id=&#34;91-问题现象&#34;&gt;9.1 问题现象&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.因为公司有论坛，需要爬虫来爬取&lt;br&gt;
2.但是爬虫的流量和用户的流量混合在了一起，且没有统一的日志管理平台查看过滤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;92-导致后果&#34;&gt;9.2 导致后果&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.由于流量没有分离，导致当有大量的爬虫访问的时候，对服务器和数据库造成非常大的压力&lt;br&gt;
2.当爬虫访问频次过高时，会导致数据库连接数变多，系统负载变高，影响用户正常服务&lt;br&gt;
3.同样，由于爬虫流量和用户流量混在了一起，没有很好的办法分析压力高的原因&lt;br&gt;
4.开发或者运营想看一些日志数据只能找运维解决，每次分析都要花很久，分析脚本没有办法复用&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;93-解决方案&#34;&gt;9.3 解决方案&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.新增加一台 WEB 服务器专门给爬虫使用，页面做静态化，优化爬虫抓去效率&lt;br&gt;
2.数据库读写分离，爬虫抓取如果需要查询数据库，把流量指向没有业务访问的从库&lt;br&gt;
3.前端代理根据访问的请求报文里的 user-agent 来分离爬虫和用户的访问流量，如果是爬虫就把流量引到给爬虫抓取的 WEB 服务器上，用户正常的流量还是正常访问 WEB 集群。&lt;br&gt;
4.搭建部署 ELK 日志收集平台，集中收集所有 Nginx 访问日志，使用 kibana 作为过滤搜索和展示，&lt;br&gt;
制作好用户展示数据的图表，培训部门同事 ELK 的使用和查询方法&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;94-价值体现&#34;&gt;9.4 价值体现&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.将用户和爬虫流量分离，当爬虫大量访问时候正常用户访问也不会受到影响，用户体验大大提升&lt;br&gt;
2.搭建部署了 ELK 日志分析平台，方便部门同事查询数据，定位故障时间大大地缩减，大大提高了工作效率&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;95-拓扑图&#34;&gt;9.5 拓扑图&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20200429154905136.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;第10章-第九阶段增加第二机房-大数据服务&#34;&gt;第10章 第九阶段：增加第二机房-大数据服务&lt;/h2&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h3 id=&#34;101-项目需求&#34;&gt;10.1 项目需求&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.业务发展，需要部署 Hadoop 平台和 kafka+zookeeper 服务&lt;br&gt;
2.由于 IDC 机房只有一个机架，所以需要在第二机房部署&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;102-价值体现&#34;&gt;10.2 价值体现&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1.测试环境测试没问题后使用 ansible 批量部署到新的大数据服务器，节省了部署时间&lt;br&gt;
2.大数据服务可以更好的分析用户访问行为，根据分析结果可以更精确的给用户推送推荐内容&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;103-拓扑图&#34;&gt;10.3 拓扑图&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/2020042915530829.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;完整架构图&#34;&gt;完整架构图&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlaWFuXzk5,size_16,color_FFFFFF,t_70.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt; &lt;/p&gt;
&lt;h2 id=&#34;整体结构演变&#34;&gt;整体结构演变&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20200429165223813.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;</description>
        </item>
        <item>
        <title>Tests in error-BlogApplicationTests.initializationError » IllegalState Unable to find a @Spri...【解决】</title>
        <link>https://www.ownit.top/p/201911180942/</link>
        <pubDate>Mon, 18 Nov 2019 09:42:22 +0000</pubDate>
        
        <guid>https://www.ownit.top/p/201911180942/</guid>
        <description>&lt;img src="https://www.ownit.top/title_pic/42.jpg" alt="Featured image of post Tests in error-BlogApplicationTests.initializationError » IllegalState Unable to find a @Spri...【解决】" /&gt;&lt;p&gt;刚刚写完一个项目，准备打包，却发现无法打包。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20191118093843838.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;然后认真排查了一下问题。发现少引入了一个插件。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;groupId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;apache&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;maven&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;plugins&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;groupId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;artifactId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;maven&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;surefire&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;artifactId&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;o&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;引入这个插件就可以完美运行打包了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.ownit.top/../../image/20191118094122154.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;</description>
        </item>
        
    </channel>
</rss>
